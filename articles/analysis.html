<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Analysis code • sparselink</title>
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Analysis code">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">sparselink</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">functions</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/article.html">article</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/analysis.html">analysis</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">news</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/rauschenberger/sparselink/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Analysis code</h1>
                        <h4 data-toc-skip class="author">Armin
Rauschenberger</h4>
            
            <h4 data-toc-skip class="date">2025-07-15</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/rauschenberger/sparselink/blob/main/vignettes/analysis.Rmd" class="external-link"><code>vignettes/analysis.Rmd</code></a></small>
      <div class="d-none name"><code>analysis.Rmd</code></div>
    </div>

    
    
<p><strong>We obtained our results on 2025-06-02 using R version 4.5.0
(2025-04-11, “How About a Twenty-Six”) running on a Dell Latitude 5440
laptop with a 13th Gen Intel(R) Core(TM) i7-1365U processor (1800 Mhz),
16 GB RAM, and the operating system Microsoft Windows 10 Enterprise. The
total computation time was around 7 hours (excluding data download,
without parallel computing).</strong></p>
<div class="section level2">
<h2 id="working-environment">Working environment<a class="anchor" aria-label="anchor" href="#working-environment"></a>
</h2>
<p>This vignette includes code chunks with a long computation time
(e.g., analysing simulated and experimental data) and code chunks with a
short computation time (e.g., generating figures and tables). The
logical options <code>sim.app</code> and <code>fig.tab</code> determine
whether the chunks for (i) running the simulation and application or
(ii) generating figures and tables are evaluated, respectively. Running
this vignette with <code>sim.app=FALSE</code> and
<code>fig.tab=TRUE</code> means that figures and tables will be
generated from previously obtained results. Running this vignette with
<code>sim.app=TRUE</code> and <code>fig.tab=TRUE</code>and means that
all results will be reproduced (including data download and data
processing). It is also possible to execute individual chunks (e.g., for
reproducing a specific figure or table), but then it is important to
provide the required inputs (e.g., “Requires: file X in folder Y,
execution of chunk Z”).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/knitr/man/opts_chunk.html" class="external-link">opts_chunk</a></span><span class="op">$</span><span class="fu">set</span><span class="op">(</span>echo<span class="op">=</span><span class="cn">TRUE</span>,eval<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">sim.app</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span> <span class="co"># reproduce simulation and application?</span></span>
<span><span class="va">fig.tab</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span> <span class="co"># reproduce figures and tables?</span></span></code></pre></div>
<p>This chunk verifies the working environment. The working directory,
specified by the object <code>path</code>, must contain the R functions
in “package/R/functions.R” as well as the folders “results” and
“manuscript”. Alternatively, the R functions can be loaded from the R
package <code>sparselink</code>. This chunk also installs missing R
packages from CRAN or Bioconductor.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">path</span> <span class="op">&lt;-</span> <span class="st">"C:/Users/arauschenberger/Desktop/sparselink"</span> <span class="co"># LIH (Windows)</span></span>
<span><span class="co">#path &lt;- "/Users/armin.rauschenberger/Desktop/LIH/sparselink" # LCSB (Mac)</span></span>
<span></span>
<span><span class="va">dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"results"</span>,<span class="st">"manuscript"</span>,<span class="st">"package/R/functions.R"</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">dir</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.exists</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="va">dir</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">&amp;</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="va">dir</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Require folder/file'"</span>,<span class="va">dir</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,<span class="st">"'."</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> </span>
<span><span class="op">}</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">"package/R/functions.R"</span><span class="op">)</span><span class="op">)</span> <span class="co"># Or load 'sparselink' package.</span></span>
<span></span>
<span><span class="va">inst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/installed.packages.html" class="external-link">installed.packages</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pkgs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"knitr"</span>,<span class="st">"rmarkdown"</span>,<span class="st">"glmnet"</span>,<span class="st">"BiocManager"</span>,<span class="st">"mvtnorm"</span>,<span class="st">"glmtrans"</span>,<span class="st">"spls"</span>,<span class="st">"xrnet"</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">pkgs</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="va">pkgs</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span><span class="va">inst</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="va">pkgs</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="va">pkgs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"recount3"</span>,<span class="st">"edgeR"</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">pkgs</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="va">pkgs</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span><span class="va">inst</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu">BiocManager</span><span class="fu">::</span><span class="fu">install</span><span class="op">(</span><span class="va">pkgs</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">blue</span> <span class="op">&lt;-</span> <span class="st">"blue"</span>; <span class="va">red</span> <span class="op">&lt;-</span> <span class="st">"red"</span></span>
<span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html" class="external-link">exists</a></span><span class="op">(</span><span class="st">"sim.app"</span><span class="op">)</span><span class="op">&amp;</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html" class="external-link">exists</a></span><span class="op">(</span><span class="st">"fig.tab"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="va">sim.app</span><span class="op">&amp;</span><span class="va">fig.tab</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"simulation_multiple.RData"</span>,<span class="st">"simulation_transfer.RData"</span>,<span class="st">"recount3_data.RData"</span>,<span class="st">"explore_data.RData"</span>,<span class="st">"application.RData"</span><span class="op">)</span></span>
<span>    <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">files</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">"results"</span>,<span class="va">files</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"File"</span>,<span class="va">files</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,<span class="st">"is missing."</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="methods">Methods<a class="anchor" aria-label="anchor" href="#methods"></a>
</h2>
<p>This chunk generates the figure for the methods section.</p>
<ul>
<li><p>Requires: execution of chunk <code>setup</code></p></li>
<li><p>Execution time: <span class="math inline">\(1\)</span>
second</p></li>
<li><p>Ensures: file <code>fig_flow.eps</code> in folder
<code>manuscript</code></p></li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#&lt;&lt;setup&gt;&gt;</span></span>
<span></span>
<span><span class="fu">grDevices</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grDevices/postscript.html" class="external-link">postscript</a></span><span class="op">(</span>file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">"manuscript"</span>,<span class="st">"fig_flow.eps"</span><span class="op">)</span>,width<span class="op">=</span><span class="fl">6</span>,height<span class="op">=</span><span class="fl">2.5</span>,horizontal<span class="op">=</span><span class="cn">FALSE</span>,onefile<span class="op">=</span><span class="cn">FALSE</span>,paper<span class="op">=</span><span class="st">"special"</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/frame.html" class="external-link">plot.new</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.window.html" class="external-link">plot.window</a></span><span class="op">(</span>xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.2</span>,<span class="fl">1.0</span><span class="op">)</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0</span>,<span class="fl">1.0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cex</span> <span class="op">&lt;-</span> <span class="fl">0.8</span></span>
<span></span>
<span><span class="va">pos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>left<span class="op">=</span><span class="fl">0.2</span>,right<span class="op">=</span><span class="fl">0.8</span>,top<span class="op">=</span><span class="fl">0.8</span>,centre<span class="op">=</span><span class="fl">0.45</span>,bottom<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="va">mar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>vertical<span class="op">=</span><span class="fl">0.08</span>,horizontal<span class="op">=</span><span class="fl">0.08</span>,dist<span class="op">=</span><span class="fl">0.04</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"problem"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>,x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">pos</span><span class="op">$</span><span class="va">left</span>,<span class="va">pos</span><span class="op">$</span><span class="va">right</span><span class="op">)</span>,y<span class="op">=</span><span class="va">pos</span><span class="op">$</span><span class="va">top</span><span class="op">+</span><span class="fl">2</span><span class="op">*</span><span class="va">mar</span><span class="op">$</span><span class="va">vertical</span>,font<span class="op">=</span><span class="fl">2</span>,col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">blue</span>,<span class="va">red</span><span class="op">)</span>,cex<span class="op">=</span><span class="va">cex</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html" class="external-link">hat</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span><span class="op">[</span><span class="st">"j,1"</span><span class="op">]</span><span class="op">^</span><span class="op">{</span><span class="va">init</span><span class="op">}</span><span class="op">)</span>,x<span class="op">=</span><span class="va">pos</span><span class="op">$</span><span class="va">left</span>,y<span class="op">=</span><span class="va">pos</span><span class="op">$</span><span class="va">top</span>,col<span class="op">=</span><span class="va">blue</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html" class="external-link">hat</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span><span class="op">[</span><span class="st">"j,2"</span><span class="op">]</span><span class="op">^</span><span class="op">{</span><span class="va">init</span><span class="op">}</span><span class="op">)</span>,x<span class="op">=</span><span class="va">pos</span><span class="op">$</span><span class="va">right</span>,y<span class="op">=</span><span class="va">pos</span><span class="op">$</span><span class="va">top</span>,col<span class="op">=</span><span class="va">red</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/arrows.html" class="external-link">arrows</a></span><span class="op">(</span>x0<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">pos</span><span class="op">$</span><span class="va">left</span>,<span class="va">pos</span><span class="op">$</span><span class="va">right</span><span class="op">)</span>,each<span class="op">=</span><span class="fl">2</span><span class="op">)</span>,x1<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">pos</span><span class="op">$</span><span class="va">left</span>,<span class="va">pos</span><span class="op">$</span><span class="va">right</span><span class="op">)</span>,times<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="va">mar</span><span class="op">$</span><span class="va">horizontal</span>,<span class="op">-</span><span class="va">mar</span><span class="op">$</span><span class="va">horizontal</span>,<span class="va">mar</span><span class="op">$</span><span class="va">horizontal</span>,<span class="va">mar</span><span class="op">$</span><span class="va">horizontal</span><span class="op">)</span>,y0<span class="op">=</span><span class="va">pos</span><span class="op">$</span><span class="va">top</span><span class="op">-</span><span class="va">mar</span><span class="op">$</span><span class="va">vertical</span>,y1<span class="op">=</span><span class="va">pos</span><span class="op">$</span><span class="va">centre</span><span class="op">+</span><span class="va">mar</span><span class="op">$</span><span class="va">vertical</span>,length<span class="op">=</span><span class="fl">0.1</span>,col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">blue</span>,<span class="va">red</span><span class="op">)</span>,each<span class="op">=</span><span class="fl">2</span><span class="op">)</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">w</span><span class="op">[</span><span class="st">"j,1"</span><span class="op">]</span><span class="op">^</span><span class="op">{</span><span class="va">int</span><span class="op">}</span><span class="op">)</span>,x<span class="op">=</span><span class="va">pos</span><span class="op">$</span><span class="va">left</span><span class="op">-</span><span class="va">mar</span><span class="op">$</span><span class="va">horizontal</span><span class="op">-</span><span class="va">mar</span><span class="op">$</span><span class="va">dist</span>,y<span class="op">=</span><span class="va">pos</span><span class="op">$</span><span class="va">centre</span>,col<span class="op">=</span><span class="va">blue</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">w</span><span class="op">[</span><span class="st">"p+j,1"</span><span class="op">]</span><span class="op">^</span><span class="op">{</span><span class="va">int</span><span class="op">}</span><span class="op">)</span>,x<span class="op">=</span><span class="va">pos</span><span class="op">$</span><span class="va">left</span><span class="op">-</span><span class="va">mar</span><span class="op">$</span><span class="va">horizontal</span><span class="op">+</span><span class="va">mar</span><span class="op">$</span><span class="va">dist</span>,y<span class="op">=</span><span class="va">pos</span><span class="op">$</span><span class="va">centre</span>,col<span class="op">=</span><span class="va">blue</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">w</span><span class="op">[</span><span class="st">"j,1"</span><span class="op">]</span><span class="op">^</span><span class="op">{</span><span class="va">ext</span><span class="op">}</span><span class="op">)</span>,x<span class="op">=</span><span class="va">pos</span><span class="op">$</span><span class="va">left</span><span class="op">+</span><span class="va">mar</span><span class="op">$</span><span class="va">horizontal</span><span class="op">-</span><span class="va">mar</span><span class="op">$</span><span class="va">dist</span>,y<span class="op">=</span><span class="va">pos</span><span class="op">$</span><span class="va">centre</span>,col<span class="op">=</span><span class="va">red</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">w</span><span class="op">[</span><span class="st">"p+j,1"</span><span class="op">]</span><span class="op">^</span><span class="op">{</span><span class="va">ext</span><span class="op">}</span><span class="op">)</span>,x<span class="op">=</span><span class="va">pos</span><span class="op">$</span><span class="va">left</span><span class="op">+</span><span class="va">mar</span><span class="op">$</span><span class="va">horizontal</span><span class="op">+</span><span class="va">mar</span><span class="op">$</span><span class="va">dist</span>,y<span class="op">=</span><span class="va">pos</span><span class="op">$</span><span class="va">centre</span>,col<span class="op">=</span><span class="va">red</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">w</span><span class="op">[</span><span class="st">"j,2"</span><span class="op">]</span><span class="op">^</span><span class="op">{</span><span class="va">ext</span><span class="op">}</span><span class="op">)</span>,x<span class="op">=</span><span class="va">pos</span><span class="op">$</span><span class="va">right</span><span class="op">-</span><span class="va">mar</span><span class="op">$</span><span class="va">horizontal</span><span class="op">-</span><span class="va">mar</span><span class="op">$</span><span class="va">dist</span>,y<span class="op">=</span><span class="va">pos</span><span class="op">$</span><span class="va">centre</span>,col<span class="op">=</span><span class="va">blue</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">w</span><span class="op">[</span><span class="st">"p+j,2"</span><span class="op">]</span><span class="op">^</span><span class="op">{</span><span class="va">ext</span><span class="op">}</span><span class="op">)</span>,x<span class="op">=</span><span class="va">pos</span><span class="op">$</span><span class="va">right</span><span class="op">-</span><span class="va">mar</span><span class="op">$</span><span class="va">horizontal</span><span class="op">+</span><span class="va">mar</span><span class="op">$</span><span class="va">dist</span>,y<span class="op">=</span><span class="va">pos</span><span class="op">$</span><span class="va">centre</span>,col<span class="op">=</span><span class="va">blue</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">w</span><span class="op">[</span><span class="st">"j,2"</span><span class="op">]</span><span class="op">^</span><span class="op">{</span><span class="va">int</span><span class="op">}</span><span class="op">)</span>,x<span class="op">=</span><span class="va">pos</span><span class="op">$</span><span class="va">right</span><span class="op">+</span><span class="va">mar</span><span class="op">$</span><span class="va">horizontal</span><span class="op">-</span><span class="va">mar</span><span class="op">$</span><span class="va">dist</span>,y<span class="op">=</span><span class="va">pos</span><span class="op">$</span><span class="va">centre</span>,col<span class="op">=</span><span class="va">red</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">w</span><span class="op">[</span><span class="st">"p+j,2"</span><span class="op">]</span><span class="op">^</span><span class="op">{</span><span class="va">int</span><span class="op">}</span><span class="op">)</span>,x<span class="op">=</span><span class="va">pos</span><span class="op">$</span><span class="va">right</span><span class="op">+</span><span class="va">mar</span><span class="op">$</span><span class="va">horizontal</span><span class="op">+</span><span class="va">mar</span><span class="op">$</span><span class="va">dist</span>,y<span class="op">=</span><span class="va">pos</span><span class="op">$</span><span class="va">centre</span>,col<span class="op">=</span><span class="va">red</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/arrows.html" class="external-link">arrows</a></span><span class="op">(</span>x0<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">pos</span><span class="op">$</span><span class="va">left</span>,<span class="va">pos</span><span class="op">$</span><span class="va">right</span><span class="op">)</span>,y0<span class="op">=</span><span class="va">pos</span><span class="op">$</span><span class="va">centre</span><span class="op">-</span><span class="va">mar</span><span class="op">$</span><span class="va">vertical</span>,y1<span class="op">=</span><span class="va">pos</span><span class="op">$</span><span class="va">bottom</span><span class="op">+</span><span class="va">mar</span><span class="op">$</span><span class="va">vertical</span>,col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">blue</span>,<span class="va">red</span><span class="op">)</span>,length<span class="op">=</span><span class="fl">0.1</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html" class="external-link">hat</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span><span class="op">[</span><span class="st">"j,1"</span><span class="op">]</span><span class="op">^</span><span class="op">{</span><span class="va">final</span><span class="op">}</span><span class="op">==</span><span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html" class="external-link">hat</a></span><span class="op">(</span><span class="va">gamma</span><span class="op">)</span><span class="op">[</span><span class="st">"j,1"</span><span class="op">]</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html" class="external-link">hat</a></span><span class="op">(</span><span class="va">gamma</span><span class="op">)</span><span class="op">[</span><span class="st">"p+j,1"</span><span class="op">]</span><span class="op">)</span>,x<span class="op">=</span><span class="va">pos</span><span class="op">$</span><span class="va">left</span>,y<span class="op">=</span><span class="va">pos</span><span class="op">$</span><span class="va">bottom</span>,col<span class="op">=</span><span class="va">blue</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html" class="external-link">hat</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span><span class="op">[</span><span class="st">"j,2"</span><span class="op">]</span><span class="op">^</span><span class="op">{</span><span class="va">final</span><span class="op">}</span><span class="op">==</span><span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html" class="external-link">hat</a></span><span class="op">(</span><span class="va">gamma</span><span class="op">)</span><span class="op">[</span><span class="st">"j,2"</span><span class="op">]</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html" class="external-link">hat</a></span><span class="op">(</span><span class="va">gamma</span><span class="op">)</span><span class="op">[</span><span class="st">"p+j,2"</span><span class="op">]</span><span class="op">)</span>,x<span class="op">=</span><span class="va">pos</span><span class="op">$</span><span class="va">right</span>,y<span class="op">=</span><span class="va">pos</span><span class="op">$</span><span class="va">bottom</span>,col<span class="op">=</span><span class="va">red</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>x<span class="op">=</span><span class="op">-</span><span class="fl">0.1</span>,y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">pos</span><span class="op">$</span><span class="va">top</span>,<span class="va">pos</span><span class="op">$</span><span class="va">bottom</span><span class="op">)</span>,labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"stage"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>,font<span class="op">=</span><span class="fl">2</span>,cex<span class="op">=</span><span class="va">cex</span><span class="op">)</span></span>
<span><span class="fu">grDevices</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="simulation">Simulation<a class="anchor" aria-label="anchor" href="#simulation"></a>
</h2>
<p>This chunk performs the simulation.</p>
<ul>
<li><p>Requires: execution of chunk <code>setup</code></p></li>
<li><p>Execution time: <strong>0.5 hours</strong></p></li>
<li><p>Ensures: files <code>simulation_transfer.RData</code> (transfer
learning), <code>simulation_multiple.RData</code> (multi-task learning)
and <code>info_sim.txt</code> (session information) in folder
<code>results</code></p></li>
</ul>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#&lt;&lt;setup&gt;&gt;</span></span>
<span></span>
<span><span class="va">repetitions</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">mode</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"transfer"</span>,<span class="st">"multiple"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>prob.separate<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0</span>,<span class="fl">0.025</span>,<span class="fl">0.05</span><span class="op">)</span>,prob.common<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0</span>,<span class="fl">0.025</span>,<span class="fl">0.05</span><span class="op">)</span>,family<span class="op">=</span><span class="st">"gaussian"</span><span class="op">)</span></span>
<span>  <span class="va">grid</span> <span class="op">&lt;-</span> <span class="va">grid</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span><span class="op">)</span>,each<span class="op">=</span><span class="va">repetitions</span><span class="op">)</span>,<span class="op">]</span> <span class="co">#</span></span>
<span>  <span class="va">grid</span><span class="op">$</span><span class="va">seed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">grid</span><span class="op">$</span><span class="va">family</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">grid</span><span class="op">$</span><span class="va">family</span><span class="op">)</span></span>
<span>  <span class="va">deviance</span> <span class="op">&lt;-</span> <span class="va">auc</span> <span class="op">&lt;-</span> <span class="va">time</span> <span class="op">&lt;-</span> <span class="va">mse.coef</span> <span class="op">&lt;-</span> <span class="va">mse.zero</span> <span class="op">&lt;-</span> <span class="va">mse.nzero</span> <span class="op">&lt;-</span> <span class="va">sel.num</span> <span class="op">&lt;-</span> <span class="va">sel.coef</span> <span class="op">&lt;-</span> <span class="va">sel.count</span> <span class="op">&lt;-</span> <span class="va">hyperpar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="fl">1</span>,to<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span>seed<span class="op">=</span><span class="va">grid</span><span class="op">$</span><span class="va">seed</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"i="</span>,<span class="va">i</span>,<span class="st">"\n"</span><span class="op">)</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">mode</span><span class="op">==</span><span class="st">"transfer"</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_data_multi.html">sim_data_trans</a></span><span class="op">(</span>prob.common<span class="op">=</span><span class="va">grid</span><span class="op">$</span><span class="va">prob.common</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,prob.separate<span class="op">=</span><span class="va">grid</span><span class="op">$</span><span class="va">prob.separate</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,family<span class="op">=</span><span class="va">grid</span><span class="op">$</span><span class="va">family</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>      <span class="va">method</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"wrap_separate"</span>,<span class="st">"wrap_glmtrans"</span>,<span class="st">"sparselink"</span>,<span class="st">"wrap_xrnet"</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">mode</span><span class="op">==</span><span class="st">"multiple"</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="co">#--- multi-task learning ---</span></span>
<span>      <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_data_multi.html">sim_data_multi</a></span><span class="op">(</span>prob.common<span class="op">=</span><span class="va">grid</span><span class="op">$</span><span class="va">prob.common</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,prob.separate<span class="op">=</span><span class="va">grid</span><span class="op">$</span><span class="va">prob.separate</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,family<span class="op">=</span><span class="va">grid</span><span class="op">$</span><span class="va">family</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>      <span class="va">method</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"wrap_separate"</span>,<span class="st">"wrap_mgaussian"</span>,<span class="st">"sparselink"</span>,<span class="st">"wrap_spls"</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>    <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/traintest.html">traintest</a></span><span class="op">(</span>y_train<span class="op">=</span><span class="va">data</span><span class="op">$</span><span class="va">y_train</span>,X_train<span class="op">=</span><span class="va">data</span><span class="op">$</span><span class="va">X_train</span>,y_test<span class="op">=</span><span class="va">data</span><span class="op">$</span><span class="va">y_test</span>,X_test<span class="op">=</span><span class="va">data</span><span class="op">$</span><span class="va">X_test</span>,family<span class="op">=</span><span class="va">grid</span><span class="op">$</span><span class="va">family</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,method<span class="op">=</span><span class="va">method</span><span class="op">)</span></span>
<span>    <span class="va">hyperpar</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">hyperpar</span></span>
<span>    <span class="va">time</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">time</span></span>
<span>    <span class="va">auc</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">auc</span></span>
<span>    <span class="va">deviance</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">deviance</span></span>
<span>    <span class="va">sel.num</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">coef</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">x</span><span class="op">!=</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">sel.count</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">coef</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="fu"><a href="../reference/count_vector.html">count_matrix</a></span><span class="op">(</span>truth<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sign.html" class="external-link">sign</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">beta</span><span class="op">)</span>,estim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sign.html" class="external-link">sign</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co"># Add na.rm=TRUE?</span></span>
<span>    </span>
<span>    <span class="va">sel.coef</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">coef</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sign.html" class="external-link">sign</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">!=</span><span class="fu"><a href="https://rdrr.io/r/base/sign.html" class="external-link">sign</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">beta</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="co"># CONTINUE HERE: consider sparsity, true positives, false negatives, signs</span></span>
<span>    </span>
<span>    <span class="va">mse.coef</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">coef</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">beta</span><span class="op">-</span><span class="va">x</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">mse.zero</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">coef</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="op">(</span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">beta</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">beta</span><span class="op">-</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">mse.nzero</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">coef</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="op">(</span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">beta</span><span class="op">!=</span><span class="fl">0</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">beta</span><span class="op">-</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">grid</span>,<span class="va">deviance</span>,<span class="va">auc</span>,<span class="va">sel.num</span>,<span class="va">sel.count</span>,<span class="va">sel.coef</span>,<span class="va">mse.coef</span>,<span class="va">mse.zero</span>,<span class="va">mse.nzero</span>,<span class="va">time</span>,file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">"results"</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"simulation_"</span>,<span class="va">mode</span>,<span class="st">".RData"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span>text<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/utils/capture.output.html" class="external-link">capture.output</a></span><span class="op">(</span><span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span>,      <span class="fu">sessioninfo</span><span class="fu">::</span><span class="fu"><a href="https://sessioninfo.r-lib.org/reference/session_info.html" class="external-link">session_info</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,con<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">"/results/info_sim.txt"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The following chunk generate the figures for the simulation
study.</p>
<ul>
<li><p>Requires: execution of chunk <code>setup</code>, files
<code>simulation_transfer.RData</code> and
<code>simulation_multiple.RData</code> in folder <code>results</code>
(generated by chunk <code>simulation</code>)</p></li>
<li><p>execution time: <span class="math inline">\(1\)</span>
second</p></li>
<li><p>Ensures: files <code>fig_sim_multiple.eps</code> and
<code>fig_sim_transfer.eps</code> in folder
<code>manuscript</code></p></li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#&lt;&lt;setup&gt;&gt;</span></span>
<span></span>
<span><span class="va">caption</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"\\textbf{Multi-task learning.}"</span>,<span class="st">"\\textbf{Transfer learning.}"</span><span class="op">)</span>,<span class="st">"Comparison of different measures (rows) between an available method (red) and the proposed method (blue) in different simulation settings (columns), based on the average of three problems"</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"(tasks)"</span>,<span class="st">"(datasets)"</span><span class="op">)</span>,<span class="st">"for each repetition out of ten. Measures: performance metric (mean squared error on hold-out data, as a fraction of the one from standard lasso regression; a point below the dashed line means that"</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"multi-task"</span>,<span class="st">"transfer"</span><span class="op">)</span>,<span class="st">"learning improves predictions), sparsity (number of non-zero coefficients), precision (number of coefficients with correct signs divided by number of non-zero coefficients). The arrows point in the direction of improvement. Settings: percentage of features with a common effect for all problems ($\\pi_\\theta$), percentage of features with a specific effect for each problem ($\\pi_\\delta$)."</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"\\label{fig_sim_multiple}"</span>,<span class="st">"\\label{fig_sim_transfer}"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">figure_change</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">model0</span>,<span class="va">model1</span><span class="op">=</span><span class="st">"sparselink"</span>,<span class="va">model2</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">mode</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fl">100</span><span class="op">*</span><span class="va">grid</span><span class="op">$</span><span class="va">prob.common</span>,<span class="st">"%\n"</span>,<span class="fl">100</span><span class="op">*</span><span class="va">grid</span><span class="op">$</span><span class="va">prob.separate</span>,<span class="st">"%"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">1</span><span class="op">)</span>,mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">label</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">cex</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span>
<span>    <span class="va">at</span> <span class="op">&lt;-</span> <span class="fl">0.3</span></span>
<span>    <span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span>text<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">pi</span><span class="op">[</span><span class="va">theta</span><span class="op">]</span><span class="op">==</span><span class="fu">phantom</span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span>,side<span class="op">=</span><span class="fl">1</span>,line<span class="op">=</span><span class="fl">0.2</span>,at<span class="op">=</span><span class="va">at</span>,cex<span class="op">=</span><span class="va">cex</span><span class="op">)</span></span>
<span>    <span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span>text<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">pi</span><span class="op">[</span><span class="va">delta</span><span class="op">]</span><span class="op">==</span><span class="fu">phantom</span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span>,side<span class="op">=</span><span class="fl">1</span>,line<span class="op">=</span><span class="fl">1.2</span>,at<span class="op">=</span><span class="va">at</span>,cex<span class="op">=</span><span class="va">cex</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co">#--- predictive performance ---</span></span>
<span>  <span class="va">means</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">deviance</span>,FUN<span class="op">=</span><span class="va">rowMeans</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">means</span> <span class="op">&lt;-</span> <span class="va">means</span><span class="op">/</span><span class="va">means</span><span class="op">[</span>,<span class="st">"wrap_separate"</span><span class="op">]</span></span>
<span>  <span class="fu"><a href="../reference/plot_change.html">plot_change</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">mode</span>,y0<span class="op">=</span><span class="va">means</span><span class="op">[</span>,<span class="va">model0</span><span class="op">]</span>,y1<span class="op">=</span><span class="va">means</span><span class="op">[</span>,<span class="va">model1</span><span class="op">]</span>,y2<span class="op">=</span><span class="va">means</span><span class="op">[</span>,<span class="va">model2</span><span class="op">]</span>,main<span class="op">=</span><span class="st">"metric"</span>,increase<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="fl">1</span>,lty<span class="op">=</span><span class="fl">2</span>,col<span class="op">=</span><span class="st">"grey"</span><span class="op">)</span></span>
<span>  <span class="fu">label</span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">#--- sparsity ---</span></span>
<span>  <span class="va">nzero</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">sel.num</span>,FUN<span class="op">=</span><span class="va">rowMeans</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/plot_change.html">plot_change</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">mode</span>,y0<span class="op">=</span><span class="va">nzero</span><span class="op">[</span><span class="va">model0</span>,<span class="op">]</span>,y1<span class="op">=</span><span class="va">nzero</span><span class="op">[</span><span class="va">model1</span>,<span class="op">]</span>,y2<span class="op">=</span><span class="va">nzero</span><span class="op">[</span><span class="va">model2</span>,<span class="op">]</span>,main<span class="op">=</span><span class="st">"sparsity"</span>,increase<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="fl">0</span>,lty<span class="op">=</span><span class="fl">2</span>,col<span class="op">=</span><span class="st">"grey"</span><span class="op">)</span></span>
<span>  <span class="fu">label</span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">#--- precision ---</span></span>
<span>  <span class="va">precision</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">sel.count</span>,FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span>,<span class="st">"precision"</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">precision</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">precision</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>  <span class="fu"><a href="../reference/plot_change.html">plot_change</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">mode</span>,y0<span class="op">=</span><span class="va">precision</span><span class="op">[</span><span class="va">model0</span>,<span class="op">]</span>,y1<span class="op">=</span><span class="va">precision</span><span class="op">[</span><span class="va">model1</span>,<span class="op">]</span>,y2<span class="op">=</span><span class="va">precision</span><span class="op">[</span><span class="va">model2</span>,<span class="op">]</span>,main<span class="op">=</span><span class="st">"precision"</span>,increase<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="fl">0</span>,lty<span class="op">=</span><span class="fl">2</span>,col<span class="op">=</span><span class="st">"grey"</span><span class="op">)</span></span>
<span>  <span class="fu">label</span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">grDevices</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grDevices/postscript.html" class="external-link">postscript</a></span><span class="op">(</span>file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">"manuscript"</span>,<span class="st">"fig_sim_multiple.eps"</span><span class="op">)</span>,width<span class="op">=</span><span class="fl">6.5</span>,height<span class="op">=</span><span class="fl">6</span>,horizontal<span class="op">=</span><span class="cn">FALSE</span>,onefile<span class="op">=</span><span class="cn">FALSE</span>,paper<span class="op">=</span><span class="st">"special"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"results/simulation_multiple.RData"</span><span class="op">)</span><span class="op">)</span>,verbose<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#model.ref &lt;- "wrap_mgaussian"</span></span>
<span><span class="co">#model.own &lt;- "sparselink"</span></span>
<span><span class="fu">figure_change</span><span class="op">(</span>model0<span class="op">=</span><span class="st">"wrap_mgaussian"</span>,model1<span class="op">=</span><span class="st">"sparselink"</span>,model2<span class="op">=</span><span class="st">"wrap_spls"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">deviance</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/rank.html" class="external-link">rank</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">deviance</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">/</span><span class="va">x</span><span class="op">[</span><span class="st">"wrap_separate"</span>,<span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">runtime</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">time</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">runtime</span><span class="op">/</span><span class="va">runtime</span><span class="op">[</span><span class="st">"wrap_separate"</span><span class="op">]</span>,digits<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu">grDevices</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">grDevices</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grDevices/postscript.html" class="external-link">postscript</a></span><span class="op">(</span>file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">"manuscript"</span>,<span class="st">"fig_sim_transfer.eps"</span><span class="op">)</span>,width<span class="op">=</span><span class="fl">6.5</span>,height<span class="op">=</span><span class="fl">6</span>,horizontal<span class="op">=</span><span class="cn">FALSE</span>,onefile<span class="op">=</span><span class="cn">FALSE</span>,paper<span class="op">=</span><span class="st">"special"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"results/simulation_transfer.RData"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#model.ref &lt;- "wrap_glmtrans"</span></span>
<span><span class="co">#model.own &lt;- "sparselink"</span></span>
<span><span class="fu">figure_change</span><span class="op">(</span>model0<span class="op">=</span><span class="st">"wrap_glmtrans"</span>,model1<span class="op">=</span><span class="st">"sparselink"</span>,model2<span class="op">=</span><span class="st">"wrap_xrnet"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">deviance</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/rank.html" class="external-link">rank</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">deviance</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">/</span><span class="va">x</span><span class="op">[</span><span class="st">"wrap_separate"</span>,<span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">runtime</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">time</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">runtime</span><span class="op">/</span><span class="va">runtime</span><span class="op">[</span><span class="st">"wrap_separate"</span><span class="op">]</span>,digits<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu">grDevices</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="sample-size-and-sparsity-revision">Sample size and sparsity (revision)<a class="anchor" aria-label="anchor" href="#sample-size-and-sparsity-revision"></a>
</h3>
<p>This chunk performs the additional simulation.</p>
<ul>
<li><p>Requires: execution of chunk <code>setup</code></p></li>
<li><p>Execution time: <strong>3 hours</strong></p></li>
<li><p>Ensures: files <code>simulation_extra.RData</code> and
<code>info_sim_extra.txt</code> (session information) in folder
<code>results</code></p></li>
</ul>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Effect of sample size in source or target dataset (TL), effect of sample size (MTL).</span></span>
<span><span class="co">#&lt;&lt;setup&gt;&gt;</span></span>
<span></span>
<span><span class="va">repetitions</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span><span class="va">grid</span> <span class="op">&lt;-</span> <span class="va">metric</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">mode</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MTL-size"</span>,<span class="st">"TL-source"</span>,<span class="st">"TL-target"</span>,<span class="st">"TL-prop"</span>,<span class="st">"MTL-prop"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span> <span class="co">#</span></span>
<span>  <span class="va">metric</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">cand</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>,<span class="fl">40</span>,<span class="fl">60</span>,<span class="fl">80</span>,<span class="fl">100</span><span class="op">)</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">mode</span><span class="op">==</span><span class="st">"MTL-size"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>prob.common<span class="op">=</span><span class="fl">0.05</span>,prob.separate<span class="op">=</span><span class="fl">0.025</span>,family<span class="op">=</span><span class="st">"gaussian"</span>,n0<span class="op">=</span><span class="va">cand</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">mode</span><span class="op">==</span><span class="st">"TL-source"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>prob.common<span class="op">=</span><span class="fl">0.05</span>,prob.separate<span class="op">=</span><span class="fl">0.025</span>,family<span class="op">=</span><span class="st">"gaussian"</span>,n_source<span class="op">=</span><span class="va">cand</span>,n_target<span class="op">=</span><span class="fl">50</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">mode</span><span class="op">==</span><span class="st">"TL-target"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>prob.common<span class="op">=</span><span class="fl">0.05</span>,prob.separate<span class="op">=</span><span class="fl">0.025</span>,family<span class="op">=</span><span class="st">"gaussian"</span>,n_source<span class="op">=</span><span class="fl">50</span>,n_target<span class="op">=</span><span class="va">cand</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">mode</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TL-prop"</span>,<span class="st">"MTL-prop"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">cand</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>,<span class="fl">0.05</span>,<span class="fl">0.10</span>,<span class="fl">0.15</span>,<span class="fl">0.20</span><span class="op">)</span></span>
<span>    <span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>prob.common<span class="op">=</span><span class="va">cand</span>,prob.separate<span class="op">=</span><span class="cn">NA</span>,family<span class="op">=</span><span class="st">"gaussian"</span>,n_source<span class="op">=</span><span class="fl">50</span>,n_target<span class="op">=</span><span class="fl">50</span>,n0<span class="op">=</span><span class="fl">50</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Wrong mode."</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,each<span class="op">=</span><span class="va">repetitions</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  <span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">seed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">repetitions</span><span class="op">)</span>,times<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">cand</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">family</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">family</span><span class="op">)</span></span>
<span>  <span class="va">cond</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">prob.separate</span><span class="op">)</span></span>
<span>  <span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">prob.separate</span><span class="op">[</span><span class="va">cond</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.5</span><span class="op">*</span><span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">prob.common</span><span class="op">[</span><span class="va">cond</span><span class="op">]</span> <span class="co"># This means that there are twice more shared effects than specific effects. Otherwise, the competing methods might not work well.</span></span>
<span>  </span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="fl">1</span>,to<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span>seed<span class="op">=</span><span class="va">grid</span><span class="op">$</span><span class="va">seed</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"i="</span>,<span class="va">i</span>,<span class="st">"\n"</span><span class="op">)</span></span>
<span>      <span class="kw">if</span><span class="op">(</span><span class="va">mode</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TL-source"</span>,<span class="st">"TL-target"</span>,<span class="st">"TL-prop"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="va">n0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">n_source</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,<span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">n_target</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>,times<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_data_multi.html">sim_data_trans</a></span><span class="op">(</span>prob.common<span class="op">=</span><span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">prob.common</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,prob.separate<span class="op">=</span><span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">prob.separate</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,family<span class="op">=</span><span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">family</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,n0<span class="op">=</span><span class="va">n0</span><span class="op">)</span></span>
<span>        <span class="va">method</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"wrap_separate"</span>,<span class="st">"wrap_glmtrans"</span>,<span class="st">"sparselink"</span>,<span class="st">"wrap_xrnet"</span><span class="op">)</span></span>
<span>      <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">mode</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MTL-size"</span>,<span class="st">"MTL-prop"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_data_multi.html">sim_data_multi</a></span><span class="op">(</span>prob.common<span class="op">=</span><span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">prob.common</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,prob.separate<span class="op">=</span><span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">prob.separate</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,family<span class="op">=</span><span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">family</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,n0<span class="op">=</span><span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">n0</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>        <span class="va">method</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"wrap_separate"</span>,<span class="st">"wrap_mgaussian"</span>,<span class="st">"sparselink"</span>,<span class="st">"wrap_spls"</span><span class="op">)</span></span>
<span>      <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Wrong mode."</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>      <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/traintest.html">traintest</a></span><span class="op">(</span>y_train<span class="op">=</span><span class="va">data</span><span class="op">$</span><span class="va">y_train</span>,X_train<span class="op">=</span><span class="va">data</span><span class="op">$</span><span class="va">X_train</span>,y_test<span class="op">=</span><span class="va">data</span><span class="op">$</span><span class="va">y_test</span>,X_test<span class="op">=</span><span class="va">data</span><span class="op">$</span><span class="va">X_test</span>,family<span class="op">=</span><span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">family</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,method<span class="op">=</span><span class="va">method</span><span class="op">)</span></span>
<span>      <span class="va">metric</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">deviance</span></span>
<span>    <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">grid</span>,<span class="va">metric</span>,file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">"results"</span>,<span class="st">"simulation_extra.RData"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span>text<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/utils/capture.output.html" class="external-link">capture.output</a></span><span class="op">(</span><span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span>,      <span class="fu">sessioninfo</span><span class="fu">::</span><span class="fu"><a href="https://sessioninfo.r-lib.org/reference/session_info.html" class="external-link">session_info</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,con<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">"/results/info_sim_extra.txt"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The following chunk generate the figure for the additional simulation
study.</p>
<ul>
<li><p>Requires: execution of chunk <code>setup</code>, file
<code>simulation_extra.RData</code> in folder <code>results</code>
(generated by chunk <code>simulation_extra</code>)</p></li>
<li><p>execution time: <span class="math inline">\(1\)</span>
second</p></li>
<li><p>Ensures: file <code>fig_sim_extra.eps</code> in folder
<code>manuscript</code></p></li>
</ul>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#&lt;&lt;setup&gt;&gt;</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">"results"</span>,<span class="st">"simulation_extra.RData"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">grDevices</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grDevices/postscript.html" class="external-link">postscript</a></span><span class="op">(</span>file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">"manuscript"</span>,<span class="st">"fig_sim_extra.eps"</span><span class="op">)</span>,width<span class="op">=</span><span class="fl">6.5</span>,height<span class="op">=</span><span class="fl">3</span>,horizontal<span class="op">=</span><span class="cn">FALSE</span>,onefile<span class="op">=</span><span class="cn">FALSE</span>,paper<span class="op">=</span><span class="st">"special"</span><span class="op">)</span></span>
<span><span class="va">cex</span> <span class="op">&lt;-</span> <span class="fl">0.8</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>,mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4.5</span>,<span class="fl">4.5</span>,<span class="fl">1.5</span>,<span class="fl">1</span><span class="op">)</span>,oma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#graphics::layout(mat=matrix(data=c(1,1,2,2,3,3,0,4,4,0,5,5),ncol=2))</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">mode</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MTL-size"</span>,<span class="st">"TL-source"</span>,<span class="st">"TL-target"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span><span class="co">#for(mode in c("MTL-prop","TL-prop")){</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">mode</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MTL-size"</span>,<span class="st">"MTL-prop"</span>,<span class="st">"TL-prop"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">mse</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">metric</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">mode</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TL-source"</span>,<span class="st">"TL-target"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">mse</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">metric</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">mode</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TL-source"</span>,<span class="st">"TL-target"</span>,<span class="st">"TL-prop"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"wrap_separate"</span><span class="op">=</span><span class="st">"black"</span>,<span class="st">"wrap_glmtrans"</span><span class="op">=</span><span class="st">"red"</span>,<span class="st">"wrap_xrnet"</span><span class="op">=</span><span class="st">"orange"</span>,<span class="st">"sparselink"</span><span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></span>
<span>    <span class="va">lty</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"wrap_separate"</span><span class="op">=</span><span class="fl">3</span>,<span class="st">"wrap_glmtrans"</span><span class="op">=</span><span class="fl">2</span>,<span class="st">"wrap_xrnet"</span><span class="op">=</span><span class="fl">2</span>,<span class="st">"sparselink"</span><span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">mode</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MTL-size"</span>,<span class="st">"MTL-prop"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"wrap_separate"</span><span class="op">=</span><span class="st">"black"</span>,<span class="st">"wrap_mgaussian"</span><span class="op">=</span><span class="st">"red"</span>,<span class="st">"wrap_spls"</span><span class="op">=</span><span class="st">"orange"</span>,<span class="st">"sparselink"</span><span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></span>
<span>    <span class="va">lty</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"wrap_separate"</span><span class="op">=</span><span class="fl">3</span>,<span class="st">"wrap_mgaussian"</span><span class="op">=</span><span class="fl">2</span>,<span class="st">"wrap_spls"</span><span class="op">=</span><span class="fl">2</span>,<span class="st">"sparselink"</span><span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">mode</span><span class="op">==</span><span class="st">"TL-source"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">params</span> <span class="op">&lt;-</span> <span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">n_source</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">mode</span><span class="op">==</span><span class="st">"TL-target"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">params</span> <span class="op">&lt;-</span> <span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">n_target</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">mode</span><span class="op">==</span><span class="st">"MTL-size"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">params</span> <span class="op">&lt;-</span> <span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">n0</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">mode</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TL-prop"</span>,<span class="st">"MTL-prop"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">params</span> <span class="op">&lt;-</span> <span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">prob.common</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">unique</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span></span>
<span>  <span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/frame.html" class="external-link">plot.new</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.window.html" class="external-link">plot.window</a></span><span class="op">(</span>xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">mse</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/box.html" class="external-link">box</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">mode</span><span class="op">==</span><span class="st">"MTL-size"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">main</span> <span class="op">&lt;-</span> <span class="st">"MTL - varying sample size"</span></span>
<span>    <span class="va">xlab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote</a></span><span class="op">(</span><span class="st">"sample size ("</span><span class="op">~</span><span class="va">n</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">~</span><span class="st">"="</span><span class="op">~</span><span class="va">n</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">~</span><span class="st">"="</span><span class="op">~</span><span class="va">n</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">~</span><span class="st">")"</span><span class="op">)</span></span>
<span>    <span class="va">legend</span> <span class="op">&lt;-</span> <span class="st">""</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">mode</span><span class="op">==</span><span class="st">"TL-source"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">main</span> <span class="op">&lt;-</span> <span class="st">"TL - varying source sample size"</span></span>
<span>    <span class="va">xlab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote</a></span><span class="op">(</span><span class="st">"source sample size ("</span><span class="op">~</span><span class="va">n</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">~</span><span class="st">"="</span><span class="op">~</span><span class="va">n</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">~</span><span class="st">")"</span><span class="op">)</span></span>
<span>    <span class="va">legend</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote</a></span><span class="op">(</span><span class="st">"target sample size:"</span><span class="op">~</span><span class="va">n</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">==</span><span class="fu">.</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">n_target</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">mode</span><span class="op">==</span><span class="st">"TL-target"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">main</span> <span class="op">&lt;-</span> <span class="st">"TL - varying target sample size"</span></span>
<span>    <span class="va">xlab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote</a></span><span class="op">(</span><span class="st">"target sample size ("</span><span class="op">~</span><span class="va">n</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">~</span><span class="st">")"</span><span class="op">)</span></span>
<span>    <span class="va">legend</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote</a></span><span class="op">(</span><span class="st">"source sample size:"</span><span class="op">~</span><span class="va">n</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">~</span><span class="st">"="</span><span class="op">~</span><span class="va">n</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">==</span><span class="fu">.</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">n_source</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">mode</span><span class="op">==</span><span class="st">"MTL-prop"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">xlab</span> <span class="op">&lt;-</span> <span class="st">"blabla"</span></span>
<span>    <span class="va">main</span> <span class="op">&lt;-</span> <span class="st">"MTL - effect proportion"</span></span>
<span>    <span class="va">legend</span> <span class="op">&lt;-</span> <span class="st">""</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">mode</span><span class="op">==</span><span class="st">"TL-prop"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">xlab</span> <span class="op">&lt;-</span> <span class="st">"blabla"</span></span>
<span>    <span class="va">main</span> <span class="op">&lt;-</span> <span class="st">"TL - effect proportion"</span></span>
<span>    <span class="va">legend</span> <span class="op">&lt;-</span> <span class="st">""</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span>main<span class="op">=</span><span class="va">main</span>,cex.main<span class="op">=</span><span class="va">cex</span><span class="op">)</span></span>
<span>  <span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span>ylab<span class="op">=</span><span class="st">"log MSE"</span>,line<span class="op">=</span><span class="fl">2.5</span>,xlab<span class="op">=</span><span class="va">xlab</span>,cex.lab<span class="op">=</span><span class="va">cex</span><span class="op">)</span></span>
<span>  <span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">"topleft"</span>,legend<span class="op">=</span><span class="va">legend</span>,bty<span class="op">=</span><span class="st">"n"</span>,cex<span class="op">=</span><span class="va">cex</span><span class="op">)</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">mode</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TL-prop"</span>,<span class="st">"MTL-prop"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span>side<span class="op">=</span><span class="fl">1</span>,at<span class="op">=</span><span class="va">unique</span>,labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fl">100</span><span class="op">*</span><span class="va">unique</span>,<span class="st">"%"</span><span class="op">)</span>,cex.axis<span class="op">=</span><span class="va">cex</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span>side<span class="op">=</span><span class="fl">1</span>,at<span class="op">=</span><span class="va">unique</span>,cex.axis<span class="op">=</span><span class="va">cex</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span>side<span class="op">=</span><span class="fl">2</span>,cex.axis<span class="op">=</span><span class="va">cex</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">col</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">val</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">mse</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span>,INDEX<span class="op">=</span><span class="va">params</span>,FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">unique</span>,y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">val</span><span class="op">)</span>,col<span class="op">=</span><span class="va">col</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,type<span class="op">=</span><span class="st">"o"</span>,pch<span class="op">=</span><span class="fl">16</span>,lty<span class="op">=</span><span class="va">lty</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">grDevices</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="application">Application<a class="anchor" aria-label="anchor" href="#application"></a>
</h2>
<div class="section level3">
<h3 id="data-preparation">Data preparation<a class="anchor" aria-label="anchor" href="#data-preparation"></a>
</h3>
<p>This chunk defines the references and the project identifiers for the
application.</p>
<ul>
<li><p>Requires: nothing</p></li>
<li><p>Execution time: <span class="math inline">\(1\)</span>
second</p></li>
<li><p>Ensures: list <code>project</code> in working
environment</p></li>
</ul>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">project</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">project</span><span class="op">$</span><span class="va">IBD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Tew (2016)"</span><span class="op">=</span><span class="st">"SRP063496"</span>,</span>
<span>                 <span class="st">"Haberman (2019)"</span><span class="op">=</span><span class="st">"SRP129004"</span>,</span>
<span>                 <span class="st">"Verstockt (2019)"</span><span class="op">=</span><span class="st">"ERP113396"</span>,</span>
<span>                 <span class="st">"Verstockt (2020)"</span><span class="op">=</span><span class="st">"ERP114636"</span>,</span>
<span>                 <span class="st">"Boyd (2018)"</span><span class="op">=</span><span class="st">"SRP100787"</span><span class="op">)</span></span>
<span><span class="va">project</span><span class="op">$</span><span class="va">RA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Baker (2019)"</span><span class="op">=</span><span class="st">"SRP169062"</span>,</span>
<span>                <span class="st">"Moncrieffe (2017)"</span><span class="op">=</span><span class="st">"SRP074736"</span>,</span>
<span>                <span class="st">"Goldberg (2018)"</span><span class="op">=</span><span class="st">"SRP155483"</span><span class="op">)</span></span>
<span><span class="va">extra</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Lewis (2019)"</span><span class="op">=</span><span class="st">"ERP104864"</span><span class="op">)</span> <span class="co"># https://doi.org/10.1016/j.celrep.2019.07.091</span></span></code></pre></div>
<p>This chunk downloads the data for the application.</p>
<ul>
<li><p>Requires: execution of chunks <code>setup</code> and
<code>define_projects</code></p></li>
<li><p>Execution time: depends on internet speed and cached
files</p></li>
<li><p>Ensures: files <code>recount3_data.RData</code> (data sets) and
<code>info_data.txt</code> (system information) in folder
<code>results</code></p></li>
</ul>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#&lt;&lt;setup&gt;&gt;</span></span>
<span><span class="co">#&lt;&lt;define_projects&gt;&gt;</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">project</span><span class="op">)</span>,<span class="va">extra</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">data</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">recount3</span><span class="fu">::</span><span class="fu">create_rse_manual</span><span class="op">(</span></span>
<span>    project<span class="op">=</span><span class="va">i</span>,</span>
<span>    project_home<span class="op">=</span><span class="st">"data_sources/sra"</span>,</span>
<span>    organism<span class="op">=</span><span class="st">"human"</span>,</span>
<span>    annotation <span class="op">=</span> <span class="st">"gencode_v26"</span>,</span>
<span>    type<span class="op">=</span><span class="st">"gene"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">data</span>,file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">"results/recount3_data.RData"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span>text<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/utils/capture.output.html" class="external-link">capture.output</a></span><span class="op">(</span><span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span>,</span>
<span>      <span class="fu">sessioninfo</span><span class="fu">::</span><span class="fu"><a href="https://sessioninfo.r-lib.org/reference/session_info.html" class="external-link">session_info</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,con<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">"/results/info_data.txt"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>This chunk preprocesses the data.</p>
<ul>
<li><p>Requires: execution of chunks <code>setup</code> and
<code>define_projects</code>, file <code>recount3_data.RData</code>
(generated by chunk <code>download_data</code>)</p></li>
<li><p>Execution time: <span class="math inline">\(5\)</span>
seconds</p></li>
<li><p>Ensures: lists <code>y</code> (targets) and <code>x</code>
(features) in working environment</p></li>
</ul>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#&lt;&lt;setup&gt;&gt;</span></span>
<span><span class="co">#&lt;&lt;define_projects&gt;&gt;</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">"results/recount3_data.RData"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#- - - - - - - - - - - - - - -</span></span>
<span><span class="co">#- - - extract features  - - - </span></span>
<span><span class="co">#- - - - - - - - - - - - - - -</span></span>
<span></span>
<span><span class="co"># extract features</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">project</span><span class="op">)</span>,<span class="va">extra</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu">SummarizedExperiment</span><span class="fu">::</span><span class="fu">assays</span><span class="op">(</span><span class="va">data</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">$</span><span class="va">raw_counts</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">counts</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">SummarizedExperiment</span><span class="fu">::</span><span class="fu">rowRanges</span><span class="op">(</span><span class="va">data</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">$</span><span class="va">gene_name</span></span>
<span>  <span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">counts</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># select most expressed protein-coding genes (for all TL projects together)</span></span>
<span><span class="va">select</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">total</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">project</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co">#total &lt;- rbind(total,Matrix::colSums(x[[i]])) # original: mean filtering</span></span>
<span>  <span class="va">total</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">total</span>,<span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,MARGIN<span class="op">=</span><span class="fl">2</span>,FUN<span class="op">=</span><span class="fu">stats</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">)</span><span class="op">)</span> <span class="co"># trial: variance filtering</span></span>
<span><span class="op">}</span></span>
<span><span class="va">type</span> <span class="op">&lt;-</span> <span class="fu">SummarizedExperiment</span><span class="fu">::</span><span class="fu">rowData</span><span class="op">(</span><span class="va">data</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">$</span><span class="va">gene_type</span></span>
<span><span class="va">cond</span> <span class="op">&lt;-</span> <span class="va">type</span><span class="op">==</span><span class="st">"protein_coding"</span></span>
<span><span class="va">total</span><span class="op">[</span>,<span class="op">!</span><span class="va">cond</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">rank</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">total</span>,MARGIN<span class="op">=</span><span class="fl">1</span>,FUN<span class="op">=</span><span class="va">rank</span><span class="op">)</span></span>
<span><span class="va">mean_rank</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">rank</span><span class="op">)</span></span>
<span><span class="co">#temp &lt;- cond &amp; apply(total,2,function(x) all(x&gt;0)) &amp; (mean_rank &gt;= sort(mean_rank[cond],decreasing=TRUE)[2000]) # original: top 2000</span></span>
<span><span class="va">temp</span> <span class="op">&lt;-</span> <span class="va">cond</span> <span class="op">&amp;</span> <span class="va">mean_rank</span> <span class="op">&gt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">mean_rank</span><span class="op">[</span><span class="va">cond</span><span class="op">]</span>,decreasing<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">[</span><span class="fl">5000</span><span class="op">]</span> <span class="co"># trial: top 5000</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">project</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">select</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">temp</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># select most expressed protein-coding genes (for MTL project)</span></span>
<span><span class="co">#mean &lt;- apply(X=x[[extra]],MARGIN=2,FUN=mean) # original</span></span>
<span><span class="va">var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">x</span><span class="op">[[</span><span class="va">extra</span><span class="op">]</span><span class="op">]</span>,MARGIN<span class="op">=</span><span class="fl">2</span>,FUN<span class="op">=</span><span class="va">var</span><span class="op">)</span> <span class="co"># trial</span></span>
<span><span class="co">#warning("change number in next line")</span></span>
<span><span class="co">#temp &lt;- cond &amp; mean &gt;= sort(mean[cond],decreasing=TRUE)[5000] # trial: top 5000</span></span>
<span><span class="va">temp</span> <span class="op">&lt;-</span> <span class="va">cond</span> <span class="op">&amp;</span> <span class="va">var</span> <span class="op">&gt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">var</span><span class="op">[</span><span class="va">cond</span><span class="op">]</span>,decreasing<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">[</span><span class="fl">5000</span><span class="op">]</span> <span class="co"># trial: top 5000</span></span>
<span><span class="va">select</span><span class="op">[[</span><span class="va">extra</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">temp</span></span>
<span></span>
<span><span class="co"># pre-processing</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">project</span><span class="op">)</span>,<span class="va">extra</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">lib.size</span> <span class="op">&lt;-</span> <span class="fu">Matrix</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums-methods.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="va">select</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,drop<span class="op">=</span><span class="cn">FALSE</span><span class="op">]</span></span>
<span>  <span class="va">norm.factors</span> <span class="op">&lt;-</span> <span class="fu">edgeR</span><span class="fu">::</span><span class="fu">calcNormFactors</span><span class="op">(</span>object<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,lib.size<span class="op">=</span><span class="va">lib.size</span><span class="op">)</span></span>
<span>  <span class="va">gamma</span> <span class="op">&lt;-</span> <span class="va">norm.factors</span><span class="op">*</span><span class="va">lib.size</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">lib.size</span><span class="op">)</span></span>
<span>  <span class="va">gamma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">gamma</span>,nrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,ncol<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">/</span><span class="va">gamma</span></span>
<span>  <span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="fl">3</span><span class="op">/</span><span class="fl">8</span><span class="op">)</span> <span class="co"># Anscombe transform</span></span>
<span>  <span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="co"># scale because of different datasets!?</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#- - - - - - - - - - - - - -</span></span>
<span><span class="co">#- - - extract targets - - -</span></span>
<span><span class="co">#- - - - - - - - - - - - - -</span></span>
<span></span>
<span><span class="co"># extract information on samples</span></span>
<span><span class="va">frame</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">project</span><span class="op">)</span>,<span class="va">extra</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="va">data</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sra.sample_attributes</span>,split<span class="op">=</span><span class="st">"\\|"</span><span class="op">)</span></span>
<span>  <span class="va">data</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sra.experiment_attributes</span></span>
<span>  <span class="co"># What about sra.experiment_attributes?</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">list</span><span class="op">)</span></span>
<span>  <span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">list</span><span class="op">)</span>,split<span class="op">=</span><span class="st">";;"</span><span class="op">)</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">ncol</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">cols</span><span class="op">)</span></span>
<span>  <span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data<span class="op">=</span><span class="cn">NA</span>,nrow<span class="op">=</span><span class="va">n</span>,ncol<span class="op">=</span><span class="va">ncol</span>,dimnames<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,<span class="va">cols</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw">for</span><span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">ncol</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="va">vector</span> <span class="op">&lt;-</span> <span class="va">list</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span></span>
<span>      <span class="va">which</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substring</a></span><span class="op">(</span>text<span class="op">=</span><span class="va">vector</span>,first<span class="op">=</span><span class="fl">1</span>,last<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="va">cols</span><span class="op">[</span><span class="va">k</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">==</span><span class="va">cols</span><span class="op">[</span><span class="va">k</span><span class="op">]</span><span class="op">)</span></span>
<span>      <span class="va">string</span> <span class="op">&lt;-</span> <span class="va">vector</span><span class="op">[</span><span class="va">which</span><span class="op">]</span></span>
<span>      <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">string</span><span class="op">)</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span><span class="kw">next</span><span class="op">}</span></span>
<span>      <span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">j</span>,<span class="va">k</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="va">string</span>,split<span class="op">=</span><span class="st">";;"</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># extract binary outcome</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">project</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co"># CONTINUE HERE!!!</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">i</span><span class="op">==</span><span class="st">"ERP113396"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">y</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">`clinical history`</span>,FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span>EXPR<span class="op">=</span><span class="va">x</span>,<span class="st">"responder"</span><span class="op">=</span><span class="fl">1</span>,<span class="st">"non-responder"</span><span class="op">=</span><span class="fl">0</span>,<span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"invalid"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">i</span><span class="op">==</span><span class="st">"ERP114636"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">y</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">`clinical information`</span>,FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span>EXPR<span class="op">=</span><span class="va">x</span>,<span class="st">"response to vedolizumab therapy"</span><span class="op">=</span><span class="fl">1</span><span class="op">-</span><span class="fl">1</span>,<span class="st">"no response to vedolizumab therapy"</span><span class="op">=</span><span class="fl">0</span><span class="op">+</span><span class="fl">1</span>,<span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"invalid"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/warning.html" class="external-link">warning</a></span><span class="op">(</span><span class="st">"Inverting response and non-response!"</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">i</span><span class="op">==</span><span class="st">"SRP100787"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">y</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">condition</span>,FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span>EXPR<span class="op">=</span><span class="va">x</span>,<span class="st">"CD inactive"</span><span class="op">=</span><span class="fl">1</span>,<span class="st">"UC inactive"</span><span class="op">=</span><span class="fl">1</span>,<span class="st">"CD active"</span><span class="op">=</span><span class="fl">0</span>,<span class="st">"UC active"</span><span class="op">=</span><span class="fl">0</span>,control<span class="op">=</span><span class="cn">NA</span>,<span class="st">"NA"</span><span class="op">=</span><span class="cn">NA</span>,<span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"invalid"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">i</span><span class="op">==</span><span class="st">"SRP129004"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">y</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">`week 4 remission`</span>,FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span>EXP<span class="op">=</span><span class="va">x</span>,<span class="st">"Yes"</span><span class="op">=</span><span class="fl">1</span>,<span class="st">"No"</span><span class="op">=</span><span class="fl">0</span>,<span class="st">"NA"</span><span class="op">=</span><span class="cn">NA</span>,<span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"invalid"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="va">z</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>pucai<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">pucai</span><span class="op">)</span>,mayo<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">`total mayo score`</span><span class="op">)</span>,histology<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">`histology severity score`</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">i</span><span class="op">==</span><span class="st">"SRP063496"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">y</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">`remission at week 10`</span>,FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"Remitter"</span><span class="op">=</span><span class="fl">1</span>,<span class="st">"Non-remitter"</span><span class="op">=</span><span class="fl">0</span>,<span class="st">"N/A"</span><span class="op">=</span><span class="cn">NA</span>,<span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"invalid"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">i</span><span class="op">==</span><span class="st">"SRP169062"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">y</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">`flare event`</span>,FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span><span class="va">x</span>,<span class="st">"no flare"</span><span class="op">=</span><span class="fl">1</span>,<span class="st">"flare"</span><span class="op">=</span><span class="fl">0</span>,<span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"invalid"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">i</span><span class="op">==</span><span class="st">"SRP155483"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">y</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">`disease activity`</span>,FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span><span class="va">x</span>,<span class="st">"remission"</span><span class="op">=</span><span class="fl">1</span>,<span class="st">"Low"</span><span class="op">=</span><span class="fl">0</span>,<span class="st">"Moderate"</span><span class="op">=</span><span class="fl">0</span>,<span class="st">"High"</span><span class="op">=</span><span class="fl">0</span>,<span class="st">"--"</span><span class="op">=</span><span class="cn">NA</span>,<span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"invalid"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">z</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">`disease activity`</span>,FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span><span class="va">x</span>,<span class="st">"remission"</span><span class="op">=</span><span class="fl">0</span>,<span class="st">"Low"</span><span class="op">=</span><span class="fl">1</span>,<span class="st">"Moderate"</span><span class="op">=</span><span class="fl">2</span>,<span class="st">"High"</span><span class="op">=</span><span class="fl">3</span>,<span class="st">"--"</span><span class="op">=</span><span class="cn">NA</span>,<span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"invalid"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">i</span><span class="op">==</span><span class="st">"SRP074736"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">y</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">`mtx response status`</span>,FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span><span class="va">x</span>,<span class="st">"responder"</span><span class="op">=</span><span class="fl">1</span>,<span class="st">"non-responder"</span><span class="op">=</span><span class="fl">0</span>,<span class="st">"control"</span><span class="op">=</span><span class="cn">NA</span>,<span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"invalid"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># overlap</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">project</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">is.na</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">y</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">is.na</span><span class="op">)</span><span class="op">!=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">{</span><span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="op">)</span><span class="op">}</span></span>
<span>  <span class="va">y</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">y</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">!</span><span class="va">is.na</span><span class="op">]</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">z</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">is.vector</a></span><span class="op">(</span><span class="va">z</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="va">z</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">z</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">!</span><span class="va">is.na</span><span class="op">]</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="va">z</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">z</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">!</span><span class="va">is.na</span>,<span class="op">]</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">x</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">!</span><span class="va">is.na</span>,<span class="op">]</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="data-exploration">Data exploration<a class="anchor" aria-label="anchor" href="#data-exploration"></a>
</h3>
<p>This chunk performs the exploratory data analysis.</p>
<ul>
<li><p>Requires: execution of chunks <code>setup</code>,
<code>define_projects</code> and <code>preprocess_data</code></p></li>
<li><p>Execution time: <span class="math inline">\(0.5\)</span>
minutes</p></li>
<li><p>Ensures: files <code>explore_data.RData</code> (results) and
<code>info_explore.txt</code> (session information) in folder
<code>results</code></p></li>
</ul>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#&lt;&lt;setup&gt;&gt;</span></span>
<span><span class="co">#&lt;&lt;define_projects&gt;&gt;</span></span>
<span><span class="co">#&lt;&lt;preprocess_data&gt;&gt;</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">alpha.holdout</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">alpha.crossval</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">family</span> <span class="op">&lt;-</span> <span class="st">"binomial"</span></span>
<span><span class="va">nfolds</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="va">codes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">project</span><span class="op">)</span></span>
<span><span class="va">coef</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data<span class="op">=</span><span class="cn">NA</span>,nrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,ncol<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">codes</span><span class="op">)</span>,dimnames<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="cn">NULL</span>,<span class="va">codes</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">auc</span> <span class="op">&lt;-</span> <span class="va">auc.pvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data<span class="op">=</span><span class="cn">NA</span>,nrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">codes</span><span class="op">)</span>,ncol<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">codes</span><span class="op">)</span>,dimnames<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">codes</span>,<span class="va">codes</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">foldid</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_folds_multi.html">make_folds_trans</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">y</span>,family<span class="op">=</span><span class="st">"binomial"</span>,nfolds<span class="op">=</span><span class="va">nfolds</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ridge</span> <span class="op">&lt;-</span> <span class="va">lasso</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">codes</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">ridge</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">glmnet</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/glmnet/man/cv.glmnet.html" class="external-link">cv.glmnet</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span><span class="op">[[</span><span class="va">codes</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">]</span>,y<span class="op">=</span><span class="va">y</span><span class="op">[[</span><span class="va">codes</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">]</span>,family<span class="op">=</span><span class="va">family</span>,alpha<span class="op">=</span><span class="va">alpha.holdout</span>,foldid<span class="op">=</span><span class="va">foldid</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">coef</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">ridge</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,s<span class="op">=</span><span class="st">"lambda.min"</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">codes</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">i</span><span class="op">==</span><span class="va">j</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="va">y_hat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span>x<span class="op">=</span><span class="cn">NA</span>,times<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">y</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="kw">for</span><span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">nfolds</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="va">holdout</span> <span class="op">&lt;-</span> <span class="va">foldid</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">==</span><span class="va">k</span></span>
<span>        <span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu">glmnet</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/glmnet/man/cv.glmnet.html" class="external-link">cv.glmnet</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span><span class="op">[[</span><span class="va">codes</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">!</span><span class="va">holdout</span>,<span class="op">]</span>,y<span class="op">=</span><span class="va">y</span><span class="op">[[</span><span class="va">codes</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">!</span><span class="va">holdout</span><span class="op">]</span>,family<span class="op">=</span><span class="va">family</span>,alpha<span class="op">=</span><span class="va">alpha.crossval</span><span class="op">)</span></span>
<span>        <span class="va">y_hat</span><span class="op">[</span><span class="va">holdout</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span>object<span class="op">=</span><span class="va">temp</span>,newx<span class="op">=</span><span class="va">x</span><span class="op">[[</span><span class="va">codes</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">holdout</span>,<span class="op">]</span>,s<span class="op">=</span><span class="st">"lambda.min"</span>,type<span class="op">=</span><span class="st">"response"</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="va">y_hat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span>object<span class="op">=</span><span class="va">ridge</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,newx<span class="op">=</span><span class="va">x</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span>,s<span class="op">=</span><span class="st">"lambda.min"</span>,type<span class="op">=</span><span class="st">"response"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">auc</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">pROC</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pROC/man/auc.html" class="external-link">auc</a></span><span class="op">(</span>response<span class="op">=</span><span class="va">y</span><span class="op">[[</span><span class="va">codes</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">]</span>,predictor<span class="op">=</span><span class="va">y_hat</span>,direction<span class="op">=</span><span class="st">"&lt;"</span>,levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">auc.pvalue</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/wilcox.test.html" class="external-link">wilcox.test</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rank.html" class="external-link">rank</a></span><span class="op">(</span><span class="va">y_hat</span><span class="op">)</span><span class="op">~</span><span class="va">y</span><span class="op">[[</span><span class="va">codes</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">]</span><span class="op">]</span>,alternative<span class="op">=</span><span class="st">"less"</span>,exact<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">p.value</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">coef</span>,<span class="va">auc</span>,<span class="va">auc.pvalue</span>,<span class="va">codes</span>,file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">"results"</span>,<span class="st">"explore_data.RData"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span>text<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/utils/capture.output.html" class="external-link">capture.output</a></span><span class="op">(</span><span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span>,</span>
<span>      <span class="fu">sessioninfo</span><span class="fu">::</span><span class="fu"><a href="https://sessioninfo.r-lib.org/reference/session_info.html" class="external-link">session_info</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,con<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">"/results/info_explore.txt"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>This chunk generates the tables for the exploratory data
analysis.</p>
<ul>
<li><p>Requires: execution of chunk <code>setup</code>, file
<code>explore_data.RData</code> in folder <code>results</code>
(generated by chunk <code>explore_apply</code>)</p></li>
<li><p>execution time: <span class="math inline">\(1\)</span>
second</p></li>
<li><p>Ensures: files <code>tab_cor.tex</code> and
<code>tab_auc.tex</code> in folder <code>manuscript</code></p></li>
</ul>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#&lt;&lt;setup&gt;&gt;</span></span>
<span><span class="co">#if(any(unlist(project)!=names(refs))){stop("not compatible")}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">"results/explore_data.RData"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span>pattern<span class="op">=</span><span class="st">"IBD.|RA."</span>,replacement<span class="op">=</span><span class="st">""</span>,x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">project</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">codes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">coef</span><span class="op">)</span></span>
<span><span class="va">cor.pvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data<span class="op">=</span><span class="cn">NA</span>,nrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">codes</span><span class="op">)</span>,ncol<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">codes</span><span class="op">)</span>,dimnames<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">codes</span>,<span class="va">codes</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">codes</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">codes</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">cor.pvalue</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.test.html" class="external-link">cor.test</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">coef</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>,y<span class="op">=</span><span class="va">coef</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span>,method<span class="op">=</span><span class="st">"spearman"</span>,exact<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">p.value</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">cor.pvalue</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span></span>
<span><span class="va">insert.space</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">table</span>,<span class="va">cut</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">index.left</span> <span class="op">&lt;-</span> <span class="va">index.top</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">cut</span><span class="op">)</span></span>
<span>  <span class="va">index.right</span> <span class="op">&lt;-</span> <span class="va">index.bottom</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="va">cut</span><span class="op">+</span><span class="fl">1</span>,to<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">table</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">top</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">table</span><span class="op">[</span><span class="va">index.top</span>,<span class="va">index.left</span><span class="op">]</span>,<span class="st">""</span>,<span class="va">table</span><span class="op">[</span><span class="va">index.top</span>,<span class="va">index.right</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">bottom</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">table</span><span class="op">[</span><span class="va">index.bottom</span>,<span class="va">index.left</span><span class="op">]</span>,<span class="st">""</span>,<span class="va">table</span><span class="op">[</span><span class="va">index.bottom</span>,<span class="va">index.right</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">top</span>,<span class="st">""</span>,<span class="va">bottom</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span><span class="op">==</span><span class="st">""</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">" "</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">table</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">coef</span>,method<span class="op">=</span><span class="st">"spearman"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">table</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">table</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">names</span></span>
<span><span class="va">black</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">cor.pvalue</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">cor.pvalue</span><span class="op">&lt;=</span><span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="va">star</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">cor.pvalue</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">cor.pvalue</span><span class="op">&lt;=</span><span class="fl">0.05</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/Special.html" class="external-link">choose</a></span><span class="op">(</span>n<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">codes</span><span class="op">)</span>,k<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">nonnegative</span> <span class="op">&lt;-</span> <span class="va">table</span><span class="op">&gt;=</span><span class="fl">0</span></span>
<span><span class="va">table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">table</span>,digits<span class="op">=</span><span class="fl">2</span><span class="op">)</span>,digits<span class="op">=</span><span class="fl">2</span>,trim<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">table</span><span class="op">[</span><span class="va">nonnegative</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"\\phantom{-}"</span>,<span class="va">table</span><span class="op">[</span><span class="va">nonnegative</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">table</span><span class="op">[</span><span class="op">!</span><span class="va">black</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"\\textcolor{gray}{"</span>,<span class="va">table</span><span class="op">[</span><span class="op">!</span><span class="va">black</span><span class="op">]</span>,<span class="st">"}"</span><span class="op">)</span></span>
<span><span class="va">table</span><span class="op">[</span><span class="va">star</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">table</span><span class="op">[</span><span class="va">star</span><span class="op">]</span>,<span class="st">"$^\\star$"</span><span class="op">)</span></span>
<span><span class="va">table</span><span class="op">[</span><span class="op">!</span><span class="va">star</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">table</span><span class="op">[</span><span class="op">!</span><span class="va">star</span><span class="op">]</span>,<span class="st">"\\phantom{$^\\star$}"</span><span class="op">)</span></span>
<span><span class="co">#table[nonnegative] &lt;- paste0("-",table[nonnegative])</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">table</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"-"</span></span>
<span><span class="va">table</span> <span class="op">&lt;-</span> <span class="fu">insert.space</span><span class="op">(</span>table<span class="op">=</span><span class="va">table</span>,cut<span class="op">=</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">xtable</span> <span class="op">&lt;-</span> <span class="fu">xtable</span><span class="fu">::</span><span class="fu">xtable</span><span class="op">(</span>x<span class="op">=</span><span class="va">table</span>,align<span class="op">=</span><span class="st">"rccccccccc"</span>,caption<span class="op">=</span><span class="st">"Spearman correlation coefficients between the ridge regression coefficients from different datasets. Pairwise combinations of datasets with significantly correlated regression coefficients are highlighted, with black colour for nominal significance ($p$-value $\\leq 0.05$) and stars for adjusted significance ($p$-value $\\leq 0.05/28$). We expect a correlation coefficient close to $0$ for unrelated problems and close to $1$ for identical problems."</span>,label<span class="op">=</span><span class="st">"tab_cor"</span><span class="op">)</span></span>
<span><span class="fu">xtable</span><span class="fu">::</span><span class="fu">print.xtable</span><span class="op">(</span>x<span class="op">=</span><span class="va">xtable</span>,sanitize.text.function<span class="op">=</span><span class="va">identity</span>,rotate.colnames<span class="op">=</span><span class="cn">TRUE</span>,caption.placement<span class="op">=</span><span class="st">"top"</span>,hline.after<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">table</span><span class="op">)</span><span class="op">)</span>,comment<span class="op">=</span><span class="cn">FALSE</span>,file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">"manuscript"</span>,<span class="st">"tab_cor.tex"</span><span class="op">)</span>,floating.environment<span class="op">=</span><span class="st">"table*"</span><span class="op">)</span> <span class="co">#add.to.row=list(pos=list(5),command="\\hdashline \n")</span></span>
<span></span>
<span><span class="va">table</span> <span class="op">&lt;-</span> <span class="va">auc</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">table</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">table</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">names</span></span>
<span><span class="va">table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">table</span>,digits<span class="op">=</span><span class="fl">2</span><span class="op">)</span>,digits<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">black</span> <span class="op">&lt;-</span> <span class="va">auc.pvalue</span><span class="op">&lt;=</span><span class="fl">0.05</span></span>
<span><span class="va">star</span> <span class="op">&lt;-</span> <span class="va">auc.pvalue</span><span class="op">&lt;=</span><span class="fl">0.05</span><span class="op">/</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">codes</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">codes</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">table</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"("</span>,<span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">table</span><span class="op">)</span>,<span class="st">")"</span><span class="op">)</span></span>
<span><span class="va">table</span><span class="op">[</span><span class="op">!</span><span class="va">black</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"\\textcolor{gray}{"</span>,<span class="va">table</span><span class="op">[</span><span class="op">!</span><span class="va">black</span><span class="op">]</span>,<span class="st">"}"</span><span class="op">)</span></span>
<span><span class="va">table</span><span class="op">[</span><span class="va">star</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">table</span><span class="op">[</span><span class="va">star</span><span class="op">]</span>,<span class="st">"$^\\star$"</span><span class="op">)</span></span>
<span><span class="va">table</span><span class="op">[</span><span class="op">!</span><span class="va">star</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">table</span><span class="op">[</span><span class="op">!</span><span class="va">star</span><span class="op">]</span>,<span class="st">"\\phantom{$^\\star$}"</span><span class="op">)</span></span>
<span><span class="va">table</span> <span class="op">&lt;-</span> <span class="fu">insert.space</span><span class="op">(</span>table<span class="op">=</span><span class="va">table</span>,cut<span class="op">=</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">xtable</span> <span class="op">&lt;-</span> <span class="fu">xtable</span><span class="fu">::</span><span class="fu">xtable</span><span class="op">(</span>x<span class="op">=</span><span class="va">table</span>,align<span class="op">=</span><span class="st">"rccccccccc"</span>,caption<span class="op">=</span><span class="st">"Out-of-sample area under the receiver operating characteristic curve (\\textsc{roc-auc}) from logistic ridge regression trained on the dataset in the row and tested on the dataset in the column (off-diagonal entries), or cross-validated \\textsc{roc-auc} from logistic lasso regression trained and tested on the same dataset by $10$-fold external cross-validation (diagonal entries, between brackets). The \\textsc{roc-auc} of a random classifier is $0.5$, while that of a perfect classifier is $1.0$. Entries on and off the diagonal are not comparable. Predictions that are significantly better than random predictions (according to the one-sided Mann-Whitney $U$ test for testing whether the ranks of the predicted probabilities are significantly higher for the cases than for the controls) are highlighted, with black colour for nominal significance ($p$-value $\\leq 0.05$) and stars for adjusted significance ($p$-value $\\leq 0.05/64$)."</span>,label<span class="op">=</span><span class="st">"tab_auc"</span><span class="op">)</span></span>
<span><span class="fu">xtable</span><span class="fu">::</span><span class="fu">print.xtable</span><span class="op">(</span>x<span class="op">=</span><span class="va">xtable</span>,sanitize.text.function<span class="op">=</span><span class="va">identity</span>,rotate.colnames<span class="op">=</span><span class="cn">TRUE</span>,caption.placement<span class="op">=</span><span class="st">"top"</span>,hline.after<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">table</span><span class="op">)</span><span class="op">)</span>,comment<span class="op">=</span><span class="cn">FALSE</span>,file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">"manuscript"</span>,<span class="st">"tab_auc.tex"</span><span class="op">)</span>,floating.environment<span class="op">=</span><span class="st">"table*"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="transfer-learning">Transfer learning<a class="anchor" aria-label="anchor" href="#transfer-learning"></a>
</h3>
<p>This chunk performs the transfer learning analysis.</p>
<ul>
<li><p>Requires: execution of chunks <code>setup</code> and
<code>define_projects</code>, file <code>recount3_data.RData</code> in
folder <code>results</code> (generated by chunk
<code>download_data</code>), execution of chunk
<code>preprocess_data</code></p></li>
<li><p>Execution time: <strong>1.5 hours</strong></p></li>
<li><p>Ensures: <code>application.RData</code> (results) and
<code>info_app.txt</code> (session information) in folder
<code>results</code></p></li>
</ul>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#&lt;&lt;setup&gt;&gt;</span></span>
<span><span class="co">#&lt;&lt;define_projects&gt;&gt;</span></span>
<span><span class="co">#&lt;&lt;preprocess_data&gt;&gt;</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">project</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"project:"</span>,<span class="va">i</span>,<span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="va">result</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">{</span> <span class="co"># 5 repetitions of 10-fold CV</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="va">j</span><span class="op">)</span></span>
<span>    <span class="va">codes</span> <span class="op">&lt;-</span> <span class="va">project</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>    <span class="va">result</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cv_multiple.html">cv_transfer</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">y</span><span class="op">[</span><span class="va">codes</span><span class="op">]</span>,X<span class="op">=</span><span class="va">x</span><span class="op">[</span><span class="va">codes</span><span class="op">]</span>,family<span class="op">=</span><span class="st">"binomial"</span>,method<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"wrap_separate"</span>,<span class="st">"wrap_glmtrans"</span>,<span class="st">"sparselink"</span>,<span class="st">"wrap_xrnet"</span><span class="op">)</span><span class="op">)</span> <span class="co"># alternative: alpha.init=ifelse(i=="RA",0,0.95) lasso-like elastic net for IBD, ridge for RA (weak signal)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">result</span>,<span class="va">project</span>,file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">"results"</span>,<span class="st">"application.RData"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span>text<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/utils/capture.output.html" class="external-link">capture.output</a></span><span class="op">(</span><span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span>,</span>
<span>      <span class="fu">sessioninfo</span><span class="fu">::</span><span class="fu"><a href="https://sessioninfo.r-lib.org/reference/session_info.html" class="external-link">session_info</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,con<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">"/results/info_app.txt"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># debugging</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">{</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">codes</span> <span class="op">&lt;-</span> <span class="va">project</span><span class="op">[[</span><span class="st">"RA"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/methods.html">wrap_xrnet</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span><span class="op">[</span><span class="va">codes</span><span class="op">]</span>,y<span class="op">=</span><span class="va">y</span><span class="op">[</span><span class="va">codes</span><span class="op">]</span>,alpha.init<span class="op">=</span><span class="fl">0.95</span>,alpha<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
<p>This chunk generates the figure on the predictive performance.</p>
<ul>
<li><p>Requires: execution of chunk <code>setup</code>, file
<code>application.RData</code> in folder <code>results</code> (generated
by chunk <code>transfer_apply</code>)</p></li>
<li><p>Execution time: <span class="math inline">\(1\)</span>
second</p></li>
<li><p>Ensures: file <code>fig_app.eps</code> in folder
<code>manuscript</code></p></li>
</ul>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#&lt;&lt;setup&gt;&gt;</span></span>
<span></span>
<span><span class="fu">grDevices</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grDevices/postscript.html" class="external-link">postscript</a></span><span class="op">(</span>file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">"manuscript"</span>,<span class="st">"fig_app.eps"</span><span class="op">)</span>,width<span class="op">=</span><span class="fl">6.5</span>,height<span class="op">=</span><span class="fl">4</span>,horizontal<span class="op">=</span><span class="cn">FALSE</span>,onefile<span class="op">=</span><span class="cn">FALSE</span>,paper<span class="op">=</span><span class="st">"special"</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>,mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.5</span>,<span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,oma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"results/application.RData"</span><span class="op">)</span><span class="op">)</span>,verbose<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model0</span> <span class="op">&lt;-</span> <span class="st">"wrap_glmtrans"</span></span>
<span><span class="va">model1</span> <span class="op">&lt;-</span> <span class="st">"sparselink"</span></span>
<span><span class="va">model2</span> <span class="op">&lt;-</span> <span class="st">"wrap_xrnet"</span></span>
<span></span>
<span><span class="co"># predictivity</span></span>
<span><span class="va">metric</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">result</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span>what<span class="op">=</span><span class="st">"rbind"</span>,args<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">x</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">auc</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co"># DEV and AUC need different directions (increase=FALSE/TRUE)!</span></span>
<span><span class="va">metric</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span>what<span class="op">=</span><span class="st">"rbind"</span>,args<span class="op">=</span><span class="va">metric</span><span class="op">)</span></span>
<span><span class="co">#metric &lt;- metric/metric[,"wrap_separate"] # compare with standard lasso</span></span>
<span></span>
<span><span class="va">label</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span>pattern<span class="op">=</span><span class="st">"IBD.|RA."</span>,replacement<span class="op">=</span><span class="st">""</span>,x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span>pattern<span class="op">=</span><span class="st">" "</span>,replacement<span class="op">=</span><span class="st">"\n"</span>,x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">project</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">metric</span><span class="op">)</span>,table<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">project</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">xlab</span> <span class="op">&lt;-</span> <span class="va">label</span><span class="op">[</span><span class="va">index</span><span class="op">]</span></span>
<span><span class="fu"><a href="../reference/plot_change.html">plot_change</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">xlab</span>,y0<span class="op">=</span><span class="va">metric</span><span class="op">[</span>,<span class="va">model0</span><span class="op">]</span>,y1<span class="op">=</span><span class="va">metric</span><span class="op">[</span>,<span class="va">model1</span><span class="op">]</span>,y2<span class="op">=</span><span class="va">metric</span><span class="op">[</span>,<span class="va">model2</span><span class="op">]</span>,main<span class="op">=</span><span class="st">"metric"</span>,increase<span class="op">=</span><span class="cn">TRUE</span>,cex.main<span class="op">=</span><span class="fl">0.8</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span>side<span class="op">=</span><span class="fl">1</span>,at<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">project</span><span class="op">$</span><span class="va">IBD</span><span class="op">)</span><span class="op">+</span><span class="fl">0.5</span>,labels<span class="op">=</span><span class="st">"|"</span>,tick<span class="op">=</span><span class="cn">FALSE</span>,line<span class="op">=</span><span class="op">-</span><span class="fl">0.25</span>,font<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">index</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/segments.html" class="external-link">segments</a></span><span class="op">(</span>x0<span class="op">=</span><span class="va">i</span><span class="op">-</span><span class="fl">0.3</span>,y0<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">metric</span><span class="op">[</span><span class="va">index</span><span class="op">==</span><span class="va">i</span>,<span class="st">"wrap_separate"</span><span class="op">]</span><span class="op">)</span>,x1<span class="op">=</span><span class="va">i</span><span class="op">+</span><span class="fl">0.3</span>,col<span class="op">=</span><span class="st">"grey"</span>,lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#graphics::abline(h=0.5,lty=2,col="grey")</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="fl">1</span>,lty<span class="op">=</span><span class="fl">2</span>,col<span class="op">=</span><span class="st">"grey"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># sparsity</span></span>
<span><span class="va">nzero</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">result</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">x</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">refit</span><span class="op">$</span><span class="va">coef</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">x</span><span class="op">!=</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">nzero</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span>what<span class="op">=</span><span class="st">"rbind"</span>,args<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span>what<span class="op">=</span><span class="st">"c"</span>,args<span class="op">=</span><span class="va">nzero</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot_change.html">plot_change</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">xlab</span>,y0<span class="op">=</span><span class="va">nzero</span><span class="op">[</span>,<span class="va">model0</span><span class="op">]</span>,y1<span class="op">=</span><span class="va">nzero</span><span class="op">[</span>,<span class="va">model1</span><span class="op">]</span>,y2<span class="op">=</span><span class="va">nzero</span><span class="op">[</span>,<span class="va">model2</span><span class="op">]</span>,main<span class="op">=</span><span class="st">"sparsity"</span>,increase<span class="op">=</span><span class="cn">FALSE</span>,cex.main<span class="op">=</span><span class="fl">0.8</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span>side<span class="op">=</span><span class="fl">1</span>,at<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">project</span><span class="op">$</span><span class="va">IBD</span><span class="op">)</span><span class="op">+</span><span class="fl">0.5</span>,labels<span class="op">=</span><span class="st">"|"</span>,tick<span class="op">=</span><span class="cn">FALSE</span>,line<span class="op">=</span><span class="op">-</span><span class="fl">0.25</span>,font<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="fl">0</span>,lty<span class="op">=</span><span class="fl">2</span>,col<span class="op">=</span><span class="st">"grey"</span><span class="op">)</span></span>
<span><span class="fu">grDevices</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># percentage change</span></span>
<span><span class="co"># (reported in section 4 "application" subsection 4.3 "transfer learning")</span></span>
<span></span>
<span><span class="va">disease</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">metric</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">project</span><span class="op">$</span><span class="va">IBD</span>,<span class="st">"IBD"</span>,<span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">metric</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">project</span><span class="op">$</span><span class="va">RA</span>,<span class="st">"RA"</span>,<span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#round(100*colMeans(metric)-100,digits=2)</span></span>
<span><span class="co">#round(100*colMeans(metric[disease=="IBD",])-100,digits=2)</span></span>
<span><span class="co">#round(100*colMeans(metric[disease=="RA",])-100,digits=2)</span></span>
<span></span>
<span><span class="co">#colMeans(nzero)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">nzero</span><span class="op">[</span><span class="va">disease</span><span class="op">==</span><span class="st">"IBD"</span>,<span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#colMeans(nzero[disease=="RA",])</span></span>
<span></span>
<span><span class="co">#--- revision: report AUC ---</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">result</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/funprog.html" class="external-link">Reduce</a></span><span class="op">(</span>f<span class="op">=</span><span class="st">"+"</span>,x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">x</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">auc</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>,digits<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html" class="external-link">Reduce</a></span><span class="op">(</span>f<span class="op">=</span><span class="st">"+"</span>,x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">IBD</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">auc</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">IBD</span><span class="op">)</span></span>
<span><span class="co">#order &lt;- order(mean[,"sparselink"]-mean[,"wrap_separate"],decreasing=TRUE)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">project</span><span class="op">$</span><span class="va">IBD</span><span class="op">)</span>,<span class="st">": "</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">mean</span><span class="op">[</span>,<span class="st">"wrap_separate"</span><span class="op">]</span>,digits<span class="op">=</span><span class="fl">2</span><span class="op">)</span>,<span class="st">"-"</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">mean</span><span class="op">[</span>,<span class="st">"sparselink"</span><span class="op">]</span>,digits<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>This chunk generates the figure on feature selection.</p>
<ul>
<li><p>Requires: execution of chunk <code>setup</code>, file
<code>application.RData</code> in folder <code>results</code> (generated
by chunk <code>transfer_apply</code>)</p></li>
<li><p>Execution time: <span class="math inline">\(1\)</span>
second</p></li>
<li><p>Ensures: file <code>fig_coef.eps</code> in folder
<code>manuscript</code></p></li>
</ul>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#&lt;&lt;setup&gt;&gt;</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">"results"</span>,<span class="st">"application.RData"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">coefs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">IBD</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">coefs</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">IBD</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">refit</span><span class="op">$</span><span class="va">coef</span><span class="op">$</span><span class="va">sparselink</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">coefs</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">project</span><span class="op">$</span><span class="va">IBD</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">coefs</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">IBD</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">refit</span><span class="op">$</span><span class="va">coef</span><span class="op">$</span><span class="va">wrap_glmtrans</span><span class="op">)</span> <span class="co"># try to avoid this</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">any</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">coefs</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">x</span>,<span class="fl">1</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">x</span><span class="op">!=</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">!=</span><span class="fl">0</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">IBD</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">coefs</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">coefs</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">any</span>,<span class="op">]</span></span>
<span><span class="op">}</span></span>
<span><span class="va">table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html" class="external-link">Reduce</a></span><span class="op">(</span>f<span class="op">=</span><span class="st">"+"</span>,x<span class="op">=</span><span class="va">coefs</span><span class="op">)</span><span class="op">/</span><span class="fl">5</span></span>
<span><span class="va">count</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html" class="external-link">Reduce</a></span><span class="op">(</span>f<span class="op">=</span><span class="st">"+"</span>,x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">coefs</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">!=</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cex</span> <span class="op">&lt;-</span> <span class="fl">0.7</span></span>
<span></span>
<span><span class="fu">grDevices</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grDevices/postscript.html" class="external-link">postscript</a></span><span class="op">(</span>file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">"manuscript"</span>,<span class="st">"fig_coef.eps"</span><span class="op">)</span>,width<span class="op">=</span><span class="fl">7</span>,height<span class="op">=</span><span class="fl">5</span>,horizontal<span class="op">=</span><span class="cn">FALSE</span>,onefile<span class="op">=</span><span class="cn">FALSE</span>,paper<span class="op">=</span><span class="st">"special"</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.5</span>,<span class="fl">4.5</span>,<span class="fl">0.5</span>,<span class="fl">1.5</span><span class="op">)</span>,oma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/frame.html" class="external-link">plot.new</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.window.html" class="external-link">plot.window</a></span><span class="op">(</span>xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.6</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">table</span><span class="op">)</span><span class="op">+</span><span class="fl">0.4</span><span class="op">)</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">table</span><span class="op">)</span><span class="op">+</span><span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">table</span>,<span class="fl">1</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">x</span><span class="op">&lt;=</span><span class="fl">0</span><span class="op">)</span>,<span class="st">"blue"</span>,<span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">x</span><span class="op">&gt;=</span><span class="fl">0</span><span class="op">)</span>,<span class="st">"red"</span>,<span class="st">"black"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">colnames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">table</span><span class="op">)</span>,pattern<span class="op">=</span><span class="st">" "</span>,replacement<span class="op">=</span><span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span>text<span class="op">=</span><span class="va">colnames</span>,side<span class="op">=</span><span class="fl">1</span>,at<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">table</span><span class="op">)</span><span class="op">)</span>,cex<span class="op">=</span><span class="va">cex</span>,line<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">rownames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">table</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span>text<span class="op">=</span><span class="va">rownames</span>,side<span class="op">=</span><span class="fl">2</span>,at<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">table</span><span class="op">)</span><span class="op">)</span>,las<span class="op">=</span><span class="fl">2</span>,cex<span class="op">=</span><span class="va">cex</span>,line<span class="op">=</span><span class="fl">0.7</span>,col<span class="op">=</span><span class="va">col</span><span class="op">)</span></span>
<span><span class="co">#star &lt;- rowSums(table!=0)&gt;1</span></span>
<span><span class="va">star</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">count</span><span class="op">[</span>,<span class="op">-</span><span class="fl">5</span><span class="op">]</span>,<span class="fl">1</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">x</span><span class="op">&gt;=</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span>text<span class="op">=</span><span class="st">"*"</span>,side<span class="op">=</span><span class="fl">2</span>,at<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">star</span><span class="op">)</span>,line<span class="op">=</span><span class="op">-</span><span class="fl">0.3</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span>text<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">col</span><span class="op">==</span><span class="st">"blue"</span>,<span class="st">"-"</span>,<span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">col</span><span class="op">==</span><span class="st">"red"</span>,<span class="st">"+"</span>,<span class="st">"."</span><span class="op">)</span><span class="op">)</span>,side<span class="op">=</span><span class="fl">4</span>,at<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">table</span><span class="op">)</span><span class="op">)</span>,las<span class="op">=</span><span class="fl">2</span>,cex<span class="op">=</span><span class="va">cex</span>,line<span class="op">=</span><span class="fl">0.5</span>,col<span class="op">=</span><span class="va">col</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">table</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">table</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw">for</span><span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="va">col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">coefs</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span><span class="op">&lt;</span><span class="fl">0</span>,<span class="st">"blue"</span>,<span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">coefs</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span><span class="op">&gt;</span><span class="fl">0</span>,<span class="st">"red"</span>,<span class="st">"white"</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">cex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">5</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">coefs</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,<span class="fl">0.2</span><span class="op">)</span></span>
<span>      <span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">j</span><span class="op">-</span><span class="op">(</span><span class="op">-</span><span class="fl">3</span><span class="op">+</span><span class="va">k</span><span class="op">)</span><span class="op">*</span><span class="fl">0.17</span>,y<span class="op">=</span><span class="va">i</span>,col<span class="op">=</span><span class="va">col</span>,cex<span class="op">=</span><span class="va">cex</span>,pch<span class="op">=</span><span class="fl">16</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="fl">0.5</span>,to<span class="op">=</span><span class="fl">5.5</span>,by<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">grDevices</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># human-readable list of genes</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">star</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,collapse<span class="op">=</span><span class="st">", "</span><span class="op">)</span></span>
<span><span class="co"># "PGM1, CR2, EPC1, MLXIP, SOS2, SLC5A3, SIK1, EIF4H, SORBS3"</span></span></code></pre></div>
<!--
## Data-based simulation (under development)


``` r
path <- "C:/Users/arauschenberger/Desktop/sparselink" # LIH (Windows)
#path <- "/Users/armin.rauschenberger/Desktop/LIH/sparselink" # LCSB (Mac)

dir <- c("results","manuscript","package/R/functions.R")
for(i in seq_along(dir)){
  if(!dir.exists(file.path(path,dir[i]))&!file.exists(file.path(path,dir[i]))){
    stop(paste0("Require folder/file'",dir[i],"'."))
  } 
}
source(file.path(path,"package/R/functions.R")) # Or load 'sparselink' package.

inst <- rownames(utils::installed.packages())
pkgs <- c("knitr","rmarkdown","glmnet","BiocManager","mvtnorm","glmtrans","spls","xrnet")
for(i in seq_along(pkgs)){
  if(!pkgs[i]%in%inst){
    utils::install.packages(pkgs[i])
  }
}
pkgs <- c("recount3","edgeR")
for(i in seq_along(pkgs)){
  if(!pkgs[i]%in%inst){
    BiocManager::install(pkgs[i])
  }
}

blue <- "blue"; red <- "red"

if(exists("sim.app")&exists("fig.tab")){
  if(!sim.app&fig.tab){
    files <- c("simulation_multiple.RData","simulation_transfer.RData","recount3_data.RData","explore_data.RData","application.RData")
    for(i in seq_along(files)){
      if(!file.exists(file.path(path,"results",files[i]))){
        stop("File",files[i],"is missing.")
      }
    }
  }
}
project <- list()
project$IBD <- c("Tew (2016)"="SRP063496",
                 "Haberman (2019)"="SRP129004",
                 "Verstockt (2019)"="ERP113396",
                 "Verstockt (2020)"="ERP114636",
                 "Boyd (2018)"="SRP100787")
project$RA <- c("Baker (2019)"="SRP169062",
                "Moncrieffe (2017)"="SRP074736",
                "Goldberg (2018)"="SRP155483")
extra <- c("Lewis (2019)"="ERP104864") # https://doi.org/10.1016/j.celrep.2019.07.091
#<<setup>>
#<<define_projects>>

load(file.path(path,"results/recount3_data.RData"))

#- - - - - - - - - - - - - - -
#- - - extract features  - - - 
#- - - - - - - - - - - - - - -

# extract features
x <- list()
for(i in c(unlist(project),extra)){
  counts <- t(SummarizedExperiment::assays(data[[i]])$raw_counts)
  colnames(counts) <- SummarizedExperiment::rowRanges(data[[i]])$gene_name
  x[[i]] <- counts
}

# select most expressed protein-coding genes (for all TL projects together)
select <- list()
total <- numeric()
for(i in unlist(project)){
  #total <- rbind(total,Matrix::colSums(x[[i]])) # original: mean filtering
  total <- rbind(total,apply(X=x[[i]],MARGIN=2,FUN=stats::var)) # trial: variance filtering
}
type <- SummarizedExperiment::rowData(data[[i]])$gene_type
cond <- type=="protein_coding"
total[,!cond] <- 0
rank <- apply(X=total,MARGIN=1,FUN=rank)
mean_rank <- rowMeans(rank)
#temp <- cond & apply(total,2,function(x) all(x>0)) & (mean_rank >= sort(mean_rank[cond],decreasing=TRUE)[2000]) # original: top 2000
temp <- cond & mean_rank >= sort(mean_rank[cond],decreasing=TRUE)[5000] # trial: top 5000

for(i in unlist(project)){
  select[[i]] <- temp
}

# select most expressed protein-coding genes (for MTL project)
#mean <- apply(X=x[[extra]],MARGIN=2,FUN=mean) # original
var <- apply(X=x[[extra]],MARGIN=2,FUN=var) # trial
#warning("change number in next line")
#temp <- cond & mean >= sort(mean[cond],decreasing=TRUE)[5000] # trial: top 5000
temp <- cond & var >= sort(var[cond],decreasing=TRUE)[5000] # trial: top 5000
select[[extra]] <- temp

# pre-processing
for(i in c(unlist(project),extra)){
  lib.size <- Matrix::rowSums(x[[i]])
  x[[i]] <- x[[i]][,select[[i]],drop=FALSE]
  norm.factors <- edgeR::calcNormFactors(object=t(x[[i]]),lib.size=lib.size)
  gamma <- norm.factors*lib.size/mean(lib.size)
  gamma <- matrix(data=gamma,nrow=nrow(x[[i]]),ncol=ncol(x[[i]]))
  x[[i]] <- x[[i]]/gamma
  x[[i]] <- 2*sqrt(x[[i]] + 3/8) # Anscombe transform
  x[[i]] <- scale(x[[i]]) # scale because of different datasets!?
}

#- - - - - - - - - - - - - -
#- - - extract targets - - -
#- - - - - - - - - - - - - -

# extract information on samples
frame <- list()
for(i in c(unlist(project),extra)){
  list <- strsplit(data[[i]]$sra.sample_attributes,split="\\|")
  data[[i]]$sra.experiment_attributes
  # What about sra.experiment_attributes?
  n <- length(list)
  cols <- unique(sapply(strsplit(unlist(list),split=";;"),function(x) x[1]))
  ncol <- length(cols)
  frame[[i]] <- matrix(data=NA,nrow=n,ncol=ncol,dimnames=list(rownames(x[[i]]),cols))
  for(j in seq_len(n)){
    for(k in seq_len(ncol)){
      vector <- list[[j]]
      which <- which(substring(text=vector,first=1,last=nchar(cols[k]))==cols[k])
      string <- vector[which]
      if(length(string)==0){next}
      frame[[i]][j,k] <- strsplit(string,split=";;")[[1]][2]
    }
  }
  frame[[i]] <- as.data.frame(frame[[i]])
}

# extract binary outcome
y <- z <- list()
for(i in unlist(project)){
  # CONTINUE HERE!!!
  if(i=="ERP113396"){
    y[[i]] <- sapply(X=frame[[i]]$`clinical history`,FUN=function(x) switch(EXPR=x,"responder"=1,"non-responder"=0,stop("invalid")))
  } else if(i=="ERP114636"){
    y[[i]] <- sapply(X=frame[[i]]$`clinical information`,FUN=function(x) switch(EXPR=x,"response to vedolizumab therapy"=1-1,"no response to vedolizumab therapy"=0+1,stop("invalid")))
    warning("Inverting response and non-response!")
  } else if(i=="SRP100787"){
    y[[i]] <- sapply(X=frame[[i]]$condition,FUN=function(x) switch(EXPR=x,"CD inactive"=1,"UC inactive"=1,"CD active"=0,"UC active"=0,control=NA,"NA"=NA,stop("invalid")))
  } else if(i=="SRP129004"){
    y[[i]] <- sapply(X=frame[[i]]$`week 4 remission`,FUN=function(x) switch(EXP=x,"Yes"=1,"No"=0,"NA"=NA,stop("invalid")))
    suppressWarnings(z[[i]] <- data.frame(pucai=as.numeric(frame[[i]]$pucai),mayo=as.numeric(frame[[i]]$`total mayo score`),histology=as.numeric(frame[[i]]$`histology severity score`)))
  } else if(i=="SRP063496"){
    y[[i]] <- sapply(X=frame[[i]]$`remission at week 10`,FUN=function(x) switch(x, "Remitter"=1,"Non-remitter"=0,"N/A"=NA,stop("invalid")))
  } else if(i=="SRP169062"){
    y[[i]] <- sapply(X=frame[[i]]$`flare event`,FUN=function(x) switch(x,"no flare"=1,"flare"=0,stop("invalid")))
  } else if(i=="SRP155483"){
    y[[i]] <- sapply(X=frame[[i]]$`disease activity`,FUN=function(x) switch(x,"remission"=1,"Low"=0,"Moderate"=0,"High"=0,"--"=NA,stop("invalid")))
    z[[i]] <- sapply(X=frame[[i]]$`disease activity`,FUN=function(x) switch(x,"remission"=0,"Low"=1,"Moderate"=2,"High"=3,"--"=NA,stop("invalid")))
  } else if(i=="SRP074736"){
    y[[i]] <- sapply(X=frame[[i]]$`mtx response status`,FUN=function(x) switch(x,"responder"=1,"non-responder"=0,"control"=NA,stop("invalid")))
  }
}

# overlap
for(j in unlist(project)){
  is.na <- is.na(y[[j]])
  if(length(is.na)!=nrow(x[[j]])){stop()}
  y[[j]] <- y[[j]][!is.na]
  if(!is.null(z[[j]])){
    if(is.vector(z[[j]])){
      z[[j]] <- z[[j]][!is.na]
    } else {
      z[[j]] <- z[[j]][!is.na,]
    }
  }
  x[[j]] <- x[[j]][!is.na,]
}
source(file.path(path,"package/R/development.R"))

x <- x$SRP100787
y <- y$SRP100787
sd <- apply(x,2,sd) # temporary # REMOVE THIS!
x <- x[,sd>=sort(sd,decreasing=TRUE)[100]] # REMOVE THIS!
iter <- 10
q <- 2
n <- nrow(x)

#-- -- --- ---
#--- MTL ---
#-- -- --- ---

prob_mtl <- c(0.00,0.05,0.10,0.15,0.20)
auc_mtl <- list()
for(i in seq_along(prob_mtl)){
  auc_mtl[[i]] <- list()
  for(j in seq_len(iter)){
    Y <- matrix(data=NA,nrow=n,ncol=q)
    for(k in seq_len(q)){
      Y[,k] <- abs(y - stats::rbinom(n=n,size=1,prob=prob_mtl[i]))
    }
    #auc_mtl[[i]][[j]] <- cv_multiple(y=Y,X=x,method=c("wrap_separate","sparselink"),family="binomial",alpha.init=0.95,alpha=1,type="exp",trial=FALSE)$auc
    auc_mtl[[i]][[j]] <- joinet::cv.joinet(Y=Y,X=x,family="binomial")
  }
}
# MTL is beneficial under prob=0.15

# for joinet (deviance: lower=better)
a <- sapply(auc_mtl,function(x) rowMeans(sapply(x,function(x) rowMeans(x))))
plot(prob_mtl,y=a["base",],type="o")
lines(prob_mtl,y=a["meta",],type="o",lty=2)


#lapply(auc_mtl,function(x) rowMeans(sapply(x,function(x) colMeans(x))))

#--- --- --- ---
#--- TL ---
#--- --- --- ---

prob_tl <- c(0.3,0.4,0.5,0.6,0.7)
auc_tl <- list()
for(i in seq_along(prob_tl)){
  auc_tl[[i]] <- list()
  cond <- rep(x=NA,times=n)
  Y <- X <- list()
  for(j in seq_len(iter)){
    n0 <- round(prob_tl[i]*sum(y==0))
    n1 <- round(prob_tl[i]*sum(y==1))
    cond[y==0] <- sample(rep(x=c(0,1),times=c(n0,sum(y==0)-n0))) #sample(rep(x=c(0,1),length.out=sum(y==0)))
    cond[y==1] <- sample(rep(x=c(0,1),times=c(n1,sum(y==1)-n1))) #sample(rep(x=c(0,1),length.out=sum(y==1)))
    Y <- list(y1=y[cond==0],y2=y[cond==1])
    X <- list(x1=x[cond==0,],x2=x[cond==1,])
    auc_tl[[i]][[j]] <- cv_transfer(y=Y,X=X,method=c("wrap_separate","sparselink"),family="binomial",alpha.init=0.95,alpha=1,type="exp",trial=FALSE)$auc
  }
}

save(prob_mtl,auc_mtl,prob_tl,auc_tl,file=file.path(path,"results","sim-devel.RData"))

graphics::par(mfrow=c(1,2))

# MTL: AUC vs contamination
aucs <- lapply(auc_mtl,function(x) sapply(x,function(x) colMeans(x)))
auc <- sapply(aucs,function(x) rowMeans(x))
graphics::plot(x=prob_mtl,auc["sparselink",],type="o",ylim=c(0.4,0.8),col="blue")
graphics::lines(x=prob_mtl,auc["wrap_separate",],type="o",col="red")
graphics::abline(h=0.5,lty=2,col="grey")

# TL: source/target sample size
aucs <- lapply(auc_tl,function(x) sapply(x,function(x) x[2,]))
auc <- sapply(aucs,function(x) rowMeans(x))
graphics::plot(x=prob_tl,auc["sparselink",],type="o",ylim=c(0.4,0.8),col="blue")
graphics::lines(x=prob_tl,auc["wrap_separate",],type="o",col="red")
graphics::abline(h=0.5,lty=2,col="grey")

# statistical testing
```


## Multi-task learning (under development)


``` r
path <- "C:/Users/arauschenberger/Desktop/sparselink" # LIH (Windows)
#path <- "/Users/armin.rauschenberger/Desktop/LIH/sparselink" # LCSB (Mac)

dir <- c("results","manuscript","package/R/functions.R")
for(i in seq_along(dir)){
  if(!dir.exists(file.path(path,dir[i]))&!file.exists(file.path(path,dir[i]))){
    stop(paste0("Require folder/file'",dir[i],"'."))
  } 
}
source(file.path(path,"package/R/functions.R")) # Or load 'sparselink' package.

inst <- rownames(utils::installed.packages())
pkgs <- c("knitr","rmarkdown","glmnet","BiocManager","mvtnorm","glmtrans","spls","xrnet")
for(i in seq_along(pkgs)){
  if(!pkgs[i]%in%inst){
    utils::install.packages(pkgs[i])
  }
}
pkgs <- c("recount3","edgeR")
for(i in seq_along(pkgs)){
  if(!pkgs[i]%in%inst){
    BiocManager::install(pkgs[i])
  }
}

blue <- "blue"; red <- "red"

if(exists("sim.app")&exists("fig.tab")){
  if(!sim.app&fig.tab){
    files <- c("simulation_multiple.RData","simulation_transfer.RData","recount3_data.RData","explore_data.RData","application.RData")
    for(i in seq_along(files)){
      if(!file.exists(file.path(path,"results",files[i]))){
        stop("File",files[i],"is missing.")
      }
    }
  }
}
project <- list()
project$IBD <- c("Tew (2016)"="SRP063496",
                 "Haberman (2019)"="SRP129004",
                 "Verstockt (2019)"="ERP113396",
                 "Verstockt (2020)"="ERP114636",
                 "Boyd (2018)"="SRP100787")
project$RA <- c("Baker (2019)"="SRP169062",
                "Moncrieffe (2017)"="SRP074736",
                "Goldberg (2018)"="SRP155483")
extra <- c("Lewis (2019)"="ERP104864") # https://doi.org/10.1016/j.celrep.2019.07.091
#<<setup>>
#<<define_projects>>

load(file.path(path,"results/recount3_data.RData"))

#- - - - - - - - - - - - - - -
#- - - extract features  - - - 
#- - - - - - - - - - - - - - -

# extract features
x <- list()
for(i in c(unlist(project),extra)){
  counts <- t(SummarizedExperiment::assays(data[[i]])$raw_counts)
  colnames(counts) <- SummarizedExperiment::rowRanges(data[[i]])$gene_name
  x[[i]] <- counts
}

# select most expressed protein-coding genes (for all TL projects together)
select <- list()
total <- numeric()
for(i in unlist(project)){
  #total <- rbind(total,Matrix::colSums(x[[i]])) # original: mean filtering
  total <- rbind(total,apply(X=x[[i]],MARGIN=2,FUN=stats::var)) # trial: variance filtering
}
type <- SummarizedExperiment::rowData(data[[i]])$gene_type
cond <- type=="protein_coding"
total[,!cond] <- 0
rank <- apply(X=total,MARGIN=1,FUN=rank)
mean_rank <- rowMeans(rank)
#temp <- cond & apply(total,2,function(x) all(x>0)) & (mean_rank >= sort(mean_rank[cond],decreasing=TRUE)[2000]) # original: top 2000
temp <- cond & mean_rank >= sort(mean_rank[cond],decreasing=TRUE)[5000] # trial: top 5000

for(i in unlist(project)){
  select[[i]] <- temp
}

# select most expressed protein-coding genes (for MTL project)
#mean <- apply(X=x[[extra]],MARGIN=2,FUN=mean) # original
var <- apply(X=x[[extra]],MARGIN=2,FUN=var) # trial
#warning("change number in next line")
#temp <- cond & mean >= sort(mean[cond],decreasing=TRUE)[5000] # trial: top 5000
temp <- cond & var >= sort(var[cond],decreasing=TRUE)[5000] # trial: top 5000
select[[extra]] <- temp

# pre-processing
for(i in c(unlist(project),extra)){
  lib.size <- Matrix::rowSums(x[[i]])
  x[[i]] <- x[[i]][,select[[i]],drop=FALSE]
  norm.factors <- edgeR::calcNormFactors(object=t(x[[i]]),lib.size=lib.size)
  gamma <- norm.factors*lib.size/mean(lib.size)
  gamma <- matrix(data=gamma,nrow=nrow(x[[i]]),ncol=ncol(x[[i]]))
  x[[i]] <- x[[i]]/gamma
  x[[i]] <- 2*sqrt(x[[i]] + 3/8) # Anscombe transform
  x[[i]] <- scale(x[[i]]) # scale because of different datasets!?
}

#- - - - - - - - - - - - - -
#- - - extract targets - - -
#- - - - - - - - - - - - - -

# extract information on samples
frame <- list()
for(i in c(unlist(project),extra)){
  list <- strsplit(data[[i]]$sra.sample_attributes,split="\\|")
  data[[i]]$sra.experiment_attributes
  # What about sra.experiment_attributes?
  n <- length(list)
  cols <- unique(sapply(strsplit(unlist(list),split=";;"),function(x) x[1]))
  ncol <- length(cols)
  frame[[i]] <- matrix(data=NA,nrow=n,ncol=ncol,dimnames=list(rownames(x[[i]]),cols))
  for(j in seq_len(n)){
    for(k in seq_len(ncol)){
      vector <- list[[j]]
      which <- which(substring(text=vector,first=1,last=nchar(cols[k]))==cols[k])
      string <- vector[which]
      if(length(string)==0){next}
      frame[[i]][j,k] <- strsplit(string,split=";;")[[1]][2]
    }
  }
  frame[[i]] <- as.data.frame(frame[[i]])
}

# extract binary outcome
y <- z <- list()
for(i in unlist(project)){
  # CONTINUE HERE!!!
  if(i=="ERP113396"){
    y[[i]] <- sapply(X=frame[[i]]$`clinical history`,FUN=function(x) switch(EXPR=x,"responder"=1,"non-responder"=0,stop("invalid")))
  } else if(i=="ERP114636"){
    y[[i]] <- sapply(X=frame[[i]]$`clinical information`,FUN=function(x) switch(EXPR=x,"response to vedolizumab therapy"=1-1,"no response to vedolizumab therapy"=0+1,stop("invalid")))
    warning("Inverting response and non-response!")
  } else if(i=="SRP100787"){
    y[[i]] <- sapply(X=frame[[i]]$condition,FUN=function(x) switch(EXPR=x,"CD inactive"=1,"UC inactive"=1,"CD active"=0,"UC active"=0,control=NA,"NA"=NA,stop("invalid")))
  } else if(i=="SRP129004"){
    y[[i]] <- sapply(X=frame[[i]]$`week 4 remission`,FUN=function(x) switch(EXP=x,"Yes"=1,"No"=0,"NA"=NA,stop("invalid")))
    suppressWarnings(z[[i]] <- data.frame(pucai=as.numeric(frame[[i]]$pucai),mayo=as.numeric(frame[[i]]$`total mayo score`),histology=as.numeric(frame[[i]]$`histology severity score`)))
  } else if(i=="SRP063496"){
    y[[i]] <- sapply(X=frame[[i]]$`remission at week 10`,FUN=function(x) switch(x, "Remitter"=1,"Non-remitter"=0,"N/A"=NA,stop("invalid")))
  } else if(i=="SRP169062"){
    y[[i]] <- sapply(X=frame[[i]]$`flare event`,FUN=function(x) switch(x,"no flare"=1,"flare"=0,stop("invalid")))
  } else if(i=="SRP155483"){
    y[[i]] <- sapply(X=frame[[i]]$`disease activity`,FUN=function(x) switch(x,"remission"=1,"Low"=0,"Moderate"=0,"High"=0,"--"=NA,stop("invalid")))
    z[[i]] <- sapply(X=frame[[i]]$`disease activity`,FUN=function(x) switch(x,"remission"=0,"Low"=1,"Moderate"=2,"High"=3,"--"=NA,stop("invalid")))
  } else if(i=="SRP074736"){
    y[[i]] <- sapply(X=frame[[i]]$`mtx response status`,FUN=function(x) switch(x,"responder"=1,"non-responder"=0,"control"=NA,stop("invalid")))
  }
}

# overlap
for(j in unlist(project)){
  is.na <- is.na(y[[j]])
  if(length(is.na)!=nrow(x[[j]])){stop()}
  y[[j]] <- y[[j]][!is.na]
  if(!is.null(z[[j]])){
    if(is.vector(z[[j]])){
      z[[j]] <- z[[j]][!is.na]
    } else {
      z[[j]] <- z[[j]][!is.na,]
    }
  }
  x[[j]] <- x[[j]][!is.na,]
}
source(file.path(path,"package/R/development.R"))

#- - - - - - - - - - 
#- - prepare data - -
#- - - - - - - - - - 

# explore SRP048801

project <- "ERP104864"
if(project=="SRP155483"){
  X <- x$SRP155483
  vars <- c("disease activity","das score")
  Y <- frame$SRP155483[,vars]
  sapply(unique(Y$`disease activity`),function(x) range(as.numeric(Y$`das score`[Y$`disease activity`==x])))
  warning("DAS score defines disease activity!")
  problem <- list()
  problem$unique <- colnames(Y)
} else if(project=="SRP129004"){
  X <- x$SRP129004
  vars <- c("histology severity score","total mayo score")
  Y <- frame$SRP129004[,vars]
  names <- intersect(rownames(X),rownames(Y))
  X <- X[names,]
  Y <- Y[names,]
  cond <- frame$SRP129004[names,"diagnosis"]=="Ulcerative Colitis"
  X <- X[cond,]
  Y <- Y[cond,]
  problem <- list()
  problem$unique <- colnames(Y)
} else if(project=="ERP104864"){
  X <- x$ERP104864
  vars <- c("CCP","CRP","crp","DAS28","ESR","esr","HAQ","VAS","SWOLLEN","TENDER") # "inflammatory score" dropped due to NA # "RF" dropped because binary
  Y <- frame$ERP104864[,vars]
  pathotype <- frame$ERP104864$pathotype
  if(any(rownames(X)!=rownames(Y))){stop()}
  #Y <- Y[Y$pathotype=="lymphoid",vars]
  if(any(!is.na(Y$CRP)&!is.na(Y$crp))){
    stop("Invalid.")
  } else {
    Y$CRP[is.na(Y$CRP)] <- Y$crp[is.na(Y$CRP)]
    Y$crp <- NULL
  }
  if(any(!is.na(Y$ESR)&!is.na(Y$esr))){
    stop("Invalid.")
  } else {
    Y$ESR[is.na(Y$ESR)] <- Y$esr[is.na(Y$ESR)]
    Y$esr <- NULL
  }
  problem <- list()
  #problem$joint <- c("SWOLLEN","TENDER")
  #problem$proms <- c("VAS","HAQ")
  #problem$labor <- c("CRP","ESR") # CCP might be too different (check cor)
  problem$trial <- c("CRP","ESR","SWOLLEN")
  #problem$trial <- c("DAS28","SWOLLEN","TENDER")
  #problem$all <- colnames(y)
}

for(i in seq_len(ncol(Y))){
  class(Y[[i]]) <- "numeric"
}

cond <- apply(X=Y,MARGIN=1,FUN=function(x) all(!is.na(x))) #& pathotype=="lymphoid" # subtypes seem to be defined based on clinical scores
#Y <- as.matrix(Y)[cond,] # temporary: binarisation
y <- scale(as.matrix(Y)[cond,])
x <- X[cond,]

#- - - - - - - - - - - - - 
#- - explore similarity - -
#- - - - - - - - - - - - - 

cor <- stats::cor(y,use="pairwise.complete.obs",method="spearman")
round(x=cor,digits=2)
graphics::image(t(cor)[,ncol(cor):1])
#stats::heatmap(x=as.matrix(Y),Rowv=NA)
d <- stats::dist(x=t(Y))
hclust <- stats::hclust(d=d)
graphics::plot(hclust)

graphics::par(mfrow=c(2,4),mar=c(2,2,1,1))
for(i in seq_len(ncol(y))){
    pvalue <- apply(x,2,function(x) cor.test(x,y[,i],method="spearman")$p.value)
    graphics::hist(x=pvalue,main=colnames(y)[i])
}

#--- relationship between cor coef and cor p-value ---
coef <- stats::cor(y=y[,"CRP"],x=x,method="spearman")
pval <- apply(X=x,MARGIN=2,FUN=function(x) stats::cor.test(x=x,y=y[,"CRP"],method="spearman")$p.value)
graphics::plot(x=coef,y=sign(coef)*(-log10(pval))^0.5)
#--- conclusion: equivalent ---

#--- examine correlation between ridge coefficients ---
coef <- matrix(data=NA,nrow=ncol(x),ncol=ncol(y),dimnames=list(NULL,colnames(y)))
for(i in seq_len(ncol(y))){
  object <- glmnet::cv.glmnet(x=x,y=y[,i],family="gaussian",alpha=0)
  coef[,i] <- stats::coef(object=object,s="lambda.min")[-1]
}
round(stats::cor(coef,method="spearman"),digits=2)
#--- conclusion: some sets are strongly correlated ---

#cor(rowSums(scale(Y)),Y,method="spearman")

#- - - - - - - - - - - - - 
#- - cross-validation - -
#- - - - - - - - - - - - - 

alpha.init <- 0.95; alpha <- 1; type <- "exp"; trial <- FALSE
#alpha.init <- NA; alpha <- 1; type <- "exp"; trial <- TRUE
results <- list()
for(k in seq_along(problem)){
  results[[k]] <- list()
  for(i in seq_len(3)){ # 5 repetitions of 10-fold CV
    set.seed(i)
    method <- c("wrap_empty","wrap_separate","wrap_mgaussian","sparselink","wrap_spls") #"sparselink" "group.devel"
    results[[k]][[i]] <-  cv_multiple(y=y[,problem[[k]]],X=x,family="gaussian",method=method,nfolds=10,alpha=alpha,alpha.init=alpha.init,type=type,trial=trial)
  }
}

save(results,file=file.path(path,"results","app_mtl_devel.RData"))

lapply(results,function(x) lapply(x,function(x) colMeans(x$deviance)))


colMeans(results[[1]][[1]]$deviance/results[[1]][[1]]$deviance[,"wrap_empty"])
names(results) <- names(problem)

colMeans(results$trial[[1]]$deviance/results$trial[[1]]$deviance[,"wrap_empty"])

lapply(results,function(x) rowMeans(sapply(x,function(x) rowMeans(apply(x$deviance,1,rank)))))

object <- devel(y=y[,problem$trial],x=x,family="gaussian")

cm <- numeric()
for(k in seq_along(problem)){
  for(i in seq_len(1)){
    dev <- results[[k]][[i]]$deviance
    temp <- colMeans(dev/dev[,"wrap_separate"])
    cm <- rbind(cm,temp)
    #cat(cm,"\n")
  }
}
colMeans(cm)

# separate, mgaussian, sparselink and devel have similar performance (i.e., MTL has no benefit with any of these three approaches), examine whether other approaches are better

# examine whether group lasso for TL/MTL performs better

# Consider using different candidate values, e.g., 0.01,0.5,1,1.5,2,10 also for sparselink. Removing 0 might be a good choice. (If 0 is not included, however, initial ridge regression might be better.)

#- - - - - - - - - - - -
#- - learning curve - -
#- - - - - - - - - - - -

size <- unique(c(seq(from=50,to=nrow(x),by=25),nrow(x)))
iter <- 10 # increase to 10
size <- nrow(x) # suppress learning curve

metric <- list()
setting <- expand.grid(problem=names(problem),size=size,iter=seq_len(iter))
for(i in seq_len(nrow(setting))){
  cat(progress=paste0(100*i/nrow(setting),"%"),"\n")
  cond <- sample(x=rep(x=c(FALSE,TRUE),times=c(nrow(x)-setting$size[i],setting$size[i])))
  vars <- problem[[setting$problem[i]]]
  metric[[i]] <- joinet:::cv.joinet(Y=y[cond,vars],X=x[cond,],family="gaussian",compare="mnorm")
  #method <- c("wrap_empty","wrap_separate","wrap_mgaussian","sparselink")
  #metric[[i]] <-  cv_multiple(y=y[cond,vars],X=x[cond,],family="gaussian",method=method,nfolds=10,alpha.init=0.95,alpha=1,type="exp",trial=FALSE)
}
frac <- sapply(X=metric,FUN=function(x) colMeans(t(x)/x["none",]))

#frac <- sapply(X=metric,FUN=function(x) colMeans(x$deviance/x$deviance[,"wrap_empty"]))

graphics::par(mfrow=c(1,length(problem)),mar=c(3,3,2,0.5))
for(i in seq_along(problem)){
  graphics::plot.new()
  graphics::plot.window(xlim=range(size),ylim=range(frac))
  graphics::box()
  graphics::title(main=names(problem)[i])
  graphics::axis(side=1)
  graphics::axis(side=2)
  graphics::abline(h=1,col="grey",lty=2)
  cond <- setting$problem==names(problem)[i]
  col <- c(base="red",mnorm="orange",meta="blue")
  #col <- c(wrap_separate="red",sparselink="blue")
  for(j in names(col)){
    val <- tapply(X=frac[j,cond],INDEX=setting$size[cond],FUN=mean)
    graphics::points(x=setting$size[cond],y=frac[j,cond],col=col[j])
    graphics::lines(x=size,y=val,col=col[j],type="o",pch=16)
  }
}

#  JOINET is better than standard lasso when n>=100, performance is similar to spls and better than glmnet-mgaussian 

#--- --- --- --- --- ---
# binarisation ---
#--- --- --- --- --- ---


yy <- 1*cbind(y[,"CCP"]>20,y[,"CRP"]>10,y[,"DAS28"]>5)
metric <- list()
for(i in 1:10){
  metric[[i]] <- joinet:::cv.joinet(Y=yy,X=x,family="binomial")
}

#rowMeans(sapply(metric,function(x) rowMeans(x)))

#--- --- --- --- --- --- ---
#--- explore other datasets ---
#--- --- --- --- --- --- ---

#projects <- recount3::available_projects(organism="human")
#recount3::read_metadata()


#data <- xlsx::read.xlsx(paste0(path,"/results/PPMI_Curated_Data_Cut_Public_20250321.xlsx"),sheetIndex=1)
data <- read.csv(paste0(path,"/results/PPMI_Curated_Data_Cut_Public_20250321.csv"))

# baseline data (predictors)
x <- data[data$COHORT==1 & data$EVENT_ID=="BL",]
rownames(x) <- x$PATNO
prop.miss <- colMeans(is.na(x))
x <- x[,prop.miss<=0.5 & sapply(x,class) %in% c("numeric","integer")]
x <- x[,which(colnames(x)=="age"):ncol(x)]
x <- missRanger::missRanger(data=x,pmm.k=3,num.trees=100,verbose=0,seed=1)
x <- scale(x)

# follow-up data (outcomes)
visit <- c("V04","V06","V08")
y <- data[data$COHORT==1 & data$EVENT_ID %in% visit,]
colnames(y)[colnames(y)=="updrs_totscore"] <- "updrs"
vars <- c("moca","quip","updrs","gds","scopa","ess","bjlot","rem")
y <- y[,c("EVENT_ID","PATNO",vars)]
y <- reshape(data=y,idvar="PATNO",timevar="EVENT_ID",direction="wide")
rownames(y) <- y$PATNO; y$PATNO <- NULL

# overlap
names <- intersect(rownames(x),rownames(y))
x <- x[names,]
y <- y[names,]
y <- as.matrix(y)
#y <- scale(y)

metric <- list()
for(i in seq_along(vars)){
  cat(vars[i],"\n")
  cols <- paste0(vars[i],".",visit)
  cond <- rowSums(is.na(y[,cols]))==0 # temporary
  if(sum(cond)>250){cond[cumsum(cond)>250] <- FALSE} # temporary
  metric[[i]] <- joinet:::cv.joinet(Y=y[cond,cols],X=x[cond,],family="gaussian",compare="mnorm")
  #method <- c("wrap_empty","wrap_separate","wrap_mgaussian","sparselink","devel") # ,"sparselink")
  #metric[[i]] <- cv_multiple(y=y[cond,cols],X=x[cond,],family="gaussian",method=method,nfolds=10,alpha.init=0.95,alpha=1,type="exp",trial=FALSE)
}

#rowMeans(sapply(metric,function(x) colMeans(t(x)/x["none",])))
rowMeans(sapply(metric,function(x) colMeans(x$deviance/x$deviance[,"wrap_empty"])))
```
-->
<p>This chunk saves the session information for generating figures and
tables.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Armin Rauschenberger.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
