<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Analysis code • sparselink</title>
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Analysis code">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">sparselink</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">functions</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/article.html">article</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/analysis.html">analysis</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">news</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/rauschenberger/sparselink/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Analysis code</h1>
                        <h4 data-toc-skip class="author">Armin
Rauschenberger</h4>
            
            <h4 data-toc-skip class="date">2025-05-22</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/rauschenberger/sparselink/blob/main/vignettes/analysis.Rmd" class="external-link"><code>vignettes/analysis.Rmd</code></a></small>
      <div class="d-none name"><code>analysis.Rmd</code></div>
    </div>

    
    
<p><strong>We obtained our results on 2025-05-XX using R version 4.5.0
(2025-04-11, “How About a Twenty-Six”) running on a Dell Latitude 5440
laptop with a 13th Gen Intel(R) Core(TM) i7-1365U processor (1800 Mhz),
16 GB RAM, and the operating system Microsoft Windows 10 Enterprise. The
total computation time was around XXX hours (excluding data download,
without parallel computing).</strong></p>
<div class="section level2">
<h2 id="working-environment">Working environment<a class="anchor" aria-label="anchor" href="#working-environment"></a>
</h2>
<p>This vignette includes code chunks with a long computation time
(e.g., analysing simulated and experimental data) and code chunks with a
short computation time (e.g., generating figures and tables). The
logical options <code>sim.app</code> and <code>fig.tab</code> determine
whether the chunks for (i) running the simulation and application or
(ii) generating figures and tables are evaluated, respectively. Running
this vignette with <code>sim.app=FALSE</code> and
<code>fig.tab=TRUE</code> means that figures and tables will be
generated from previously obtained results. Running this vignette with
<code>sim.app=TRUE</code> and <code>fig.tab=TRUE</code>and means that
all results will be reproduced (including data download and data
processing). It is also possible to execute individual chunks (e.g., for
reproducing a specific figure or table), but then it is important to
provide the required inputs (e.g., “Requires: file X in folder Y,
execution of chunk Z”).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/knitr/man/opts_chunk.html" class="external-link">opts_chunk</a></span><span class="op">$</span><span class="fu">set</span><span class="op">(</span>echo<span class="op">=</span><span class="cn">TRUE</span>,eval<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">sim.app</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span> <span class="co"># reproduce simulation and application?</span></span>
<span><span class="va">fig.tab</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span> <span class="co"># reproduce figures and tables?</span></span></code></pre></div>
<p>This chunk verifies the working environment. The working directory,
specified by the object <code>path</code>, must contain the R functions
in “package/R/functions.R” as well as the folders “results” and
“manuscript”. Alternatively, the R functions can be loaded from the R
package <code>sparselink</code>. This chunk also installs missing R
packages from CRAN or Bioconductor.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">path</span> <span class="op">&lt;-</span> <span class="st">"C:/Users/arauschenberger/Desktop/sparselink"</span> <span class="co"># LIH (Windows)</span></span>
<span><span class="co">#path &lt;- "/Users/armin.rauschenberger/Desktop/LIH/sparselink" # LCSB (Mac)</span></span>
<span></span>
<span><span class="va">dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"results"</span>,<span class="st">"manuscript"</span>,<span class="st">"package/R/functions.R"</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">dir</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.exists</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="va">dir</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">&amp;</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="va">dir</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Require folder/file'"</span>,<span class="va">dir</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,<span class="st">"'."</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> </span>
<span><span class="op">}</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">"package/R/functions.R"</span><span class="op">)</span><span class="op">)</span> <span class="co"># Or load 'sparselink' package.</span></span>
<span></span>
<span><span class="va">inst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/installed.packages.html" class="external-link">installed.packages</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pkgs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"knitr"</span>,<span class="st">"rmarkdown"</span>,<span class="st">"glmnet"</span>,<span class="st">"BiocManager"</span>,<span class="st">"mvtnorm"</span>,<span class="st">"glmtrans"</span>,<span class="st">"spls"</span>,<span class="st">"xrnet"</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">pkgs</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="va">pkgs</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span><span class="va">inst</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="va">pkgs</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="va">pkgs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"recount3"</span>,<span class="st">"edgeR"</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">pkgs</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="va">pkgs</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span><span class="va">inst</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu">BiocManager</span><span class="fu">::</span><span class="fu">install</span><span class="op">(</span><span class="va">pkgs</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">blue</span> <span class="op">&lt;-</span> <span class="st">"blue"</span>; <span class="va">red</span> <span class="op">&lt;-</span> <span class="st">"red"</span></span>
<span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html" class="external-link">exists</a></span><span class="op">(</span><span class="st">"sim.app"</span><span class="op">)</span><span class="op">&amp;</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html" class="external-link">exists</a></span><span class="op">(</span><span class="st">"fig.tab"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="va">sim.app</span><span class="op">&amp;</span><span class="va">fig.tab</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"simulation_multiple.RData"</span>,<span class="st">"simulation_transfer.RData"</span>,<span class="st">"recount3_data.RData"</span>,<span class="st">"explore_data.RData"</span>,<span class="st">"application.RData"</span><span class="op">)</span></span>
<span>    <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">files</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">"results"</span>,<span class="va">files</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"File"</span>,<span class="va">files</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,<span class="st">"is missing."</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="methods">Methods<a class="anchor" aria-label="anchor" href="#methods"></a>
</h2>
<p>This chunk generates the figure for the methods section.</p>
<ul>
<li><p>Requires: execution of chunk <code>setup</code></p></li>
<li><p>Execution time: <span class="math inline">\(1\)</span>
second</p></li>
<li><p>Ensures: file <code>fig_flow.eps</code> in folder
<code>manuscript</code></p></li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#&lt;&lt;setup&gt;&gt;</span></span>
<span></span>
<span><span class="fu">grDevices</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grDevices/postscript.html" class="external-link">postscript</a></span><span class="op">(</span>file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">"manuscript"</span>,<span class="st">"fig_flow.eps"</span><span class="op">)</span>,width<span class="op">=</span><span class="fl">6</span>,height<span class="op">=</span><span class="fl">2.5</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/frame.html" class="external-link">plot.new</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.window.html" class="external-link">plot.window</a></span><span class="op">(</span>xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.2</span>,<span class="fl">1.0</span><span class="op">)</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0</span>,<span class="fl">1.0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cex</span> <span class="op">&lt;-</span> <span class="fl">0.8</span></span>
<span></span>
<span><span class="va">pos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>left<span class="op">=</span><span class="fl">0.2</span>,right<span class="op">=</span><span class="fl">0.8</span>,top<span class="op">=</span><span class="fl">0.8</span>,centre<span class="op">=</span><span class="fl">0.45</span>,bottom<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="va">mar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>vertical<span class="op">=</span><span class="fl">0.08</span>,horizontal<span class="op">=</span><span class="fl">0.08</span>,dist<span class="op">=</span><span class="fl">0.04</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"problem"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>,x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">pos</span><span class="op">$</span><span class="va">left</span>,<span class="va">pos</span><span class="op">$</span><span class="va">right</span><span class="op">)</span>,y<span class="op">=</span><span class="va">pos</span><span class="op">$</span><span class="va">top</span><span class="op">+</span><span class="fl">2</span><span class="op">*</span><span class="va">mar</span><span class="op">$</span><span class="va">vertical</span>,font<span class="op">=</span><span class="fl">2</span>,col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">blue</span>,<span class="va">red</span><span class="op">)</span>,cex<span class="op">=</span><span class="va">cex</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html" class="external-link">hat</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span><span class="op">[</span><span class="st">"j,1"</span><span class="op">]</span><span class="op">^</span><span class="op">{</span><span class="va">init</span><span class="op">}</span><span class="op">)</span>,x<span class="op">=</span><span class="va">pos</span><span class="op">$</span><span class="va">left</span>,y<span class="op">=</span><span class="va">pos</span><span class="op">$</span><span class="va">top</span>,col<span class="op">=</span><span class="va">blue</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html" class="external-link">hat</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span><span class="op">[</span><span class="st">"j,2"</span><span class="op">]</span><span class="op">^</span><span class="op">{</span><span class="va">init</span><span class="op">}</span><span class="op">)</span>,x<span class="op">=</span><span class="va">pos</span><span class="op">$</span><span class="va">right</span>,y<span class="op">=</span><span class="va">pos</span><span class="op">$</span><span class="va">top</span>,col<span class="op">=</span><span class="va">red</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/arrows.html" class="external-link">arrows</a></span><span class="op">(</span>x0<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">pos</span><span class="op">$</span><span class="va">left</span>,<span class="va">pos</span><span class="op">$</span><span class="va">right</span><span class="op">)</span>,each<span class="op">=</span><span class="fl">2</span><span class="op">)</span>,x1<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">pos</span><span class="op">$</span><span class="va">left</span>,<span class="va">pos</span><span class="op">$</span><span class="va">right</span><span class="op">)</span>,times<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="va">mar</span><span class="op">$</span><span class="va">horizontal</span>,<span class="op">-</span><span class="va">mar</span><span class="op">$</span><span class="va">horizontal</span>,<span class="va">mar</span><span class="op">$</span><span class="va">horizontal</span>,<span class="va">mar</span><span class="op">$</span><span class="va">horizontal</span><span class="op">)</span>,y0<span class="op">=</span><span class="va">pos</span><span class="op">$</span><span class="va">top</span><span class="op">-</span><span class="va">mar</span><span class="op">$</span><span class="va">vertical</span>,y1<span class="op">=</span><span class="va">pos</span><span class="op">$</span><span class="va">centre</span><span class="op">+</span><span class="va">mar</span><span class="op">$</span><span class="va">vertical</span>,length<span class="op">=</span><span class="fl">0.1</span>,col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">blue</span>,<span class="va">red</span><span class="op">)</span>,each<span class="op">=</span><span class="fl">2</span><span class="op">)</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">w</span><span class="op">[</span><span class="st">"j,1"</span><span class="op">]</span><span class="op">^</span><span class="op">{</span><span class="va">int</span><span class="op">}</span><span class="op">)</span>,x<span class="op">=</span><span class="va">pos</span><span class="op">$</span><span class="va">left</span><span class="op">-</span><span class="va">mar</span><span class="op">$</span><span class="va">horizontal</span><span class="op">-</span><span class="va">mar</span><span class="op">$</span><span class="va">dist</span>,y<span class="op">=</span><span class="va">pos</span><span class="op">$</span><span class="va">centre</span>,col<span class="op">=</span><span class="va">blue</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">w</span><span class="op">[</span><span class="st">"p+j,1"</span><span class="op">]</span><span class="op">^</span><span class="op">{</span><span class="va">int</span><span class="op">}</span><span class="op">)</span>,x<span class="op">=</span><span class="va">pos</span><span class="op">$</span><span class="va">left</span><span class="op">-</span><span class="va">mar</span><span class="op">$</span><span class="va">horizontal</span><span class="op">+</span><span class="va">mar</span><span class="op">$</span><span class="va">dist</span>,y<span class="op">=</span><span class="va">pos</span><span class="op">$</span><span class="va">centre</span>,col<span class="op">=</span><span class="va">blue</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">w</span><span class="op">[</span><span class="st">"j,1"</span><span class="op">]</span><span class="op">^</span><span class="op">{</span><span class="va">ext</span><span class="op">}</span><span class="op">)</span>,x<span class="op">=</span><span class="va">pos</span><span class="op">$</span><span class="va">left</span><span class="op">+</span><span class="va">mar</span><span class="op">$</span><span class="va">horizontal</span><span class="op">-</span><span class="va">mar</span><span class="op">$</span><span class="va">dist</span>,y<span class="op">=</span><span class="va">pos</span><span class="op">$</span><span class="va">centre</span>,col<span class="op">=</span><span class="va">red</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">w</span><span class="op">[</span><span class="st">"p+j,1"</span><span class="op">]</span><span class="op">^</span><span class="op">{</span><span class="va">ext</span><span class="op">}</span><span class="op">)</span>,x<span class="op">=</span><span class="va">pos</span><span class="op">$</span><span class="va">left</span><span class="op">+</span><span class="va">mar</span><span class="op">$</span><span class="va">horizontal</span><span class="op">+</span><span class="va">mar</span><span class="op">$</span><span class="va">dist</span>,y<span class="op">=</span><span class="va">pos</span><span class="op">$</span><span class="va">centre</span>,col<span class="op">=</span><span class="va">red</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">w</span><span class="op">[</span><span class="st">"j,2"</span><span class="op">]</span><span class="op">^</span><span class="op">{</span><span class="va">ext</span><span class="op">}</span><span class="op">)</span>,x<span class="op">=</span><span class="va">pos</span><span class="op">$</span><span class="va">right</span><span class="op">-</span><span class="va">mar</span><span class="op">$</span><span class="va">horizontal</span><span class="op">-</span><span class="va">mar</span><span class="op">$</span><span class="va">dist</span>,y<span class="op">=</span><span class="va">pos</span><span class="op">$</span><span class="va">centre</span>,col<span class="op">=</span><span class="va">blue</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">w</span><span class="op">[</span><span class="st">"p+j,2"</span><span class="op">]</span><span class="op">^</span><span class="op">{</span><span class="va">ext</span><span class="op">}</span><span class="op">)</span>,x<span class="op">=</span><span class="va">pos</span><span class="op">$</span><span class="va">right</span><span class="op">-</span><span class="va">mar</span><span class="op">$</span><span class="va">horizontal</span><span class="op">+</span><span class="va">mar</span><span class="op">$</span><span class="va">dist</span>,y<span class="op">=</span><span class="va">pos</span><span class="op">$</span><span class="va">centre</span>,col<span class="op">=</span><span class="va">blue</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">w</span><span class="op">[</span><span class="st">"j,2"</span><span class="op">]</span><span class="op">^</span><span class="op">{</span><span class="va">int</span><span class="op">}</span><span class="op">)</span>,x<span class="op">=</span><span class="va">pos</span><span class="op">$</span><span class="va">right</span><span class="op">+</span><span class="va">mar</span><span class="op">$</span><span class="va">horizontal</span><span class="op">-</span><span class="va">mar</span><span class="op">$</span><span class="va">dist</span>,y<span class="op">=</span><span class="va">pos</span><span class="op">$</span><span class="va">centre</span>,col<span class="op">=</span><span class="va">red</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">w</span><span class="op">[</span><span class="st">"p+j,2"</span><span class="op">]</span><span class="op">^</span><span class="op">{</span><span class="va">int</span><span class="op">}</span><span class="op">)</span>,x<span class="op">=</span><span class="va">pos</span><span class="op">$</span><span class="va">right</span><span class="op">+</span><span class="va">mar</span><span class="op">$</span><span class="va">horizontal</span><span class="op">+</span><span class="va">mar</span><span class="op">$</span><span class="va">dist</span>,y<span class="op">=</span><span class="va">pos</span><span class="op">$</span><span class="va">centre</span>,col<span class="op">=</span><span class="va">red</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/arrows.html" class="external-link">arrows</a></span><span class="op">(</span>x0<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">pos</span><span class="op">$</span><span class="va">left</span>,<span class="va">pos</span><span class="op">$</span><span class="va">right</span><span class="op">)</span>,y0<span class="op">=</span><span class="va">pos</span><span class="op">$</span><span class="va">centre</span><span class="op">-</span><span class="va">mar</span><span class="op">$</span><span class="va">vertical</span>,y1<span class="op">=</span><span class="va">pos</span><span class="op">$</span><span class="va">bottom</span><span class="op">+</span><span class="va">mar</span><span class="op">$</span><span class="va">vertical</span>,col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">blue</span>,<span class="va">red</span><span class="op">)</span>,length<span class="op">=</span><span class="fl">0.1</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html" class="external-link">hat</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span><span class="op">[</span><span class="st">"j,1"</span><span class="op">]</span><span class="op">^</span><span class="op">{</span><span class="va">final</span><span class="op">}</span><span class="op">==</span><span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html" class="external-link">hat</a></span><span class="op">(</span><span class="va">gamma</span><span class="op">)</span><span class="op">[</span><span class="st">"j,1"</span><span class="op">]</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html" class="external-link">hat</a></span><span class="op">(</span><span class="va">gamma</span><span class="op">)</span><span class="op">[</span><span class="st">"p+j,1"</span><span class="op">]</span><span class="op">)</span>,x<span class="op">=</span><span class="va">pos</span><span class="op">$</span><span class="va">left</span>,y<span class="op">=</span><span class="va">pos</span><span class="op">$</span><span class="va">bottom</span>,col<span class="op">=</span><span class="va">blue</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html" class="external-link">hat</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span><span class="op">[</span><span class="st">"j,2"</span><span class="op">]</span><span class="op">^</span><span class="op">{</span><span class="va">final</span><span class="op">}</span><span class="op">==</span><span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html" class="external-link">hat</a></span><span class="op">(</span><span class="va">gamma</span><span class="op">)</span><span class="op">[</span><span class="st">"j,2"</span><span class="op">]</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html" class="external-link">hat</a></span><span class="op">(</span><span class="va">gamma</span><span class="op">)</span><span class="op">[</span><span class="st">"p+j,2"</span><span class="op">]</span><span class="op">)</span>,x<span class="op">=</span><span class="va">pos</span><span class="op">$</span><span class="va">right</span>,y<span class="op">=</span><span class="va">pos</span><span class="op">$</span><span class="va">bottom</span>,col<span class="op">=</span><span class="va">red</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>x<span class="op">=</span><span class="op">-</span><span class="fl">0.1</span>,y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">pos</span><span class="op">$</span><span class="va">top</span>,<span class="va">pos</span><span class="op">$</span><span class="va">bottom</span><span class="op">)</span>,labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"stage"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>,font<span class="op">=</span><span class="fl">2</span>,cex<span class="op">=</span><span class="va">cex</span><span class="op">)</span></span>
<span><span class="fu">grDevices</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="simulation">Simulation<a class="anchor" aria-label="anchor" href="#simulation"></a>
</h2>
<p>This chunk performs the simulation.</p>
<ul>
<li><p>Requires: execution of chunk <code>setup</code></p></li>
<li><p>Execution time: <strong>0.5 hours</strong></p></li>
<li><p>Ensures: files <code>simulation_transfer.RData</code> (transfer
learning), <code>simulation_multiple.RData</code> (multi-task learning)
and <code>info_sim.txt</code> (session information) in folder
<code>results</code></p></li>
</ul>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#&lt;&lt;setup&gt;&gt;</span></span>
<span></span>
<span><span class="va">alpha.init</span> <span class="op">&lt;-</span> <span class="fl">0.95</span>; <span class="va">type</span> <span class="op">&lt;-</span> <span class="st">"exp"</span>;  <span class="va">repetitions</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">mode</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"transfer"</span>,<span class="st">"multiple"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>prob.separate<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0</span>,<span class="fl">0.025</span>,<span class="fl">0.05</span><span class="op">)</span>,prob.common<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0</span>,<span class="fl">0.025</span>,<span class="fl">0.05</span><span class="op">)</span>,family<span class="op">=</span><span class="st">"gaussian"</span><span class="op">)</span></span>
<span>  <span class="va">grid</span> <span class="op">&lt;-</span> <span class="va">grid</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span><span class="op">)</span>,each<span class="op">=</span><span class="va">repetitions</span><span class="op">)</span>,<span class="op">]</span> <span class="co">#</span></span>
<span>  <span class="va">grid</span><span class="op">$</span><span class="va">seed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">grid</span><span class="op">$</span><span class="va">family</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">grid</span><span class="op">$</span><span class="va">family</span><span class="op">)</span></span>
<span>  <span class="va">deviance</span> <span class="op">&lt;-</span> <span class="va">auc</span> <span class="op">&lt;-</span> <span class="va">time</span> <span class="op">&lt;-</span> <span class="va">mse.coef</span> <span class="op">&lt;-</span> <span class="va">mse.zero</span> <span class="op">&lt;-</span> <span class="va">mse.nzero</span> <span class="op">&lt;-</span> <span class="va">sel.num</span> <span class="op">&lt;-</span> <span class="va">sel.coef</span> <span class="op">&lt;-</span> <span class="va">sel.count</span> <span class="op">&lt;-</span> <span class="va">hyperpar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="fl">1</span>,to<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span>seed<span class="op">=</span><span class="va">grid</span><span class="op">$</span><span class="va">seed</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"i="</span>,<span class="va">i</span>,<span class="st">"\n"</span><span class="op">)</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">mode</span><span class="op">==</span><span class="st">"transfer"</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim.data.transfer.html">sim.data.transfer</a></span><span class="op">(</span>prob.common<span class="op">=</span><span class="va">grid</span><span class="op">$</span><span class="va">prob.common</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,prob.separate<span class="op">=</span><span class="va">grid</span><span class="op">$</span><span class="va">prob.separate</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,family<span class="op">=</span><span class="va">grid</span><span class="op">$</span><span class="va">family</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>      <span class="va">method</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"glm.separate"</span>,<span class="st">"glm.glmtrans"</span>,<span class="st">"sparselink"</span>,<span class="st">"glm.xrnet"</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">mode</span><span class="op">==</span><span class="st">"multiple"</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="co">#--- multi-task learning ---</span></span>
<span>      <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim.data.multiple.html">sim.data.multiple</a></span><span class="op">(</span>prob.common<span class="op">=</span><span class="va">grid</span><span class="op">$</span><span class="va">prob.common</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,prob.separate<span class="op">=</span><span class="va">grid</span><span class="op">$</span><span class="va">prob.separate</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,family<span class="op">=</span><span class="va">grid</span><span class="op">$</span><span class="va">family</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>      <span class="va">method</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"glm.separate"</span>,<span class="st">"glm.mgaussian"</span>,<span class="st">"sparselink"</span>,<span class="st">"glm.spls"</span><span class="op">)</span> <span class="co"># add glmnet "mgaussian" (only for linear case) or "MTPS" (not sparse)?</span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>    <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/traintest.html">traintest</a></span><span class="op">(</span>y_train<span class="op">=</span><span class="va">data</span><span class="op">$</span><span class="va">y_train</span>,X_train<span class="op">=</span><span class="va">data</span><span class="op">$</span><span class="va">X_train</span>,y_test<span class="op">=</span><span class="va">data</span><span class="op">$</span><span class="va">y_test</span>,X_test<span class="op">=</span><span class="va">data</span><span class="op">$</span><span class="va">X_test</span>,family<span class="op">=</span><span class="va">grid</span><span class="op">$</span><span class="va">family</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,method<span class="op">=</span><span class="va">method</span>,alpha.init<span class="op">=</span><span class="va">alpha.init</span>,type<span class="op">=</span><span class="va">type</span>,alpha<span class="op">=</span><span class="fl">1</span>,trial<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span>    <span class="va">hyperpar</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">hyperpar</span></span>
<span>    <span class="va">time</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">time</span></span>
<span>    <span class="va">auc</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">auc</span></span>
<span>    <span class="va">deviance</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">deviance</span></span>
<span>    <span class="va">sel.num</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">coef</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">x</span><span class="op">!=</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">sel.count</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">coef</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="fu"><a href="../reference/count_vector.html">count_matrix</a></span><span class="op">(</span>truth<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sign.html" class="external-link">sign</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">beta</span><span class="op">)</span>,estim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sign.html" class="external-link">sign</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co"># Add na.rm=TRUE?</span></span>
<span>    </span>
<span>    <span class="va">sel.coef</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">coef</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sign.html" class="external-link">sign</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">!=</span><span class="fu"><a href="https://rdrr.io/r/base/sign.html" class="external-link">sign</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">beta</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="co"># CONTINUE HERE: consider sparsity, true positives, false negatives, signs</span></span>
<span>    </span>
<span>    <span class="va">mse.coef</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">coef</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">beta</span><span class="op">-</span><span class="va">x</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">mse.zero</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">coef</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="op">(</span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">beta</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">beta</span><span class="op">-</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">mse.nzero</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">coef</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="op">(</span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">beta</span><span class="op">!=</span><span class="fl">0</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">beta</span><span class="op">-</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">grid</span>,<span class="va">deviance</span>,<span class="va">auc</span>,<span class="va">sel.num</span>,<span class="va">sel.count</span>,<span class="va">sel.coef</span>,<span class="va">mse.coef</span>,<span class="va">mse.zero</span>,<span class="va">mse.nzero</span>,<span class="va">time</span>,file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">"results"</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"simulation_"</span>,<span class="va">mode</span>,<span class="st">".RData"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span>text<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/utils/capture.output.html" class="external-link">capture.output</a></span><span class="op">(</span><span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span>,      <span class="fu">sessioninfo</span><span class="fu">::</span><span class="fu"><a href="https://sessioninfo.r-lib.org/reference/session_info.html" class="external-link">session_info</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,con<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">"/results/info_sim.txt"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The following chunk generate the figures for the simulation
study.</p>
<ul>
<li><p>Requires: execution of chunk <code>setup</code>, files
<code>simulation_transfer.RData</code> and
<code>simulation_multiple.RData</code> in folder <code>results</code>
(generated by chunk <code>simulation</code>)</p></li>
<li><p>execution time: <span class="math inline">\(1\)</span>
second</p></li>
<li><p>Ensures: files <code>fig_sim_multiple.eps</code> and
<code>fig_sim_transfer.eps</code> in folder
<code>manuscript</code></p></li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#&lt;&lt;setup&gt;&gt;</span></span>
<span></span>
<span><span class="va">caption</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"\\textbf{Multi-task learning.}"</span>,<span class="st">"\\textbf{Transfer learning.}"</span><span class="op">)</span>,<span class="st">"Comparison of different measures (rows) between an available method (red) and the proposed method (blue) in different simulation settings (columns), based on the average of three problems"</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"(tasks)"</span>,<span class="st">"(datasets)"</span><span class="op">)</span>,<span class="st">"for each repetition out of ten. Measures: performance metric (mean squared error on hold-out data, as a fraction of the one from standard lasso regression; a point below the dashed line means that"</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"multi-task"</span>,<span class="st">"transfer"</span><span class="op">)</span>,<span class="st">"learning improves predictions), sparsity (number of non-zero coefficients), precision (number of coefficients with correct signs divided by number of non-zero coefficients). The arrows point in the direction of improvement. Settings: percentage of features with a common effect for all problems ($\\pi_\\theta$), percentage of features with a specific effect for each problem ($\\pi_\\delta$)."</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"\\label{fig_sim_multiple}"</span>,<span class="st">"\\label{fig_sim_transfer}"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">figure_change</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">model0</span>,<span class="va">model1</span><span class="op">=</span><span class="st">"sparselink"</span>,<span class="va">model2</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">mode</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fl">100</span><span class="op">*</span><span class="va">grid</span><span class="op">$</span><span class="va">prob.common</span>,<span class="st">"%\n"</span>,<span class="fl">100</span><span class="op">*</span><span class="va">grid</span><span class="op">$</span><span class="va">prob.separate</span>,<span class="st">"%"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">1</span><span class="op">)</span>,mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">label</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">cex</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span>
<span>    <span class="va">at</span> <span class="op">&lt;-</span> <span class="fl">0.3</span></span>
<span>    <span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span>text<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">pi</span><span class="op">[</span><span class="va">theta</span><span class="op">]</span><span class="op">==</span><span class="fu">phantom</span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span>,side<span class="op">=</span><span class="fl">1</span>,line<span class="op">=</span><span class="fl">0.2</span>,at<span class="op">=</span><span class="va">at</span>,cex<span class="op">=</span><span class="va">cex</span><span class="op">)</span></span>
<span>    <span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span>text<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">pi</span><span class="op">[</span><span class="va">delta</span><span class="op">]</span><span class="op">==</span><span class="fu">phantom</span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span>,side<span class="op">=</span><span class="fl">1</span>,line<span class="op">=</span><span class="fl">1.2</span>,at<span class="op">=</span><span class="va">at</span>,cex<span class="op">=</span><span class="va">cex</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co">#--- predictive performance ---</span></span>
<span>  <span class="va">means</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">deviance</span>,FUN<span class="op">=</span><span class="va">rowMeans</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">means</span> <span class="op">&lt;-</span> <span class="va">means</span><span class="op">/</span><span class="va">means</span><span class="op">[</span>,<span class="st">"glm.separate"</span><span class="op">]</span></span>
<span>  <span class="fu"><a href="../reference/change.html">change</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">mode</span>,y0<span class="op">=</span><span class="va">means</span><span class="op">[</span>,<span class="va">model0</span><span class="op">]</span>,y1<span class="op">=</span><span class="va">means</span><span class="op">[</span>,<span class="va">model1</span><span class="op">]</span>,y2<span class="op">=</span><span class="va">means</span><span class="op">[</span>,<span class="va">model2</span><span class="op">]</span>,main<span class="op">=</span><span class="st">"metric"</span>,increase<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="fl">1</span>,lty<span class="op">=</span><span class="fl">2</span>,col<span class="op">=</span><span class="st">"grey"</span><span class="op">)</span></span>
<span>  <span class="fu">label</span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">#--- sparsity ---</span></span>
<span>  <span class="va">nzero</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">sel.num</span>,FUN<span class="op">=</span><span class="va">rowMeans</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/change.html">change</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">mode</span>,y0<span class="op">=</span><span class="va">nzero</span><span class="op">[</span><span class="va">model0</span>,<span class="op">]</span>,y1<span class="op">=</span><span class="va">nzero</span><span class="op">[</span><span class="va">model1</span>,<span class="op">]</span>,y2<span class="op">=</span><span class="va">nzero</span><span class="op">[</span><span class="va">model2</span>,<span class="op">]</span>,main<span class="op">=</span><span class="st">"sparsity"</span>,increase<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="fl">0</span>,lty<span class="op">=</span><span class="fl">2</span>,col<span class="op">=</span><span class="st">"grey"</span><span class="op">)</span></span>
<span>  <span class="fu">label</span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">#--- precision ---</span></span>
<span>  <span class="va">precision</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">sel.count</span>,FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span>,<span class="st">"precision"</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">precision</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">precision</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>  <span class="fu"><a href="../reference/change.html">change</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">mode</span>,y0<span class="op">=</span><span class="va">precision</span><span class="op">[</span><span class="va">model0</span>,<span class="op">]</span>,y1<span class="op">=</span><span class="va">precision</span><span class="op">[</span><span class="va">model1</span>,<span class="op">]</span>,y2<span class="op">=</span><span class="va">precision</span><span class="op">[</span><span class="va">model2</span>,<span class="op">]</span>,main<span class="op">=</span><span class="st">"precision"</span>,increase<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="fl">0</span>,lty<span class="op">=</span><span class="fl">2</span>,col<span class="op">=</span><span class="st">"grey"</span><span class="op">)</span></span>
<span>  <span class="fu">label</span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">grDevices</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grDevices/postscript.html" class="external-link">postscript</a></span><span class="op">(</span>file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">"manuscript"</span>,<span class="st">"fig_sim_multiple.eps"</span><span class="op">)</span>,width<span class="op">=</span><span class="fl">6.5</span>,height<span class="op">=</span><span class="fl">6</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"results/simulation_multiple.RData"</span><span class="op">)</span><span class="op">)</span>,verbose<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#model.ref &lt;- "glm.mgaussian"</span></span>
<span><span class="co">#model.own &lt;- "sparselink"</span></span>
<span><span class="fu">figure_change</span><span class="op">(</span>model0<span class="op">=</span><span class="st">"glm.mgaussian"</span>,model1<span class="op">=</span><span class="st">"sparselink"</span>,model2<span class="op">=</span><span class="st">"glm.spls"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">deviance</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/rank.html" class="external-link">rank</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">deviance</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">/</span><span class="va">x</span><span class="op">[</span><span class="st">"glm.separate"</span>,<span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">runtime</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">time</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">runtime</span><span class="op">/</span><span class="va">runtime</span><span class="op">[</span><span class="st">"glm.separate"</span><span class="op">]</span>,digits<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu">grDevices</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">grDevices</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grDevices/postscript.html" class="external-link">postscript</a></span><span class="op">(</span>file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">"manuscript"</span>,<span class="st">"fig_sim_transfer.eps"</span><span class="op">)</span>,width<span class="op">=</span><span class="fl">6.5</span>,height<span class="op">=</span><span class="fl">6</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"results/simulation_transfer.RData"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#model.ref &lt;- "glm.glmtrans"</span></span>
<span><span class="co">#model.own &lt;- "sparselink"</span></span>
<span><span class="fu">figure_change</span><span class="op">(</span>model0<span class="op">=</span><span class="st">"glm.glmtrans"</span>,model1<span class="op">=</span><span class="st">"sparselink"</span>,model2<span class="op">=</span><span class="st">"glm.xrnet"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">deviance</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/rank.html" class="external-link">rank</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">deviance</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">/</span><span class="va">x</span><span class="op">[</span><span class="st">"glm.separate"</span>,<span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">runtime</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">time</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">runtime</span><span class="op">/</span><span class="va">runtime</span><span class="op">[</span><span class="st">"glm.separate"</span><span class="op">]</span>,digits<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu">grDevices</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="sample-size-and-sparsity-under-development">Sample size and sparsity (under development)<a class="anchor" aria-label="anchor" href="#sample-size-and-sparsity-under-development"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Effect of sample size in source or target dataset (TL), effect of sample size (MTL).</span></span>
<span><span class="co">#&lt;&lt;setup&gt;&gt;</span></span>
<span></span>
<span><span class="va">alpha.init</span> <span class="op">&lt;-</span> <span class="fl">0.95</span>; <span class="va">type</span> <span class="op">&lt;-</span> <span class="st">"exp"</span>;  <span class="va">repetitions</span> <span class="op">&lt;-</span> <span class="fl">50</span> <span class="co"># was repetitions &lt;- 10</span></span>
<span><span class="va">grid</span> <span class="op">&lt;-</span> <span class="va">metric</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">mode</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MTL-size"</span>,<span class="st">"TL-source"</span>,<span class="st">"TL-target"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span> <span class="co">#,"TL-prop","MTL-prop"</span></span>
<span>  <span class="va">metric</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">cand</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>,<span class="fl">40</span>,<span class="fl">60</span>,<span class="fl">80</span>,<span class="fl">100</span><span class="op">)</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">mode</span><span class="op">==</span><span class="st">"MTL-size"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>prob.common<span class="op">=</span><span class="fl">0.05</span>,prob.separate<span class="op">=</span><span class="fl">0.025</span>,family<span class="op">=</span><span class="st">"gaussian"</span>,n0<span class="op">=</span><span class="va">cand</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">mode</span><span class="op">==</span><span class="st">"TL-source"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>prob.common<span class="op">=</span><span class="fl">0.05</span>,prob.separate<span class="op">=</span><span class="fl">0.025</span>,family<span class="op">=</span><span class="st">"gaussian"</span>,n_source<span class="op">=</span><span class="va">cand</span>,n_target<span class="op">=</span><span class="fl">50</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">mode</span><span class="op">==</span><span class="st">"TL-target"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>prob.common<span class="op">=</span><span class="fl">0.05</span>,prob.separate<span class="op">=</span><span class="fl">0.025</span>,family<span class="op">=</span><span class="st">"gaussian"</span>,n_source<span class="op">=</span><span class="fl">50</span>,n_target<span class="op">=</span><span class="va">cand</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">mode</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TL-prop"</span>,<span class="st">"MTL-prop"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">cand</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>,<span class="fl">0.05</span>,<span class="fl">0.10</span>,<span class="fl">0.15</span>,<span class="fl">0.20</span><span class="op">)</span></span>
<span>    <span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>prob.common<span class="op">=</span><span class="va">cand</span>,prob.separate<span class="op">=</span><span class="cn">NA</span>,family<span class="op">=</span><span class="st">"gaussian"</span>,n_source<span class="op">=</span><span class="fl">50</span>,n_target<span class="op">=</span><span class="fl">50</span>,n0<span class="op">=</span><span class="fl">50</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Wrong mode."</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,each<span class="op">=</span><span class="va">repetitions</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  <span class="co">#grid[[mode]]$seed &lt;- seq_len(nrow(grid[[mode]]))</span></span>
<span>  <span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">seed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">repetitions</span><span class="op">)</span>,times<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">cand</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">family</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">family</span><span class="op">)</span></span>
<span>  <span class="va">cond</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">prob.separate</span><span class="op">)</span></span>
<span>  <span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">prob.separate</span><span class="op">[</span><span class="va">cond</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.5</span><span class="op">*</span><span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">prob.common</span><span class="op">[</span><span class="va">cond</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="fl">1</span>,to<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span>seed<span class="op">=</span><span class="va">grid</span><span class="op">$</span><span class="va">seed</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"i="</span>,<span class="va">i</span>,<span class="st">"\n"</span><span class="op">)</span></span>
<span>      <span class="kw">if</span><span class="op">(</span><span class="va">mode</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TL-source"</span>,<span class="st">"TL-target"</span>,<span class="st">"TL-prop"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="va">n0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">n_source</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,<span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">n_target</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>,times<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim.data.transfer.html">sim.data.transfer</a></span><span class="op">(</span>prob.common<span class="op">=</span><span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">prob.common</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,prob.separate<span class="op">=</span><span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">prob.separate</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,family<span class="op">=</span><span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">family</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,n0<span class="op">=</span><span class="va">n0</span><span class="op">)</span></span>
<span>        <span class="va">method</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"glm.separate"</span>,<span class="st">"glm.glmtrans"</span>,<span class="st">"sparselink"</span>,<span class="st">"glm.xrnet"</span><span class="op">)</span></span>
<span>      <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">mode</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MTL-size"</span>,<span class="st">"MTL-prop"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim.data.multiple.html">sim.data.multiple</a></span><span class="op">(</span>prob.common<span class="op">=</span><span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">prob.common</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,prob.separate<span class="op">=</span><span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">prob.separate</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,family<span class="op">=</span><span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">family</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,n0<span class="op">=</span><span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">n0</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>        <span class="va">method</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"glm.separate"</span>,<span class="st">"glm.mgaussian"</span>,<span class="st">"sparselink"</span>,<span class="st">"glm.spls"</span><span class="op">)</span></span>
<span>      <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Wrong mode."</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>      <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/traintest.html">traintest</a></span><span class="op">(</span>y_train<span class="op">=</span><span class="va">data</span><span class="op">$</span><span class="va">y_train</span>,X_train<span class="op">=</span><span class="va">data</span><span class="op">$</span><span class="va">X_train</span>,y_test<span class="op">=</span><span class="va">data</span><span class="op">$</span><span class="va">y_test</span>,X_test<span class="op">=</span><span class="va">data</span><span class="op">$</span><span class="va">X_test</span>,family<span class="op">=</span><span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">family</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,method<span class="op">=</span><span class="va">method</span>,alpha.init<span class="op">=</span><span class="va">alpha.init</span>,type<span class="op">=</span><span class="va">type</span>,alpha<span class="op">=</span><span class="fl">1</span>,trial<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span>      <span class="va">metric</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">deviance</span></span>
<span>    <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">grid</span>,<span class="va">metric</span>,file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">"results"</span>,<span class="st">"simulation_devel.RData"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#&lt;&lt;setup&gt;&gt;</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">"results"</span>,<span class="st">"simulation_devel.RData"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">grDevices</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grDevices/postscript.html" class="external-link">postscript</a></span><span class="op">(</span>file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">"manuscript"</span>,<span class="st">"fig_sim_extra.eps"</span><span class="op">)</span>,width<span class="op">=</span><span class="fl">6.5</span>,height<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">cex</span> <span class="op">&lt;-</span> <span class="fl">0.8</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>,mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4.5</span>,<span class="fl">4.5</span>,<span class="fl">1.5</span>,<span class="fl">1</span><span class="op">)</span>,oma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#graphics::layout(mat=matrix(data=c(1,1,2,2,3,3,0,4,4,0,5,5),ncol=2))</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">mode</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MTL-size"</span>,<span class="st">"TL-source"</span>,<span class="st">"TL-target"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span><span class="co">#for(mode in c("MTL-prop","TL-prop")){</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">mode</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MTL-size"</span>,<span class="st">"MTL-prop"</span>,<span class="st">"TL-prop"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">mse</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">metric</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">mode</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TL-source"</span>,<span class="st">"TL-target"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">mse</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">metric</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">mode</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TL-source"</span>,<span class="st">"TL-target"</span>,<span class="st">"TL-prop"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"glm.separate"</span><span class="op">=</span><span class="st">"black"</span>,<span class="st">"glm.glmtrans"</span><span class="op">=</span><span class="st">"red"</span>,<span class="st">"glm.xrnet"</span><span class="op">=</span><span class="st">"orange"</span>,<span class="st">"sparselink"</span><span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></span>
<span>    <span class="va">lty</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"glm.separate"</span><span class="op">=</span><span class="fl">3</span>,<span class="st">"glm.glmtrans"</span><span class="op">=</span><span class="fl">2</span>,<span class="st">"glm.xrnet"</span><span class="op">=</span><span class="fl">2</span>,<span class="st">"sparselink"</span><span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">mode</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MTL-size"</span>,<span class="st">"MTL-prop"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"glm.separate"</span><span class="op">=</span><span class="st">"black"</span>,<span class="st">"glm.mgaussian"</span><span class="op">=</span><span class="st">"red"</span>,<span class="st">"glm.spls"</span><span class="op">=</span><span class="st">"orange"</span>,<span class="st">"sparselink"</span><span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></span>
<span>    <span class="va">lty</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"glm.separate"</span><span class="op">=</span><span class="fl">3</span>,<span class="st">"glm.mgaussian"</span><span class="op">=</span><span class="fl">2</span>,<span class="st">"glm.spls"</span><span class="op">=</span><span class="fl">2</span>,<span class="st">"sparselink"</span><span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">mode</span><span class="op">==</span><span class="st">"TL-source"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">params</span> <span class="op">&lt;-</span> <span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">n_source</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">mode</span><span class="op">==</span><span class="st">"TL-target"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">params</span> <span class="op">&lt;-</span> <span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">n_target</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">mode</span><span class="op">==</span><span class="st">"MTL-size"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">params</span> <span class="op">&lt;-</span> <span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">n0</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">mode</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TL-prop"</span>,<span class="st">"MTL-prop"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">params</span> <span class="op">&lt;-</span> <span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">prob.common</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">unique</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span></span>
<span>  <span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/frame.html" class="external-link">plot.new</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.window.html" class="external-link">plot.window</a></span><span class="op">(</span>xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">mse</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/box.html" class="external-link">box</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">mode</span><span class="op">==</span><span class="st">"MTL-size"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">main</span> <span class="op">&lt;-</span> <span class="st">"MTL - varying sample size"</span></span>
<span>    <span class="va">xlab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote</a></span><span class="op">(</span><span class="st">"sample size ("</span><span class="op">~</span><span class="va">n</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">~</span><span class="st">"="</span><span class="op">~</span><span class="va">n</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">~</span><span class="st">"="</span><span class="op">~</span><span class="va">n</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">~</span><span class="st">")"</span><span class="op">)</span></span>
<span>    <span class="va">legend</span> <span class="op">&lt;-</span> <span class="st">""</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">mode</span><span class="op">==</span><span class="st">"TL-source"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">main</span> <span class="op">&lt;-</span> <span class="st">"TL - varying source sample size"</span></span>
<span>    <span class="va">xlab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote</a></span><span class="op">(</span><span class="st">"source sample size ("</span><span class="op">~</span><span class="va">n</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">~</span><span class="st">"="</span><span class="op">~</span><span class="va">n</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">~</span><span class="st">")"</span><span class="op">)</span></span>
<span>    <span class="va">legend</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote</a></span><span class="op">(</span><span class="st">"target sample size:"</span><span class="op">~</span><span class="va">n</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">==</span><span class="fu">.</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">n_target</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">mode</span><span class="op">==</span><span class="st">"TL-target"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">main</span> <span class="op">&lt;-</span> <span class="st">"TL - varying target sample size"</span></span>
<span>    <span class="va">xlab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote</a></span><span class="op">(</span><span class="st">"target sample size ("</span><span class="op">~</span><span class="va">n</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">~</span><span class="st">")"</span><span class="op">)</span></span>
<span>    <span class="va">legend</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote</a></span><span class="op">(</span><span class="st">"source sample size:"</span><span class="op">~</span><span class="va">n</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">~</span><span class="st">"="</span><span class="op">~</span><span class="va">n</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">==</span><span class="fu">.</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">grid</span><span class="op">[[</span><span class="va">mode</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">n_source</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">mode</span><span class="op">==</span><span class="st">"MTL-prop"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">xlab</span> <span class="op">&lt;-</span> <span class="st">"blabla"</span></span>
<span>    <span class="va">main</span> <span class="op">&lt;-</span> <span class="st">"MTL - effect proportion"</span></span>
<span>    <span class="va">legend</span> <span class="op">&lt;-</span> <span class="st">""</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">mode</span><span class="op">==</span><span class="st">"TL-prop"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">xlab</span> <span class="op">&lt;-</span> <span class="st">"blabla"</span></span>
<span>    <span class="va">main</span> <span class="op">&lt;-</span> <span class="st">"TL - effect proportion"</span></span>
<span>    <span class="va">legend</span> <span class="op">&lt;-</span> <span class="st">""</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span>main<span class="op">=</span><span class="va">main</span>,cex.main<span class="op">=</span><span class="va">cex</span><span class="op">)</span></span>
<span>  <span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span>ylab<span class="op">=</span><span class="st">"log MSE"</span>,line<span class="op">=</span><span class="fl">2.5</span>,xlab<span class="op">=</span><span class="va">xlab</span>,cex.lab<span class="op">=</span><span class="va">cex</span><span class="op">)</span></span>
<span>  <span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">"topleft"</span>,legend<span class="op">=</span><span class="va">legend</span>,bty<span class="op">=</span><span class="st">"n"</span>,cex<span class="op">=</span><span class="va">cex</span><span class="op">)</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">mode</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TL-prop"</span>,<span class="st">"MTL-prop"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span>side<span class="op">=</span><span class="fl">1</span>,at<span class="op">=</span><span class="va">unique</span>,labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fl">100</span><span class="op">*</span><span class="va">unique</span>,<span class="st">"%"</span><span class="op">)</span>,cex.axis<span class="op">=</span><span class="va">cex</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span>side<span class="op">=</span><span class="fl">1</span>,at<span class="op">=</span><span class="va">unique</span>,cex.axis<span class="op">=</span><span class="va">cex</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span>side<span class="op">=</span><span class="fl">2</span>,cex.axis<span class="op">=</span><span class="va">cex</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">col</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">val</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">mse</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span>,INDEX<span class="op">=</span><span class="va">params</span>,FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">unique</span>,y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">val</span><span class="op">)</span>,col<span class="op">=</span><span class="va">col</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,type<span class="op">=</span><span class="st">"o"</span>,pch<span class="op">=</span><span class="fl">16</span>,lty<span class="op">=</span><span class="va">lty</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">grDevices</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Change settings so that competing methods are useful.</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="application">Application<a class="anchor" aria-label="anchor" href="#application"></a>
</h2>
<div class="section level3">
<h3 id="data-preparation">Data preparation<a class="anchor" aria-label="anchor" href="#data-preparation"></a>
</h3>
<p>This chunk defines the references and the project identifiers for the
application.</p>
<ul>
<li><p>Requires: nothing</p></li>
<li><p>Execution time: <span class="math inline">\(1\)</span>
second</p></li>
<li><p>Ensures: list <code>project</code> in working
environment</p></li>
</ul>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">project</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">project</span><span class="op">$</span><span class="va">IBD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Tew (2016)"</span><span class="op">=</span><span class="st">"SRP063496"</span>,</span>
<span>                 <span class="st">"Haberman (2019)"</span><span class="op">=</span><span class="st">"SRP129004"</span>,</span>
<span>                 <span class="st">"Verstockt (2019)"</span><span class="op">=</span><span class="st">"ERP113396"</span>,</span>
<span>                 <span class="st">"Verstockt (2020)"</span><span class="op">=</span><span class="st">"ERP114636"</span>,</span>
<span>                 <span class="st">"Boyd (2018)"</span><span class="op">=</span><span class="st">"SRP100787"</span><span class="op">)</span></span>
<span><span class="va">project</span><span class="op">$</span><span class="va">RA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Baker (2019)"</span><span class="op">=</span><span class="st">"SRP169062"</span>,</span>
<span>                <span class="st">"Moncrieffe (2017)"</span><span class="op">=</span><span class="st">"SRP074736"</span>,</span>
<span>                <span class="st">"Goldberg (2018)"</span><span class="op">=</span><span class="st">"SRP155483"</span><span class="op">)</span></span>
<span><span class="va">extra</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Lewis (2019)"</span><span class="op">=</span><span class="st">"ERP104864"</span><span class="op">)</span> <span class="co"># https://doi.org/10.1016/j.celrep.2019.07.091</span></span></code></pre></div>
<p>This chunk downloads the data for the application.</p>
<ul>
<li><p>Requires: execution of chunks <code>setup</code> and
<code>define_projects</code></p></li>
<li><p>Execution time: depends on internet speed and cached
files</p></li>
<li><p>Ensures: files <code>recount3_data.RData</code> (data sets) and
<code>info_data.txt</code> (system information) in folder
<code>results</code></p></li>
</ul>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#&lt;&lt;setup&gt;&gt;</span></span>
<span><span class="co">#&lt;&lt;define_projects&gt;&gt;</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">project</span><span class="op">)</span>,<span class="va">extra</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">data</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">recount3</span><span class="fu">::</span><span class="fu">create_rse_manual</span><span class="op">(</span></span>
<span>    project<span class="op">=</span><span class="va">i</span>,</span>
<span>    project_home<span class="op">=</span><span class="st">"data_sources/sra"</span>,</span>
<span>    organism<span class="op">=</span><span class="st">"human"</span>,</span>
<span>    annotation <span class="op">=</span> <span class="st">"gencode_v26"</span>,</span>
<span>    type<span class="op">=</span><span class="st">"gene"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">data</span>,file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">"results/recount3_data.RData"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span>text<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/utils/capture.output.html" class="external-link">capture.output</a></span><span class="op">(</span><span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span>,</span>
<span>      <span class="fu">sessioninfo</span><span class="fu">::</span><span class="fu"><a href="https://sessioninfo.r-lib.org/reference/session_info.html" class="external-link">session_info</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,con<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">"/results/info_data.txt"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>This chunk preprocesses the data.</p>
<ul>
<li><p>Requires: execution of chunks <code>setup</code> and
<code>define_projects</code>, file <code>recount3_data.RData</code>
(generated by chunk <code>download_data</code>)</p></li>
<li><p>Execution time: <span class="math inline">\(5\)</span>
seconds</p></li>
<li><p>Ensures: lists <code>y</code> (targets) and <code>x</code>
(features) in working environment</p></li>
</ul>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#&lt;&lt;setup&gt;&gt;</span></span>
<span><span class="co">#&lt;&lt;define_projects&gt;&gt;</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">"results/recount3_data.RData"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#- - - - - - - - - - - - - - -</span></span>
<span><span class="co">#- - - extract features  - - - </span></span>
<span><span class="co">#- - - - - - - - - - - - - - -</span></span>
<span></span>
<span><span class="co"># extract features</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">project</span><span class="op">)</span>,<span class="va">extra</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu">SummarizedExperiment</span><span class="fu">::</span><span class="fu">assays</span><span class="op">(</span><span class="va">data</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">$</span><span class="va">raw_counts</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">counts</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">SummarizedExperiment</span><span class="fu">::</span><span class="fu">rowRanges</span><span class="op">(</span><span class="va">data</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">$</span><span class="va">gene_name</span></span>
<span>  <span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">counts</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># select most expressed protein-coding genes (for all TL projects together)</span></span>
<span><span class="va">select</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">total</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">project</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co">#total &lt;- rbind(total,Matrix::colSums(x[[i]])) # original: mean filtering</span></span>
<span>  <span class="va">total</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">total</span>,<span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,MARGIN<span class="op">=</span><span class="fl">2</span>,FUN<span class="op">=</span><span class="fu">stats</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">)</span><span class="op">)</span> <span class="co"># trial: variance filtering</span></span>
<span><span class="op">}</span></span>
<span><span class="va">type</span> <span class="op">&lt;-</span> <span class="fu">SummarizedExperiment</span><span class="fu">::</span><span class="fu">rowData</span><span class="op">(</span><span class="va">data</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">$</span><span class="va">gene_type</span></span>
<span><span class="va">cond</span> <span class="op">&lt;-</span> <span class="va">type</span><span class="op">==</span><span class="st">"protein_coding"</span></span>
<span><span class="va">total</span><span class="op">[</span>,<span class="op">!</span><span class="va">cond</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">rank</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">total</span>,MARGIN<span class="op">=</span><span class="fl">1</span>,FUN<span class="op">=</span><span class="va">rank</span><span class="op">)</span></span>
<span><span class="va">mean_rank</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">rank</span><span class="op">)</span></span>
<span><span class="co">#temp &lt;- cond &amp; apply(total,2,function(x) all(x&gt;0)) &amp; (mean_rank &gt;= sort(mean_rank[cond],decreasing=TRUE)[2000]) # original: top 2000</span></span>
<span><span class="va">temp</span> <span class="op">&lt;-</span> <span class="va">cond</span> <span class="op">&amp;</span> <span class="va">mean_rank</span> <span class="op">&gt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">mean_rank</span><span class="op">[</span><span class="va">cond</span><span class="op">]</span>,decreasing<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">[</span><span class="fl">5000</span><span class="op">]</span> <span class="co"># trial: top 5000</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">project</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">select</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">temp</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># select most expressed protein-coding genes (for MTL project)</span></span>
<span><span class="co">#mean &lt;- apply(X=x[[extra]],MARGIN=2,FUN=mean) # original</span></span>
<span><span class="va">var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">x</span><span class="op">[[</span><span class="va">extra</span><span class="op">]</span><span class="op">]</span>,MARGIN<span class="op">=</span><span class="fl">2</span>,FUN<span class="op">=</span><span class="va">var</span><span class="op">)</span> <span class="co"># trial</span></span>
<span><span class="co">#warning("change number in next line")</span></span>
<span><span class="co">#temp &lt;- cond &amp; mean &gt;= sort(mean[cond],decreasing=TRUE)[5000] # trial: top 5000</span></span>
<span><span class="va">temp</span> <span class="op">&lt;-</span> <span class="va">cond</span> <span class="op">&amp;</span> <span class="va">var</span> <span class="op">&gt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">var</span><span class="op">[</span><span class="va">cond</span><span class="op">]</span>,decreasing<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">[</span><span class="fl">5000</span><span class="op">]</span> <span class="co"># trial: top 5000</span></span>
<span><span class="va">select</span><span class="op">[[</span><span class="va">extra</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">temp</span></span>
<span></span>
<span><span class="co"># pre-processing</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">project</span><span class="op">)</span>,<span class="va">extra</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">lib.size</span> <span class="op">&lt;-</span> <span class="fu">Matrix</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums-methods.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="va">select</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,drop<span class="op">=</span><span class="cn">FALSE</span><span class="op">]</span></span>
<span>  <span class="va">norm.factors</span> <span class="op">&lt;-</span> <span class="fu">edgeR</span><span class="fu">::</span><span class="fu">calcNormFactors</span><span class="op">(</span>object<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,lib.size<span class="op">=</span><span class="va">lib.size</span><span class="op">)</span></span>
<span>  <span class="va">gamma</span> <span class="op">&lt;-</span> <span class="va">norm.factors</span><span class="op">*</span><span class="va">lib.size</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">lib.size</span><span class="op">)</span></span>
<span>  <span class="va">gamma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">gamma</span>,nrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,ncol<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">/</span><span class="va">gamma</span></span>
<span>  <span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="fl">3</span><span class="op">/</span><span class="fl">8</span><span class="op">)</span> <span class="co"># Anscombe transform</span></span>
<span>  <span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="co"># scale because of different datasets!?</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#- - - - - - - - - - - - - -</span></span>
<span><span class="co">#- - - extract targets - - -</span></span>
<span><span class="co">#- - - - - - - - - - - - - -</span></span>
<span></span>
<span><span class="co"># extract information on samples</span></span>
<span><span class="va">frame</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">project</span><span class="op">)</span>,<span class="va">extra</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="va">data</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sra.sample_attributes</span>,split<span class="op">=</span><span class="st">"\\|"</span><span class="op">)</span></span>
<span>  <span class="va">data</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sra.experiment_attributes</span></span>
<span>  <span class="co"># What about sra.experiment_attributes?</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">list</span><span class="op">)</span></span>
<span>  <span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">list</span><span class="op">)</span>,split<span class="op">=</span><span class="st">";;"</span><span class="op">)</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">ncol</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">cols</span><span class="op">)</span></span>
<span>  <span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data<span class="op">=</span><span class="cn">NA</span>,nrow<span class="op">=</span><span class="va">n</span>,ncol<span class="op">=</span><span class="va">ncol</span>,dimnames<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,<span class="va">cols</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw">for</span><span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">ncol</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="va">vector</span> <span class="op">&lt;-</span> <span class="va">list</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span></span>
<span>      <span class="va">which</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substring</a></span><span class="op">(</span>text<span class="op">=</span><span class="va">vector</span>,first<span class="op">=</span><span class="fl">1</span>,last<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="va">cols</span><span class="op">[</span><span class="va">k</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">==</span><span class="va">cols</span><span class="op">[</span><span class="va">k</span><span class="op">]</span><span class="op">)</span></span>
<span>      <span class="va">string</span> <span class="op">&lt;-</span> <span class="va">vector</span><span class="op">[</span><span class="va">which</span><span class="op">]</span></span>
<span>      <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">string</span><span class="op">)</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span><span class="kw">next</span><span class="op">}</span></span>
<span>      <span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">j</span>,<span class="va">k</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="va">string</span>,split<span class="op">=</span><span class="st">";;"</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># extract binary outcome</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">project</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co"># CONTINUE HERE!!!</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">i</span><span class="op">==</span><span class="st">"ERP113396"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">y</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">`clinical history`</span>,FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span>EXPR<span class="op">=</span><span class="va">x</span>,<span class="st">"responder"</span><span class="op">=</span><span class="fl">1</span>,<span class="st">"non-responder"</span><span class="op">=</span><span class="fl">0</span>,<span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"invalid"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">i</span><span class="op">==</span><span class="st">"ERP114636"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">y</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">`clinical information`</span>,FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span>EXPR<span class="op">=</span><span class="va">x</span>,<span class="st">"response to vedolizumab therapy"</span><span class="op">=</span><span class="fl">1</span><span class="op">-</span><span class="fl">1</span>,<span class="st">"no response to vedolizumab therapy"</span><span class="op">=</span><span class="fl">0</span><span class="op">+</span><span class="fl">1</span>,<span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"invalid"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/warning.html" class="external-link">warning</a></span><span class="op">(</span><span class="st">"Inverting response and non-response!"</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">i</span><span class="op">==</span><span class="st">"SRP100787"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">y</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">condition</span>,FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span>EXPR<span class="op">=</span><span class="va">x</span>,<span class="st">"CD inactive"</span><span class="op">=</span><span class="fl">1</span>,<span class="st">"UC inactive"</span><span class="op">=</span><span class="fl">1</span>,<span class="st">"CD active"</span><span class="op">=</span><span class="fl">0</span>,<span class="st">"UC active"</span><span class="op">=</span><span class="fl">0</span>,control<span class="op">=</span><span class="cn">NA</span>,<span class="st">"NA"</span><span class="op">=</span><span class="cn">NA</span>,<span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"invalid"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">i</span><span class="op">==</span><span class="st">"SRP129004"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">y</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">`week 4 remission`</span>,FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span>EXP<span class="op">=</span><span class="va">x</span>,<span class="st">"Yes"</span><span class="op">=</span><span class="fl">1</span>,<span class="st">"No"</span><span class="op">=</span><span class="fl">0</span>,<span class="st">"NA"</span><span class="op">=</span><span class="cn">NA</span>,<span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"invalid"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="va">z</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>pucai<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">pucai</span><span class="op">)</span>,mayo<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">`total mayo score`</span><span class="op">)</span>,histology<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">`histology severity score`</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">i</span><span class="op">==</span><span class="st">"SRP063496"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">y</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">`remission at week 10`</span>,FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"Remitter"</span><span class="op">=</span><span class="fl">1</span>,<span class="st">"Non-remitter"</span><span class="op">=</span><span class="fl">0</span>,<span class="st">"N/A"</span><span class="op">=</span><span class="cn">NA</span>,<span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"invalid"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">i</span><span class="op">==</span><span class="st">"SRP169062"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">y</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">`flare event`</span>,FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span><span class="va">x</span>,<span class="st">"no flare"</span><span class="op">=</span><span class="fl">1</span>,<span class="st">"flare"</span><span class="op">=</span><span class="fl">0</span>,<span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"invalid"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">i</span><span class="op">==</span><span class="st">"SRP155483"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">y</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">`disease activity`</span>,FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span><span class="va">x</span>,<span class="st">"remission"</span><span class="op">=</span><span class="fl">1</span>,<span class="st">"Low"</span><span class="op">=</span><span class="fl">0</span>,<span class="st">"Moderate"</span><span class="op">=</span><span class="fl">0</span>,<span class="st">"High"</span><span class="op">=</span><span class="fl">0</span>,<span class="st">"--"</span><span class="op">=</span><span class="cn">NA</span>,<span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"invalid"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">z</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">`disease activity`</span>,FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span><span class="va">x</span>,<span class="st">"remission"</span><span class="op">=</span><span class="fl">0</span>,<span class="st">"Low"</span><span class="op">=</span><span class="fl">1</span>,<span class="st">"Moderate"</span><span class="op">=</span><span class="fl">2</span>,<span class="st">"High"</span><span class="op">=</span><span class="fl">3</span>,<span class="st">"--"</span><span class="op">=</span><span class="cn">NA</span>,<span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"invalid"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">i</span><span class="op">==</span><span class="st">"SRP074736"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">y</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">`mtx response status`</span>,FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span><span class="va">x</span>,<span class="st">"responder"</span><span class="op">=</span><span class="fl">1</span>,<span class="st">"non-responder"</span><span class="op">=</span><span class="fl">0</span>,<span class="st">"control"</span><span class="op">=</span><span class="cn">NA</span>,<span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"invalid"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># overlap</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">project</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">is.na</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">y</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">is.na</span><span class="op">)</span><span class="op">!=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">{</span><span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="op">)</span><span class="op">}</span></span>
<span>  <span class="va">y</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">y</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">!</span><span class="va">is.na</span><span class="op">]</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">z</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">is.vector</a></span><span class="op">(</span><span class="va">z</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="va">z</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">z</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">!</span><span class="va">is.na</span><span class="op">]</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="va">z</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">z</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">!</span><span class="va">is.na</span>,<span class="op">]</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">x</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">!</span><span class="va">is.na</span>,<span class="op">]</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="data-exploration">Data exploration<a class="anchor" aria-label="anchor" href="#data-exploration"></a>
</h3>
<p>This chunk performs the exploratory data analysis.</p>
<ul>
<li><p>Requires: execution of chunks <code>setup</code>,
<code>define_projects</code> and <code>preprocess_data</code></p></li>
<li><p>Execution time: <span class="math inline">\(0.5\)</span>
minutes</p></li>
<li><p>Ensures: files <code>explore_data.RData</code> (results) and
<code>info_explore.txt</code> (session information) in folder
<code>results</code></p></li>
</ul>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#&lt;&lt;setup&gt;&gt;</span></span>
<span><span class="co">#&lt;&lt;define_projects&gt;&gt;</span></span>
<span><span class="co">#&lt;&lt;preprocess_data&gt;&gt;</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">alpha.holdout</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">alpha.crossval</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">family</span> <span class="op">&lt;-</span> <span class="st">"binomial"</span></span>
<span><span class="va">nfolds</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="va">codes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">project</span><span class="op">)</span></span>
<span><span class="va">coef</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data<span class="op">=</span><span class="cn">NA</span>,nrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,ncol<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">codes</span><span class="op">)</span>,dimnames<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="cn">NULL</span>,<span class="va">codes</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">auc</span> <span class="op">&lt;-</span> <span class="va">auc.pvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data<span class="op">=</span><span class="cn">NA</span>,nrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">codes</span><span class="op">)</span>,ncol<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">codes</span><span class="op">)</span>,dimnames<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">codes</span>,<span class="va">codes</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">foldid</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make.folds.multi.html">make.folds.trans</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">y</span>,family<span class="op">=</span><span class="st">"binomial"</span>,nfolds<span class="op">=</span><span class="va">nfolds</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ridge</span> <span class="op">&lt;-</span> <span class="va">lasso</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">codes</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">ridge</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">glmnet</span><span class="fu">::</span><span class="fu"><a href="https://glmnet.stanford.edu/reference/cv.glmnet.html" class="external-link">cv.glmnet</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span><span class="op">[[</span><span class="va">codes</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">]</span>,y<span class="op">=</span><span class="va">y</span><span class="op">[[</span><span class="va">codes</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">]</span>,family<span class="op">=</span><span class="va">family</span>,alpha<span class="op">=</span><span class="va">alpha.holdout</span>,foldid<span class="op">=</span><span class="va">foldid</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">coef</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">ridge</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,s<span class="op">=</span><span class="st">"lambda.min"</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">codes</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">i</span><span class="op">==</span><span class="va">j</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="va">y_hat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span>x<span class="op">=</span><span class="cn">NA</span>,times<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">y</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="kw">for</span><span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">nfolds</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="va">holdout</span> <span class="op">&lt;-</span> <span class="va">foldid</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">==</span><span class="va">k</span></span>
<span>        <span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu">glmnet</span><span class="fu">::</span><span class="fu"><a href="https://glmnet.stanford.edu/reference/cv.glmnet.html" class="external-link">cv.glmnet</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span><span class="op">[[</span><span class="va">codes</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">!</span><span class="va">holdout</span>,<span class="op">]</span>,y<span class="op">=</span><span class="va">y</span><span class="op">[[</span><span class="va">codes</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">!</span><span class="va">holdout</span><span class="op">]</span>,family<span class="op">=</span><span class="va">family</span>,alpha<span class="op">=</span><span class="va">alpha.crossval</span><span class="op">)</span></span>
<span>        <span class="va">y_hat</span><span class="op">[</span><span class="va">holdout</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span>object<span class="op">=</span><span class="va">temp</span>,newx<span class="op">=</span><span class="va">x</span><span class="op">[[</span><span class="va">codes</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">holdout</span>,<span class="op">]</span>,s<span class="op">=</span><span class="st">"lambda.min"</span>,type<span class="op">=</span><span class="st">"response"</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="va">y_hat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span>object<span class="op">=</span><span class="va">ridge</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,newx<span class="op">=</span><span class="va">x</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span>,s<span class="op">=</span><span class="st">"lambda.min"</span>,type<span class="op">=</span><span class="st">"response"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">auc</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">pROC</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pROC/man/auc.html" class="external-link">auc</a></span><span class="op">(</span>response<span class="op">=</span><span class="va">y</span><span class="op">[[</span><span class="va">codes</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">]</span>,predictor<span class="op">=</span><span class="va">y_hat</span>,direction<span class="op">=</span><span class="st">"&lt;"</span>,levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">auc.pvalue</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/wilcox.test.html" class="external-link">wilcox.test</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rank.html" class="external-link">rank</a></span><span class="op">(</span><span class="va">y_hat</span><span class="op">)</span><span class="op">~</span><span class="va">y</span><span class="op">[[</span><span class="va">codes</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">]</span><span class="op">]</span>,alternative<span class="op">=</span><span class="st">"less"</span>,exact<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">p.value</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">coef</span>,<span class="va">auc</span>,<span class="va">auc.pvalue</span>,<span class="va">codes</span>,file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">"results"</span>,<span class="st">"explore_data.RData"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span>text<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/utils/capture.output.html" class="external-link">capture.output</a></span><span class="op">(</span><span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span>,</span>
<span>      <span class="fu">sessioninfo</span><span class="fu">::</span><span class="fu"><a href="https://sessioninfo.r-lib.org/reference/session_info.html" class="external-link">session_info</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,con<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">"/results/info_explore.txt"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>This chunk generates the tables for the exploratory data
analysis.</p>
<ul>
<li><p>Requires: execution of chunk <code>setup</code>, file
<code>explore_data.RData</code> in folder <code>results</code>
(generated by chunk <code>explore_apply</code>)</p></li>
<li><p>execution time: <span class="math inline">\(1\)</span>
second</p></li>
<li><p>Ensures: files <code>tab_cor.tex</code> and
<code>tab_auc.tex</code> in folder <code>manuscript</code></p></li>
</ul>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#&lt;&lt;setup&gt;&gt;</span></span>
<span><span class="co">#if(any(unlist(project)!=names(refs))){stop("not compatible")}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">"results/explore_data.RData"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span>pattern<span class="op">=</span><span class="st">"IBD.|RA."</span>,replacement<span class="op">=</span><span class="st">""</span>,x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">project</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">codes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">coef</span><span class="op">)</span></span>
<span><span class="va">cor.pvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data<span class="op">=</span><span class="cn">NA</span>,nrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">codes</span><span class="op">)</span>,ncol<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">codes</span><span class="op">)</span>,dimnames<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">codes</span>,<span class="va">codes</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">codes</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">codes</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">cor.pvalue</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.test.html" class="external-link">cor.test</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">coef</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>,y<span class="op">=</span><span class="va">coef</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span>,method<span class="op">=</span><span class="st">"spearman"</span>,exact<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">p.value</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">cor.pvalue</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span></span>
<span><span class="va">insert.space</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">table</span>,<span class="va">cut</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">index.left</span> <span class="op">&lt;-</span> <span class="va">index.top</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">cut</span><span class="op">)</span></span>
<span>  <span class="va">index.right</span> <span class="op">&lt;-</span> <span class="va">index.bottom</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="va">cut</span><span class="op">+</span><span class="fl">1</span>,to<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">table</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">top</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">table</span><span class="op">[</span><span class="va">index.top</span>,<span class="va">index.left</span><span class="op">]</span>,<span class="st">""</span>,<span class="va">table</span><span class="op">[</span><span class="va">index.top</span>,<span class="va">index.right</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">bottom</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">table</span><span class="op">[</span><span class="va">index.bottom</span>,<span class="va">index.left</span><span class="op">]</span>,<span class="st">""</span>,<span class="va">table</span><span class="op">[</span><span class="va">index.bottom</span>,<span class="va">index.right</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">top</span>,<span class="st">""</span>,<span class="va">bottom</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span><span class="op">==</span><span class="st">""</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">" "</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">table</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">coef</span>,method<span class="op">=</span><span class="st">"spearman"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">table</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">table</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">names</span></span>
<span><span class="va">black</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">cor.pvalue</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">cor.pvalue</span><span class="op">&lt;=</span><span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="va">star</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">cor.pvalue</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">cor.pvalue</span><span class="op">&lt;=</span><span class="fl">0.05</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/Special.html" class="external-link">choose</a></span><span class="op">(</span>n<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">codes</span><span class="op">)</span>,k<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">nonnegative</span> <span class="op">&lt;-</span> <span class="va">table</span><span class="op">&gt;=</span><span class="fl">0</span></span>
<span><span class="va">table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">table</span>,digits<span class="op">=</span><span class="fl">2</span><span class="op">)</span>,digits<span class="op">=</span><span class="fl">2</span>,trim<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">table</span><span class="op">[</span><span class="va">nonnegative</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"\\phantom{-}"</span>,<span class="va">table</span><span class="op">[</span><span class="va">nonnegative</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">table</span><span class="op">[</span><span class="op">!</span><span class="va">black</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"\\textcolor{gray}{"</span>,<span class="va">table</span><span class="op">[</span><span class="op">!</span><span class="va">black</span><span class="op">]</span>,<span class="st">"}"</span><span class="op">)</span></span>
<span><span class="va">table</span><span class="op">[</span><span class="va">star</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">table</span><span class="op">[</span><span class="va">star</span><span class="op">]</span>,<span class="st">"$^\\star$"</span><span class="op">)</span></span>
<span><span class="va">table</span><span class="op">[</span><span class="op">!</span><span class="va">star</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">table</span><span class="op">[</span><span class="op">!</span><span class="va">star</span><span class="op">]</span>,<span class="st">"\\phantom{$^\\star$}"</span><span class="op">)</span></span>
<span><span class="co">#table[nonnegative] &lt;- paste0("-",table[nonnegative])</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">table</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"-"</span></span>
<span><span class="va">table</span> <span class="op">&lt;-</span> <span class="fu">insert.space</span><span class="op">(</span>table<span class="op">=</span><span class="va">table</span>,cut<span class="op">=</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">xtable</span> <span class="op">&lt;-</span> <span class="fu">xtable</span><span class="fu">::</span><span class="fu">xtable</span><span class="op">(</span>x<span class="op">=</span><span class="va">table</span>,align<span class="op">=</span><span class="st">"rccccccccc"</span>,caption<span class="op">=</span><span class="st">"Spearman correlation coefficients between the ridge regression coefficients from different datasets. Pairwise combinations of datasets with significantly correlated regression coefficients are highlighted, with black colour for nominal significance ($p$-value $\\leq 0.05$) and stars for adjusted significance ($p$-value $\\leq 0.05/28$). We expect a correlation coefficient close to $0$ for unrelated problems and close to $1$ for identical problems."</span>,label<span class="op">=</span><span class="st">"tab_cor"</span><span class="op">)</span></span>
<span><span class="fu">xtable</span><span class="fu">::</span><span class="fu">print.xtable</span><span class="op">(</span>x<span class="op">=</span><span class="va">xtable</span>,sanitize.text.function<span class="op">=</span><span class="va">identity</span>,rotate.colnames<span class="op">=</span><span class="cn">TRUE</span>,caption.placement<span class="op">=</span><span class="st">"top"</span>,hline.after<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">table</span><span class="op">)</span><span class="op">)</span>,comment<span class="op">=</span><span class="cn">FALSE</span>,file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">"manuscript"</span>,<span class="st">"tab_cor.tex"</span><span class="op">)</span><span class="op">)</span> <span class="co">#add.to.row=list(pos=list(5),command="\\hdashline \n")</span></span>
<span></span>
<span><span class="va">table</span> <span class="op">&lt;-</span> <span class="va">auc</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">table</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">table</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">names</span></span>
<span><span class="va">table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">table</span>,digits<span class="op">=</span><span class="fl">2</span><span class="op">)</span>,digits<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">black</span> <span class="op">&lt;-</span> <span class="va">auc.pvalue</span><span class="op">&lt;=</span><span class="fl">0.05</span></span>
<span><span class="va">star</span> <span class="op">&lt;-</span> <span class="va">auc.pvalue</span><span class="op">&lt;=</span><span class="fl">0.05</span><span class="op">/</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">codes</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">codes</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">table</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"("</span>,<span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">table</span><span class="op">)</span>,<span class="st">")"</span><span class="op">)</span></span>
<span><span class="va">table</span><span class="op">[</span><span class="op">!</span><span class="va">black</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"\\textcolor{gray}{"</span>,<span class="va">table</span><span class="op">[</span><span class="op">!</span><span class="va">black</span><span class="op">]</span>,<span class="st">"}"</span><span class="op">)</span></span>
<span><span class="va">table</span><span class="op">[</span><span class="va">star</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">table</span><span class="op">[</span><span class="va">star</span><span class="op">]</span>,<span class="st">"$^\\star$"</span><span class="op">)</span></span>
<span><span class="va">table</span><span class="op">[</span><span class="op">!</span><span class="va">star</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">table</span><span class="op">[</span><span class="op">!</span><span class="va">star</span><span class="op">]</span>,<span class="st">"\\phantom{$^\\star$}"</span><span class="op">)</span></span>
<span><span class="va">table</span> <span class="op">&lt;-</span> <span class="fu">insert.space</span><span class="op">(</span>table<span class="op">=</span><span class="va">table</span>,cut<span class="op">=</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">xtable</span> <span class="op">&lt;-</span> <span class="fu">xtable</span><span class="fu">::</span><span class="fu">xtable</span><span class="op">(</span>x<span class="op">=</span><span class="va">table</span>,align<span class="op">=</span><span class="st">"rccccccccc"</span>,caption<span class="op">=</span><span class="st">"Out-of-sample area under the receiver operating characteristic curve (\\textsc{roc-auc}) from logistic ridge regression trained on the dataset in the row and tested on the dataset in the column (off-diagonal entries), or cross-validated \\textsc{roc-auc} from logistic lasso regression trained and tested on the same dataset by $10$-fold external cross-validation (diagonal entries, between brackets). The \\textsc{roc-auc} of a random classifier is $0.5$, while that of a perfect classifier is $1.0$. Entries on and off the diagonal are not comparable. Predictions that are significantly better than random predictions (according to the one-sided Mann-Whitney $U$ test for testing whether the ranks of the predicted probabilities are significantly higher for the cases than for the controls) are highlighted, with black colour for nominal significance ($p$-value $\\leq 0.05$) and stars for adjusted significance ($p$-value $\\leq 0.05/64$)."</span>,label<span class="op">=</span><span class="st">"tab_auc"</span><span class="op">)</span></span>
<span><span class="fu">xtable</span><span class="fu">::</span><span class="fu">print.xtable</span><span class="op">(</span>x<span class="op">=</span><span class="va">xtable</span>,sanitize.text.function<span class="op">=</span><span class="va">identity</span>,rotate.colnames<span class="op">=</span><span class="cn">TRUE</span>,caption.placement<span class="op">=</span><span class="st">"top"</span>,hline.after<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">table</span><span class="op">)</span><span class="op">)</span>,comment<span class="op">=</span><span class="cn">FALSE</span>,file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">"manuscript"</span>,<span class="st">"tab_auc.tex"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="transfer-learning">Transfer learning<a class="anchor" aria-label="anchor" href="#transfer-learning"></a>
</h3>
<p>This chunk performs the transfer learning analysis.</p>
<ul>
<li><p>Requires: execution of chunks <code>setup</code> and
<code>define_projects</code>, file <code>recount3_data.RData</code> in
folder <code>results</code> (generated by chunk
<code>download_data</code>), execution of chunk
<code>preprocess_data</code></p></li>
<li><p>Execution time: <strong>1.5 hours</strong></p></li>
<li><p>Ensures: <code>application.RData</code> (results) and
<code>info_app.txt</code> (session information) in folder
<code>results</code></p></li>
</ul>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#&lt;&lt;setup&gt;&gt;</span></span>
<span><span class="co">#&lt;&lt;define_projects&gt;&gt;</span></span>
<span><span class="co">#&lt;&lt;preprocess_data&gt;&gt;</span></span>
<span></span>
<span><span class="va">alpha.init</span> <span class="op">&lt;-</span> <span class="fl">0.95</span>; <span class="va">type</span> <span class="op">&lt;-</span> <span class="st">"exp"</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">project</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"project:"</span>,<span class="va">i</span>,<span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="va">result</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">{</span> <span class="co"># 5 repetitions of 10-fold CV</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="va">j</span><span class="op">)</span></span>
<span>    <span class="va">codes</span> <span class="op">&lt;-</span> <span class="va">project</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>    <span class="va">result</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cv.multiple.html">cv.transfer</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">y</span><span class="op">[</span><span class="va">codes</span><span class="op">]</span>,X<span class="op">=</span><span class="va">x</span><span class="op">[</span><span class="va">codes</span><span class="op">]</span>,family<span class="op">=</span><span class="st">"binomial"</span>,method<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"glm.separate"</span>,<span class="st">"glm.glmtrans"</span>,<span class="st">"sparselink"</span>,<span class="st">"glm.xrnet"</span><span class="op">)</span>,nfolds<span class="op">=</span><span class="fl">10</span>,alpha<span class="op">=</span><span class="fl">1</span>,alpha.init<span class="op">=</span><span class="va">alpha.init</span>,type<span class="op">=</span><span class="va">type</span>,trial<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">result</span>,<span class="va">project</span>,file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">"results"</span>,<span class="st">"application.RData"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span>text<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/utils/capture.output.html" class="external-link">capture.output</a></span><span class="op">(</span><span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span>,</span>
<span>      <span class="fu">sessioninfo</span><span class="fu">::</span><span class="fu"><a href="https://sessioninfo.r-lib.org/reference/session_info.html" class="external-link">session_info</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,con<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">"/results/info_app.txt"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>This chunk generates the figure on the predictive performance.</p>
<ul>
<li><p>Requires: execution of chunk <code>setup</code>, file
<code>application.RData</code> in folder <code>results</code> (generated
by chunk <code>transfer_apply</code>)</p></li>
<li><p>Execution time: <span class="math inline">\(1\)</span>
second</p></li>
<li><p>Ensures: file <code>fig_app.eps</code> in folder
<code>manuscript</code></p></li>
</ul>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#&lt;&lt;setup&gt;&gt;</span></span>
<span></span>
<span><span class="fu">grDevices</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grDevices/postscript.html" class="external-link">postscript</a></span><span class="op">(</span>file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">"manuscript"</span>,<span class="st">"fig_app.eps"</span><span class="op">)</span>,width<span class="op">=</span><span class="fl">6.5</span>,height<span class="op">=</span><span class="fl">4</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>,mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,oma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"results/application.RData"</span><span class="op">)</span><span class="op">)</span>,verbose<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#reference &lt;- "glm.glmtrans"</span></span>
<span><span class="co">#experimental &lt;- "sparselink"</span></span>
<span></span>
<span><span class="va">model0</span> <span class="op">&lt;-</span> <span class="st">"glm.glmtrans"</span></span>
<span><span class="va">model1</span> <span class="op">&lt;-</span> <span class="st">"sparselink"</span></span>
<span><span class="va">model2</span> <span class="op">&lt;-</span> <span class="st">"glm.xrnet"</span></span>
<span></span>
<span><span class="co"># predictivity</span></span>
<span><span class="va">metric</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">result</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span>what<span class="op">=</span><span class="st">"rbind"</span>,args<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">x</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">auc</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co"># DEV and AUC need different directions (increase=FALSE/TRUE)!</span></span>
<span><span class="va">metric</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span>what<span class="op">=</span><span class="st">"rbind"</span>,args<span class="op">=</span><span class="va">metric</span><span class="op">)</span></span>
<span><span class="va">metric</span> <span class="op">&lt;-</span> <span class="va">metric</span><span class="op">/</span><span class="va">metric</span><span class="op">[</span>,<span class="st">"glm.separate"</span><span class="op">]</span></span>
<span><span class="co">#xlab &lt;- refs[rownames(metric)]</span></span>
<span><span class="co">#names &lt;- gsub(pattern="",replacement="\n",x=unlist(project))</span></span>
<span></span>
<span><span class="va">label</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span>pattern<span class="op">=</span><span class="st">"IBD.|RA."</span>,replacement<span class="op">=</span><span class="st">""</span>,x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span>pattern<span class="op">=</span><span class="st">" "</span>,replacement<span class="op">=</span><span class="st">"\n"</span>,x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">project</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">metric</span><span class="op">)</span>,table<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">project</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">xlab</span> <span class="op">&lt;-</span> <span class="va">label</span><span class="op">[</span><span class="va">index</span><span class="op">]</span></span>
<span><span class="fu"><a href="../reference/change.html">change</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">xlab</span>,y0<span class="op">=</span><span class="va">metric</span><span class="op">[</span>,<span class="va">model0</span><span class="op">]</span>,y1<span class="op">=</span><span class="va">metric</span><span class="op">[</span>,<span class="va">model1</span><span class="op">]</span>,y2<span class="op">=</span><span class="va">metric</span><span class="op">[</span>,<span class="va">model2</span><span class="op">]</span>,main<span class="op">=</span><span class="st">"metric"</span>,increase<span class="op">=</span><span class="cn">TRUE</span>,cex.main<span class="op">=</span><span class="fl">0.8</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span>side<span class="op">=</span><span class="fl">1</span>,at<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">project</span><span class="op">$</span><span class="va">IBD</span><span class="op">)</span><span class="op">+</span><span class="fl">0.5</span>,labels<span class="op">=</span><span class="st">"|"</span>,tick<span class="op">=</span><span class="cn">FALSE</span>,line<span class="op">=</span><span class="op">-</span><span class="fl">0.25</span>,font<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="fl">0.5</span>,lty<span class="op">=</span><span class="fl">2</span>,col<span class="op">=</span><span class="st">"grey"</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="fl">1</span>,lty<span class="op">=</span><span class="fl">2</span>,col<span class="op">=</span><span class="st">"grey"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># sparsity</span></span>
<span><span class="va">nzero</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">result</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">x</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">refit</span><span class="op">$</span><span class="va">coef</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">x</span><span class="op">!=</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">nzero</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span>what<span class="op">=</span><span class="st">"rbind"</span>,args<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span>what<span class="op">=</span><span class="st">"c"</span>,args<span class="op">=</span><span class="va">nzero</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/change.html">change</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">xlab</span>,y0<span class="op">=</span><span class="va">nzero</span><span class="op">[</span>,<span class="va">model0</span><span class="op">]</span>,y1<span class="op">=</span><span class="va">nzero</span><span class="op">[</span>,<span class="va">model1</span><span class="op">]</span>,y2<span class="op">=</span><span class="va">nzero</span><span class="op">[</span>,<span class="va">model2</span><span class="op">]</span>,main<span class="op">=</span><span class="st">"sparsity"</span>,increase<span class="op">=</span><span class="cn">FALSE</span>,cex.main<span class="op">=</span><span class="fl">0.8</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span>side<span class="op">=</span><span class="fl">1</span>,at<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">project</span><span class="op">$</span><span class="va">IBD</span><span class="op">)</span><span class="op">+</span><span class="fl">0.5</span>,labels<span class="op">=</span><span class="st">"|"</span>,tick<span class="op">=</span><span class="cn">FALSE</span>,line<span class="op">=</span><span class="op">-</span><span class="fl">0.25</span>,font<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="fl">0</span>,lty<span class="op">=</span><span class="fl">2</span>,col<span class="op">=</span><span class="st">"grey"</span><span class="op">)</span></span>
<span><span class="fu">grDevices</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># percentage change</span></span>
<span><span class="co"># (reported in section 4 "application" subsection 4.3 "transfer learning")</span></span>
<span></span>
<span><span class="va">disease</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">metric</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">project</span><span class="op">$</span><span class="va">IBD</span>,<span class="st">"IBD"</span>,<span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">metric</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">project</span><span class="op">$</span><span class="va">RA</span>,<span class="st">"RA"</span>,<span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#round(100*colMeans(metric)-100,digits=2)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">100</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">metric</span><span class="op">[</span><span class="va">disease</span><span class="op">==</span><span class="st">"IBD"</span>,<span class="op">]</span><span class="op">)</span><span class="op">-</span><span class="fl">100</span>,digits<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">100</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">metric</span><span class="op">[</span><span class="va">disease</span><span class="op">==</span><span class="st">"RA"</span>,<span class="op">]</span><span class="op">)</span><span class="op">-</span><span class="fl">100</span>,digits<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">nzero</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">nzero</span><span class="op">[</span><span class="va">disease</span><span class="op">==</span><span class="st">"IBD"</span>,<span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">nzero</span><span class="op">[</span><span class="va">disease</span><span class="op">==</span><span class="st">"RA"</span>,<span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#--- revision: report AUC ---</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/funprog.html" class="external-link">Reduce</a></span><span class="op">(</span>f<span class="op">=</span><span class="st">"+"</span>,x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">IBD</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">auc</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">IBD</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">result</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/funprog.html" class="external-link">Reduce</a></span><span class="op">(</span>f<span class="op">=</span><span class="st">"+"</span>,x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">x</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">auc</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">IBD</span><span class="op">)</span><span class="op">)</span>,digits<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>This chunk generates the figure on feature selection.</p>
<ul>
<li><p>Requires: execution of chunk <code>setup</code>, file
<code>application.RData</code> in folder <code>results</code> (generated
by chunk <code>transfer_apply</code>)</p></li>
<li><p>Execution time: <span class="math inline">\(1\)</span>
second</p></li>
<li><p>Ensures: file <code>fig_coef.eps</code> in folder
<code>manuscript</code></p></li>
</ul>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#&lt;&lt;setup&gt;&gt;</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">"results"</span>,<span class="st">"application.RData"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">coefs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">IBD</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">coefs</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">IBD</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">refit</span><span class="op">$</span><span class="va">coef</span><span class="op">$</span><span class="va">sparselink</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">coefs</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">project</span><span class="op">$</span><span class="va">IBD</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">coefs</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">IBD</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">refit</span><span class="op">$</span><span class="va">coef</span><span class="op">$</span><span class="va">glm.glmtrans</span><span class="op">)</span> <span class="co"># try to avoid this</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">any</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">coefs</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">x</span>,<span class="fl">1</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">x</span><span class="op">!=</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">!=</span><span class="fl">0</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">IBD</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">coefs</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">coefs</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">any</span>,<span class="op">]</span></span>
<span><span class="op">}</span></span>
<span><span class="va">table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html" class="external-link">Reduce</a></span><span class="op">(</span>f<span class="op">=</span><span class="st">"+"</span>,x<span class="op">=</span><span class="va">coefs</span><span class="op">)</span><span class="op">/</span><span class="fl">5</span></span>
<span></span>
<span><span class="va">cex</span> <span class="op">&lt;-</span> <span class="fl">0.7</span></span>
<span></span>
<span><span class="fu">grDevices</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grDevices/postscript.html" class="external-link">postscript</a></span><span class="op">(</span>file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">"manuscript"</span>,<span class="st">"fig_coef.eps"</span><span class="op">)</span>,width<span class="op">=</span><span class="fl">7</span>,height<span class="op">=</span><span class="fl">4</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.5</span>,<span class="fl">4.5</span>,<span class="fl">0.5</span>,<span class="fl">1.5</span><span class="op">)</span>,oma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/frame.html" class="external-link">plot.new</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.window.html" class="external-link">plot.window</a></span><span class="op">(</span>xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.6</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">table</span><span class="op">)</span><span class="op">+</span><span class="fl">0.4</span><span class="op">)</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">table</span><span class="op">)</span><span class="op">+</span><span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">table</span>,<span class="fl">1</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">x</span><span class="op">&lt;=</span><span class="fl">0</span><span class="op">)</span>,<span class="st">"blue"</span>,<span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">x</span><span class="op">&gt;=</span><span class="fl">0</span><span class="op">)</span>,<span class="st">"red"</span>,<span class="st">"black"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">colnames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">table</span><span class="op">)</span>,pattern<span class="op">=</span><span class="st">" "</span>,replacement<span class="op">=</span><span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span>text<span class="op">=</span><span class="va">colnames</span>,side<span class="op">=</span><span class="fl">1</span>,at<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">table</span><span class="op">)</span><span class="op">)</span>,cex<span class="op">=</span><span class="va">cex</span>,line<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">rownames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">table</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span>text<span class="op">=</span><span class="va">rownames</span>,side<span class="op">=</span><span class="fl">2</span>,at<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">table</span><span class="op">)</span><span class="op">)</span>,las<span class="op">=</span><span class="fl">2</span>,cex<span class="op">=</span><span class="va">cex</span>,line<span class="op">=</span><span class="fl">0.7</span>,col<span class="op">=</span><span class="va">col</span><span class="op">)</span></span>
<span><span class="va">star</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">table</span><span class="op">!=</span><span class="fl">0</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">1</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span>text<span class="op">=</span><span class="st">"*"</span>,side<span class="op">=</span><span class="fl">2</span>,at<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">star</span><span class="op">)</span>,line<span class="op">=</span><span class="op">-</span><span class="fl">0.3</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span>text<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">col</span><span class="op">==</span><span class="st">"blue"</span>,<span class="st">"-"</span>,<span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">col</span><span class="op">==</span><span class="st">"red"</span>,<span class="st">"+"</span>,<span class="st">"."</span><span class="op">)</span><span class="op">)</span>,side<span class="op">=</span><span class="fl">4</span>,at<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">table</span><span class="op">)</span><span class="op">)</span>,las<span class="op">=</span><span class="fl">2</span>,cex<span class="op">=</span><span class="va">cex</span>,line<span class="op">=</span><span class="fl">0.5</span>,col<span class="op">=</span><span class="va">col</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">table</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">table</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw">for</span><span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="va">col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">coefs</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span><span class="op">&lt;</span><span class="fl">0</span>,<span class="st">"blue"</span>,<span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">coefs</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span><span class="op">&gt;</span><span class="fl">0</span>,<span class="st">"red"</span>,<span class="st">"white"</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">cex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">5</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">coefs</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,<span class="fl">0.2</span><span class="op">)</span></span>
<span>      <span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">j</span><span class="op">-</span><span class="op">(</span><span class="op">-</span><span class="fl">3</span><span class="op">+</span><span class="va">k</span><span class="op">)</span><span class="op">*</span><span class="fl">0.17</span>,y<span class="op">=</span><span class="va">i</span>,col<span class="op">=</span><span class="va">col</span>,cex<span class="op">=</span><span class="va">cex</span>,pch<span class="op">=</span><span class="fl">16</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="fl">0.5</span>,to<span class="op">=</span><span class="fl">5.5</span>,by<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">grDevices</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="data-based-simulation-under-development">Data-based simulation (under development)<a class="anchor" aria-label="anchor" href="#data-based-simulation-under-development"></a>
</h3>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span>list<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/ls.html" class="external-link">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">path</span> <span class="op">&lt;-</span> <span class="st">"C:/Users/arauschenberger/Desktop/sparselink"</span> <span class="co"># LIH (Windows)</span></span>
<span><span class="co">#path &lt;- "/Users/armin.rauschenberger/Desktop/LIH/sparselink" # LCSB (Mac)</span></span>
<span></span>
<span><span class="va">dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"results"</span>,<span class="st">"manuscript"</span>,<span class="st">"package/R/functions.R"</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">dir</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.exists</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="va">dir</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">&amp;</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="va">dir</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Require folder/file'"</span>,<span class="va">dir</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,<span class="st">"'."</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> </span>
<span><span class="op">}</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">"package/R/functions.R"</span><span class="op">)</span><span class="op">)</span> <span class="co"># Or load 'sparselink' package.</span></span>
<span></span>
<span><span class="va">inst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/installed.packages.html" class="external-link">installed.packages</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pkgs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"knitr"</span>,<span class="st">"rmarkdown"</span>,<span class="st">"glmnet"</span>,<span class="st">"BiocManager"</span>,<span class="st">"mvtnorm"</span>,<span class="st">"glmtrans"</span>,<span class="st">"spls"</span>,<span class="st">"xrnet"</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">pkgs</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="va">pkgs</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span><span class="va">inst</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="va">pkgs</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="va">pkgs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"recount3"</span>,<span class="st">"edgeR"</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">pkgs</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="va">pkgs</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span><span class="va">inst</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu">BiocManager</span><span class="fu">::</span><span class="fu">install</span><span class="op">(</span><span class="va">pkgs</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">blue</span> <span class="op">&lt;-</span> <span class="st">"blue"</span>; <span class="va">red</span> <span class="op">&lt;-</span> <span class="st">"red"</span></span>
<span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html" class="external-link">exists</a></span><span class="op">(</span><span class="st">"sim.app"</span><span class="op">)</span><span class="op">&amp;</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html" class="external-link">exists</a></span><span class="op">(</span><span class="st">"fig.tab"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="va">sim.app</span><span class="op">&amp;</span><span class="va">fig.tab</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"simulation_multiple.RData"</span>,<span class="st">"simulation_transfer.RData"</span>,<span class="st">"recount3_data.RData"</span>,<span class="st">"explore_data.RData"</span>,<span class="st">"application.RData"</span><span class="op">)</span></span>
<span>    <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">files</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">"results"</span>,<span class="va">files</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"File"</span>,<span class="va">files</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,<span class="st">"is missing."</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="va">project</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">project</span><span class="op">$</span><span class="va">IBD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Tew (2016)"</span><span class="op">=</span><span class="st">"SRP063496"</span>,</span>
<span>                 <span class="st">"Haberman (2019)"</span><span class="op">=</span><span class="st">"SRP129004"</span>,</span>
<span>                 <span class="st">"Verstockt (2019)"</span><span class="op">=</span><span class="st">"ERP113396"</span>,</span>
<span>                 <span class="st">"Verstockt (2020)"</span><span class="op">=</span><span class="st">"ERP114636"</span>,</span>
<span>                 <span class="st">"Boyd (2018)"</span><span class="op">=</span><span class="st">"SRP100787"</span><span class="op">)</span></span>
<span><span class="va">project</span><span class="op">$</span><span class="va">RA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Baker (2019)"</span><span class="op">=</span><span class="st">"SRP169062"</span>,</span>
<span>                <span class="st">"Moncrieffe (2017)"</span><span class="op">=</span><span class="st">"SRP074736"</span>,</span>
<span>                <span class="st">"Goldberg (2018)"</span><span class="op">=</span><span class="st">"SRP155483"</span><span class="op">)</span></span>
<span><span class="va">extra</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Lewis (2019)"</span><span class="op">=</span><span class="st">"ERP104864"</span><span class="op">)</span> <span class="co"># https://doi.org/10.1016/j.celrep.2019.07.091</span></span>
<span><span class="co">#&lt;&lt;setup&gt;&gt;</span></span>
<span><span class="co">#&lt;&lt;define_projects&gt;&gt;</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">"results/recount3_data.RData"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#- - - - - - - - - - - - - - -</span></span>
<span><span class="co">#- - - extract features  - - - </span></span>
<span><span class="co">#- - - - - - - - - - - - - - -</span></span>
<span></span>
<span><span class="co"># extract features</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">project</span><span class="op">)</span>,<span class="va">extra</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu">SummarizedExperiment</span><span class="fu">::</span><span class="fu">assays</span><span class="op">(</span><span class="va">data</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">$</span><span class="va">raw_counts</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">counts</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">SummarizedExperiment</span><span class="fu">::</span><span class="fu">rowRanges</span><span class="op">(</span><span class="va">data</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">$</span><span class="va">gene_name</span></span>
<span>  <span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">counts</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># select most expressed protein-coding genes (for all TL projects together)</span></span>
<span><span class="va">select</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">total</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">project</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co">#total &lt;- rbind(total,Matrix::colSums(x[[i]])) # original: mean filtering</span></span>
<span>  <span class="va">total</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">total</span>,<span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,MARGIN<span class="op">=</span><span class="fl">2</span>,FUN<span class="op">=</span><span class="fu">stats</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">)</span><span class="op">)</span> <span class="co"># trial: variance filtering</span></span>
<span><span class="op">}</span></span>
<span><span class="va">type</span> <span class="op">&lt;-</span> <span class="fu">SummarizedExperiment</span><span class="fu">::</span><span class="fu">rowData</span><span class="op">(</span><span class="va">data</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">$</span><span class="va">gene_type</span></span>
<span><span class="va">cond</span> <span class="op">&lt;-</span> <span class="va">type</span><span class="op">==</span><span class="st">"protein_coding"</span></span>
<span><span class="va">total</span><span class="op">[</span>,<span class="op">!</span><span class="va">cond</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">rank</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">total</span>,MARGIN<span class="op">=</span><span class="fl">1</span>,FUN<span class="op">=</span><span class="va">rank</span><span class="op">)</span></span>
<span><span class="va">mean_rank</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">rank</span><span class="op">)</span></span>
<span><span class="co">#temp &lt;- cond &amp; apply(total,2,function(x) all(x&gt;0)) &amp; (mean_rank &gt;= sort(mean_rank[cond],decreasing=TRUE)[2000]) # original: top 2000</span></span>
<span><span class="va">temp</span> <span class="op">&lt;-</span> <span class="va">cond</span> <span class="op">&amp;</span> <span class="va">mean_rank</span> <span class="op">&gt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">mean_rank</span><span class="op">[</span><span class="va">cond</span><span class="op">]</span>,decreasing<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">[</span><span class="fl">5000</span><span class="op">]</span> <span class="co"># trial: top 5000</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">project</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">select</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">temp</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># select most expressed protein-coding genes (for MTL project)</span></span>
<span><span class="co">#mean &lt;- apply(X=x[[extra]],MARGIN=2,FUN=mean) # original</span></span>
<span><span class="va">var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">x</span><span class="op">[[</span><span class="va">extra</span><span class="op">]</span><span class="op">]</span>,MARGIN<span class="op">=</span><span class="fl">2</span>,FUN<span class="op">=</span><span class="va">var</span><span class="op">)</span> <span class="co"># trial</span></span>
<span><span class="co">#warning("change number in next line")</span></span>
<span><span class="co">#temp &lt;- cond &amp; mean &gt;= sort(mean[cond],decreasing=TRUE)[5000] # trial: top 5000</span></span>
<span><span class="va">temp</span> <span class="op">&lt;-</span> <span class="va">cond</span> <span class="op">&amp;</span> <span class="va">var</span> <span class="op">&gt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">var</span><span class="op">[</span><span class="va">cond</span><span class="op">]</span>,decreasing<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">[</span><span class="fl">5000</span><span class="op">]</span> <span class="co"># trial: top 5000</span></span>
<span><span class="va">select</span><span class="op">[[</span><span class="va">extra</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">temp</span></span>
<span></span>
<span><span class="co"># pre-processing</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">project</span><span class="op">)</span>,<span class="va">extra</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">lib.size</span> <span class="op">&lt;-</span> <span class="fu">Matrix</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums-methods.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="va">select</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,drop<span class="op">=</span><span class="cn">FALSE</span><span class="op">]</span></span>
<span>  <span class="va">norm.factors</span> <span class="op">&lt;-</span> <span class="fu">edgeR</span><span class="fu">::</span><span class="fu">calcNormFactors</span><span class="op">(</span>object<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,lib.size<span class="op">=</span><span class="va">lib.size</span><span class="op">)</span></span>
<span>  <span class="va">gamma</span> <span class="op">&lt;-</span> <span class="va">norm.factors</span><span class="op">*</span><span class="va">lib.size</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">lib.size</span><span class="op">)</span></span>
<span>  <span class="va">gamma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">gamma</span>,nrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,ncol<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">/</span><span class="va">gamma</span></span>
<span>  <span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="fl">3</span><span class="op">/</span><span class="fl">8</span><span class="op">)</span> <span class="co"># Anscombe transform</span></span>
<span>  <span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="co"># scale because of different datasets!?</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#- - - - - - - - - - - - - -</span></span>
<span><span class="co">#- - - extract targets - - -</span></span>
<span><span class="co">#- - - - - - - - - - - - - -</span></span>
<span></span>
<span><span class="co"># extract information on samples</span></span>
<span><span class="va">frame</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">project</span><span class="op">)</span>,<span class="va">extra</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="va">data</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sra.sample_attributes</span>,split<span class="op">=</span><span class="st">"\\|"</span><span class="op">)</span></span>
<span>  <span class="va">data</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sra.experiment_attributes</span></span>
<span>  <span class="co"># What about sra.experiment_attributes?</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">list</span><span class="op">)</span></span>
<span>  <span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">list</span><span class="op">)</span>,split<span class="op">=</span><span class="st">";;"</span><span class="op">)</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">ncol</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">cols</span><span class="op">)</span></span>
<span>  <span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data<span class="op">=</span><span class="cn">NA</span>,nrow<span class="op">=</span><span class="va">n</span>,ncol<span class="op">=</span><span class="va">ncol</span>,dimnames<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,<span class="va">cols</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw">for</span><span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">ncol</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="va">vector</span> <span class="op">&lt;-</span> <span class="va">list</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span></span>
<span>      <span class="va">which</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substring</a></span><span class="op">(</span>text<span class="op">=</span><span class="va">vector</span>,first<span class="op">=</span><span class="fl">1</span>,last<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="va">cols</span><span class="op">[</span><span class="va">k</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">==</span><span class="va">cols</span><span class="op">[</span><span class="va">k</span><span class="op">]</span><span class="op">)</span></span>
<span>      <span class="va">string</span> <span class="op">&lt;-</span> <span class="va">vector</span><span class="op">[</span><span class="va">which</span><span class="op">]</span></span>
<span>      <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">string</span><span class="op">)</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span><span class="kw">next</span><span class="op">}</span></span>
<span>      <span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">j</span>,<span class="va">k</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="va">string</span>,split<span class="op">=</span><span class="st">";;"</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># extract binary outcome</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">project</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co"># CONTINUE HERE!!!</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">i</span><span class="op">==</span><span class="st">"ERP113396"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">y</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">`clinical history`</span>,FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span>EXPR<span class="op">=</span><span class="va">x</span>,<span class="st">"responder"</span><span class="op">=</span><span class="fl">1</span>,<span class="st">"non-responder"</span><span class="op">=</span><span class="fl">0</span>,<span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"invalid"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">i</span><span class="op">==</span><span class="st">"ERP114636"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">y</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">`clinical information`</span>,FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span>EXPR<span class="op">=</span><span class="va">x</span>,<span class="st">"response to vedolizumab therapy"</span><span class="op">=</span><span class="fl">1</span><span class="op">-</span><span class="fl">1</span>,<span class="st">"no response to vedolizumab therapy"</span><span class="op">=</span><span class="fl">0</span><span class="op">+</span><span class="fl">1</span>,<span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"invalid"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/warning.html" class="external-link">warning</a></span><span class="op">(</span><span class="st">"Inverting response and non-response!"</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">i</span><span class="op">==</span><span class="st">"SRP100787"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">y</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">condition</span>,FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span>EXPR<span class="op">=</span><span class="va">x</span>,<span class="st">"CD inactive"</span><span class="op">=</span><span class="fl">1</span>,<span class="st">"UC inactive"</span><span class="op">=</span><span class="fl">1</span>,<span class="st">"CD active"</span><span class="op">=</span><span class="fl">0</span>,<span class="st">"UC active"</span><span class="op">=</span><span class="fl">0</span>,control<span class="op">=</span><span class="cn">NA</span>,<span class="st">"NA"</span><span class="op">=</span><span class="cn">NA</span>,<span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"invalid"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">i</span><span class="op">==</span><span class="st">"SRP129004"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">y</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">`week 4 remission`</span>,FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span>EXP<span class="op">=</span><span class="va">x</span>,<span class="st">"Yes"</span><span class="op">=</span><span class="fl">1</span>,<span class="st">"No"</span><span class="op">=</span><span class="fl">0</span>,<span class="st">"NA"</span><span class="op">=</span><span class="cn">NA</span>,<span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"invalid"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="va">z</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>pucai<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">pucai</span><span class="op">)</span>,mayo<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">`total mayo score`</span><span class="op">)</span>,histology<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">`histology severity score`</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">i</span><span class="op">==</span><span class="st">"SRP063496"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">y</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">`remission at week 10`</span>,FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"Remitter"</span><span class="op">=</span><span class="fl">1</span>,<span class="st">"Non-remitter"</span><span class="op">=</span><span class="fl">0</span>,<span class="st">"N/A"</span><span class="op">=</span><span class="cn">NA</span>,<span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"invalid"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">i</span><span class="op">==</span><span class="st">"SRP169062"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">y</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">`flare event`</span>,FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span><span class="va">x</span>,<span class="st">"no flare"</span><span class="op">=</span><span class="fl">1</span>,<span class="st">"flare"</span><span class="op">=</span><span class="fl">0</span>,<span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"invalid"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">i</span><span class="op">==</span><span class="st">"SRP155483"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">y</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">`disease activity`</span>,FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span><span class="va">x</span>,<span class="st">"remission"</span><span class="op">=</span><span class="fl">1</span>,<span class="st">"Low"</span><span class="op">=</span><span class="fl">0</span>,<span class="st">"Moderate"</span><span class="op">=</span><span class="fl">0</span>,<span class="st">"High"</span><span class="op">=</span><span class="fl">0</span>,<span class="st">"--"</span><span class="op">=</span><span class="cn">NA</span>,<span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"invalid"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">z</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">`disease activity`</span>,FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span><span class="va">x</span>,<span class="st">"remission"</span><span class="op">=</span><span class="fl">0</span>,<span class="st">"Low"</span><span class="op">=</span><span class="fl">1</span>,<span class="st">"Moderate"</span><span class="op">=</span><span class="fl">2</span>,<span class="st">"High"</span><span class="op">=</span><span class="fl">3</span>,<span class="st">"--"</span><span class="op">=</span><span class="cn">NA</span>,<span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"invalid"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">i</span><span class="op">==</span><span class="st">"SRP074736"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">y</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">`mtx response status`</span>,FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span><span class="va">x</span>,<span class="st">"responder"</span><span class="op">=</span><span class="fl">1</span>,<span class="st">"non-responder"</span><span class="op">=</span><span class="fl">0</span>,<span class="st">"control"</span><span class="op">=</span><span class="cn">NA</span>,<span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"invalid"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># overlap</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">project</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">is.na</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">y</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">is.na</span><span class="op">)</span><span class="op">!=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">{</span><span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="op">)</span><span class="op">}</span></span>
<span>  <span class="va">y</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">y</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">!</span><span class="va">is.na</span><span class="op">]</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">z</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">is.vector</a></span><span class="op">(</span><span class="va">z</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="va">z</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">z</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">!</span><span class="va">is.na</span><span class="op">]</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="va">z</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">z</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">!</span><span class="va">is.na</span>,<span class="op">]</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">x</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">!</span><span class="va">is.na</span>,<span class="op">]</span></span>
<span><span class="op">}</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">"package/R/development.R"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">$</span><span class="va">SRP100787</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">y</span><span class="op">$</span><span class="va">SRP100787</span></span>
<span><span class="va">sd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">x</span>,<span class="fl">2</span>,<span class="va">sd</span><span class="op">)</span> <span class="co"># temporary # REMOVE THIS!</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span>,<span class="va">sd</span><span class="op">&gt;=</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">sd</span>,decreasing<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">[</span><span class="fl">100</span><span class="op">]</span><span class="op">]</span> <span class="co"># REMOVE THIS!</span></span>
<span><span class="va">iter</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="va">q</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#-- -- --- ---</span></span>
<span><span class="co">#--- MTL ---</span></span>
<span><span class="co">#-- -- --- ---</span></span>
<span></span>
<span><span class="va">prob_mtl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.00</span>,<span class="fl">0.05</span>,<span class="fl">0.10</span>,<span class="fl">0.15</span>,<span class="fl">0.20</span><span class="op">)</span></span>
<span><span class="va">auc_mtl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">prob_mtl</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">auc_mtl</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">iter</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data<span class="op">=</span><span class="cn">NA</span>,nrow<span class="op">=</span><span class="va">n</span>,ncol<span class="op">=</span><span class="va">q</span><span class="op">)</span></span>
<span>    <span class="kw">for</span><span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">q</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="va">Y</span><span class="op">[</span>,<span class="va">k</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">y</span> <span class="op">-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span>n<span class="op">=</span><span class="va">n</span>,size<span class="op">=</span><span class="fl">1</span>,prob<span class="op">=</span><span class="va">prob_mtl</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="co">#auc_mtl[[i]][[j]] &lt;- cv.multiple(y=Y,X=x,method=c("glm.separate","sparselink"),family="binomial",alpha.init=0.95,alpha=1,type="exp",trial=FALSE)$auc</span></span>
<span>    <span class="va">auc_mtl</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">joinet</span><span class="fu">::</span><span class="fu">cv.joinet</span><span class="op">(</span>Y<span class="op">=</span><span class="va">Y</span>,X<span class="op">=</span><span class="va">x</span>,family<span class="op">=</span><span class="st">"binomial"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="co"># MTL is beneficial under prob=0.15</span></span>
<span></span>
<span><span class="co"># for joinet (deviance: lower=better)</span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">auc_mtl</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">x</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">prob_mtl</span>,y<span class="op">=</span><span class="va">a</span><span class="op">[</span><span class="st">"base"</span>,<span class="op">]</span>,type<span class="op">=</span><span class="st">"o"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">prob_mtl</span>,y<span class="op">=</span><span class="va">a</span><span class="op">[</span><span class="st">"meta"</span>,<span class="op">]</span>,type<span class="op">=</span><span class="st">"o"</span>,lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">#lapply(auc_mtl,function(x) rowMeans(sapply(x,function(x) colMeans(x))))</span></span>
<span></span>
<span><span class="co">#--- --- --- ---</span></span>
<span><span class="co">#--- TL ---</span></span>
<span><span class="co">#--- --- --- ---</span></span>
<span></span>
<span><span class="va">prob_tl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.3</span>,<span class="fl">0.4</span>,<span class="fl">0.5</span>,<span class="fl">0.6</span>,<span class="fl">0.7</span><span class="op">)</span></span>
<span><span class="va">auc_tl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">prob_tl</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">auc_tl</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">cond</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span>x<span class="op">=</span><span class="cn">NA</span>,times<span class="op">=</span><span class="va">n</span><span class="op">)</span></span>
<span>  <span class="va">Y</span> <span class="op">&lt;-</span> <span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">iter</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">n0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">prob_tl</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">y</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">n1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">prob_tl</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">y</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">cond</span><span class="op">[</span><span class="va">y</span><span class="op">==</span><span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,times<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n0</span>,<span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">y</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span><span class="op">-</span><span class="va">n0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co">#sample(rep(x=c(0,1),length.out=sum(y==0)))</span></span>
<span>    <span class="va">cond</span><span class="op">[</span><span class="va">y</span><span class="op">==</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,times<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n1</span>,<span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">y</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span><span class="op">-</span><span class="va">n1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co">#sample(rep(x=c(0,1),length.out=sum(y==1)))</span></span>
<span>    <span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>y1<span class="op">=</span><span class="va">y</span><span class="op">[</span><span class="va">cond</span><span class="op">==</span><span class="fl">0</span><span class="op">]</span>,y2<span class="op">=</span><span class="va">y</span><span class="op">[</span><span class="va">cond</span><span class="op">==</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>x1<span class="op">=</span><span class="va">x</span><span class="op">[</span><span class="va">cond</span><span class="op">==</span><span class="fl">0</span>,<span class="op">]</span>,x2<span class="op">=</span><span class="va">x</span><span class="op">[</span><span class="va">cond</span><span class="op">==</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">auc_tl</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cv.multiple.html">cv.transfer</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">Y</span>,X<span class="op">=</span><span class="va">X</span>,method<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"glm.separate"</span>,<span class="st">"sparselink"</span><span class="op">)</span>,family<span class="op">=</span><span class="st">"binomial"</span>,alpha.init<span class="op">=</span><span class="fl">0.95</span>,alpha<span class="op">=</span><span class="fl">1</span>,type<span class="op">=</span><span class="st">"exp"</span>,trial<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">auc</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">prob_mtl</span>,<span class="va">auc_mtl</span>,<span class="va">prob_tl</span>,<span class="va">auc_tl</span>,file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">"results"</span>,<span class="st">"sim-devel.RData"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># MTL: AUC vs contamination</span></span>
<span><span class="va">aucs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">auc_mtl</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">x</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">auc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">aucs</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">prob_mtl</span>,<span class="va">auc</span><span class="op">[</span><span class="st">"sparselink"</span>,<span class="op">]</span>,type<span class="op">=</span><span class="st">"o"</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.4</span>,<span class="fl">0.8</span><span class="op">)</span>,col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">prob_mtl</span>,<span class="va">auc</span><span class="op">[</span><span class="st">"glm.separate"</span>,<span class="op">]</span>,type<span class="op">=</span><span class="st">"o"</span>,col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="fl">0.5</span>,lty<span class="op">=</span><span class="fl">2</span>,col<span class="op">=</span><span class="st">"grey"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># TL: source/target sample size</span></span>
<span><span class="va">aucs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">auc_tl</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">x</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">auc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">aucs</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">prob_tl</span>,<span class="va">auc</span><span class="op">[</span><span class="st">"sparselink"</span>,<span class="op">]</span>,type<span class="op">=</span><span class="st">"o"</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.4</span>,<span class="fl">0.8</span><span class="op">)</span>,col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">prob_tl</span>,<span class="va">auc</span><span class="op">[</span><span class="st">"glm.separate"</span>,<span class="op">]</span>,type<span class="op">=</span><span class="st">"o"</span>,col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="fl">0.5</span>,lty<span class="op">=</span><span class="fl">2</span>,col<span class="op">=</span><span class="st">"grey"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># statistical testing</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="multi-task-learning-under-development">Multi-task learning (under development)<a class="anchor" aria-label="anchor" href="#multi-task-learning-under-development"></a>
</h3>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span>list<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/ls.html" class="external-link">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">path</span> <span class="op">&lt;-</span> <span class="st">"C:/Users/arauschenberger/Desktop/sparselink"</span> <span class="co"># LIH (Windows)</span></span>
<span><span class="co">#path &lt;- "/Users/armin.rauschenberger/Desktop/LIH/sparselink" # LCSB (Mac)</span></span>
<span></span>
<span><span class="va">dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"results"</span>,<span class="st">"manuscript"</span>,<span class="st">"package/R/functions.R"</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">dir</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.exists</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="va">dir</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">&amp;</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="va">dir</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Require folder/file'"</span>,<span class="va">dir</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,<span class="st">"'."</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> </span>
<span><span class="op">}</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">"package/R/functions.R"</span><span class="op">)</span><span class="op">)</span> <span class="co"># Or load 'sparselink' package.</span></span>
<span></span>
<span><span class="va">inst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/installed.packages.html" class="external-link">installed.packages</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pkgs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"knitr"</span>,<span class="st">"rmarkdown"</span>,<span class="st">"glmnet"</span>,<span class="st">"BiocManager"</span>,<span class="st">"mvtnorm"</span>,<span class="st">"glmtrans"</span>,<span class="st">"spls"</span>,<span class="st">"xrnet"</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">pkgs</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="va">pkgs</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span><span class="va">inst</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="va">pkgs</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="va">pkgs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"recount3"</span>,<span class="st">"edgeR"</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">pkgs</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="va">pkgs</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span><span class="va">inst</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu">BiocManager</span><span class="fu">::</span><span class="fu">install</span><span class="op">(</span><span class="va">pkgs</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">blue</span> <span class="op">&lt;-</span> <span class="st">"blue"</span>; <span class="va">red</span> <span class="op">&lt;-</span> <span class="st">"red"</span></span>
<span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html" class="external-link">exists</a></span><span class="op">(</span><span class="st">"sim.app"</span><span class="op">)</span><span class="op">&amp;</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html" class="external-link">exists</a></span><span class="op">(</span><span class="st">"fig.tab"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="va">sim.app</span><span class="op">&amp;</span><span class="va">fig.tab</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"simulation_multiple.RData"</span>,<span class="st">"simulation_transfer.RData"</span>,<span class="st">"recount3_data.RData"</span>,<span class="st">"explore_data.RData"</span>,<span class="st">"application.RData"</span><span class="op">)</span></span>
<span>    <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">files</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">"results"</span>,<span class="va">files</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"File"</span>,<span class="va">files</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,<span class="st">"is missing."</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="va">project</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">project</span><span class="op">$</span><span class="va">IBD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Tew (2016)"</span><span class="op">=</span><span class="st">"SRP063496"</span>,</span>
<span>                 <span class="st">"Haberman (2019)"</span><span class="op">=</span><span class="st">"SRP129004"</span>,</span>
<span>                 <span class="st">"Verstockt (2019)"</span><span class="op">=</span><span class="st">"ERP113396"</span>,</span>
<span>                 <span class="st">"Verstockt (2020)"</span><span class="op">=</span><span class="st">"ERP114636"</span>,</span>
<span>                 <span class="st">"Boyd (2018)"</span><span class="op">=</span><span class="st">"SRP100787"</span><span class="op">)</span></span>
<span><span class="va">project</span><span class="op">$</span><span class="va">RA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Baker (2019)"</span><span class="op">=</span><span class="st">"SRP169062"</span>,</span>
<span>                <span class="st">"Moncrieffe (2017)"</span><span class="op">=</span><span class="st">"SRP074736"</span>,</span>
<span>                <span class="st">"Goldberg (2018)"</span><span class="op">=</span><span class="st">"SRP155483"</span><span class="op">)</span></span>
<span><span class="va">extra</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Lewis (2019)"</span><span class="op">=</span><span class="st">"ERP104864"</span><span class="op">)</span> <span class="co"># https://doi.org/10.1016/j.celrep.2019.07.091</span></span>
<span><span class="co">#&lt;&lt;setup&gt;&gt;</span></span>
<span><span class="co">#&lt;&lt;define_projects&gt;&gt;</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">"results/recount3_data.RData"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#- - - - - - - - - - - - - - -</span></span>
<span><span class="co">#- - - extract features  - - - </span></span>
<span><span class="co">#- - - - - - - - - - - - - - -</span></span>
<span></span>
<span><span class="co"># extract features</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">project</span><span class="op">)</span>,<span class="va">extra</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu">SummarizedExperiment</span><span class="fu">::</span><span class="fu">assays</span><span class="op">(</span><span class="va">data</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">$</span><span class="va">raw_counts</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">counts</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">SummarizedExperiment</span><span class="fu">::</span><span class="fu">rowRanges</span><span class="op">(</span><span class="va">data</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">$</span><span class="va">gene_name</span></span>
<span>  <span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">counts</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># select most expressed protein-coding genes (for all TL projects together)</span></span>
<span><span class="va">select</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">total</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">project</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co">#total &lt;- rbind(total,Matrix::colSums(x[[i]])) # original: mean filtering</span></span>
<span>  <span class="va">total</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">total</span>,<span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,MARGIN<span class="op">=</span><span class="fl">2</span>,FUN<span class="op">=</span><span class="fu">stats</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">)</span><span class="op">)</span> <span class="co"># trial: variance filtering</span></span>
<span><span class="op">}</span></span>
<span><span class="va">type</span> <span class="op">&lt;-</span> <span class="fu">SummarizedExperiment</span><span class="fu">::</span><span class="fu">rowData</span><span class="op">(</span><span class="va">data</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">$</span><span class="va">gene_type</span></span>
<span><span class="va">cond</span> <span class="op">&lt;-</span> <span class="va">type</span><span class="op">==</span><span class="st">"protein_coding"</span></span>
<span><span class="va">total</span><span class="op">[</span>,<span class="op">!</span><span class="va">cond</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">rank</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">total</span>,MARGIN<span class="op">=</span><span class="fl">1</span>,FUN<span class="op">=</span><span class="va">rank</span><span class="op">)</span></span>
<span><span class="va">mean_rank</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">rank</span><span class="op">)</span></span>
<span><span class="co">#temp &lt;- cond &amp; apply(total,2,function(x) all(x&gt;0)) &amp; (mean_rank &gt;= sort(mean_rank[cond],decreasing=TRUE)[2000]) # original: top 2000</span></span>
<span><span class="va">temp</span> <span class="op">&lt;-</span> <span class="va">cond</span> <span class="op">&amp;</span> <span class="va">mean_rank</span> <span class="op">&gt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">mean_rank</span><span class="op">[</span><span class="va">cond</span><span class="op">]</span>,decreasing<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">[</span><span class="fl">5000</span><span class="op">]</span> <span class="co"># trial: top 5000</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">project</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">select</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">temp</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># select most expressed protein-coding genes (for MTL project)</span></span>
<span><span class="co">#mean &lt;- apply(X=x[[extra]],MARGIN=2,FUN=mean) # original</span></span>
<span><span class="va">var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">x</span><span class="op">[[</span><span class="va">extra</span><span class="op">]</span><span class="op">]</span>,MARGIN<span class="op">=</span><span class="fl">2</span>,FUN<span class="op">=</span><span class="va">var</span><span class="op">)</span> <span class="co"># trial</span></span>
<span><span class="co">#warning("change number in next line")</span></span>
<span><span class="co">#temp &lt;- cond &amp; mean &gt;= sort(mean[cond],decreasing=TRUE)[5000] # trial: top 5000</span></span>
<span><span class="va">temp</span> <span class="op">&lt;-</span> <span class="va">cond</span> <span class="op">&amp;</span> <span class="va">var</span> <span class="op">&gt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">var</span><span class="op">[</span><span class="va">cond</span><span class="op">]</span>,decreasing<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">[</span><span class="fl">5000</span><span class="op">]</span> <span class="co"># trial: top 5000</span></span>
<span><span class="va">select</span><span class="op">[[</span><span class="va">extra</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">temp</span></span>
<span></span>
<span><span class="co"># pre-processing</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">project</span><span class="op">)</span>,<span class="va">extra</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">lib.size</span> <span class="op">&lt;-</span> <span class="fu">Matrix</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums-methods.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="va">select</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,drop<span class="op">=</span><span class="cn">FALSE</span><span class="op">]</span></span>
<span>  <span class="va">norm.factors</span> <span class="op">&lt;-</span> <span class="fu">edgeR</span><span class="fu">::</span><span class="fu">calcNormFactors</span><span class="op">(</span>object<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,lib.size<span class="op">=</span><span class="va">lib.size</span><span class="op">)</span></span>
<span>  <span class="va">gamma</span> <span class="op">&lt;-</span> <span class="va">norm.factors</span><span class="op">*</span><span class="va">lib.size</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">lib.size</span><span class="op">)</span></span>
<span>  <span class="va">gamma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">gamma</span>,nrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,ncol<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">/</span><span class="va">gamma</span></span>
<span>  <span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="fl">3</span><span class="op">/</span><span class="fl">8</span><span class="op">)</span> <span class="co"># Anscombe transform</span></span>
<span>  <span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="co"># scale because of different datasets!?</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#- - - - - - - - - - - - - -</span></span>
<span><span class="co">#- - - extract targets - - -</span></span>
<span><span class="co">#- - - - - - - - - - - - - -</span></span>
<span></span>
<span><span class="co"># extract information on samples</span></span>
<span><span class="va">frame</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">project</span><span class="op">)</span>,<span class="va">extra</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="va">data</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sra.sample_attributes</span>,split<span class="op">=</span><span class="st">"\\|"</span><span class="op">)</span></span>
<span>  <span class="va">data</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sra.experiment_attributes</span></span>
<span>  <span class="co"># What about sra.experiment_attributes?</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">list</span><span class="op">)</span></span>
<span>  <span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">list</span><span class="op">)</span>,split<span class="op">=</span><span class="st">";;"</span><span class="op">)</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">ncol</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">cols</span><span class="op">)</span></span>
<span>  <span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data<span class="op">=</span><span class="cn">NA</span>,nrow<span class="op">=</span><span class="va">n</span>,ncol<span class="op">=</span><span class="va">ncol</span>,dimnames<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,<span class="va">cols</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw">for</span><span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">ncol</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="va">vector</span> <span class="op">&lt;-</span> <span class="va">list</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span></span>
<span>      <span class="va">which</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substring</a></span><span class="op">(</span>text<span class="op">=</span><span class="va">vector</span>,first<span class="op">=</span><span class="fl">1</span>,last<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="va">cols</span><span class="op">[</span><span class="va">k</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">==</span><span class="va">cols</span><span class="op">[</span><span class="va">k</span><span class="op">]</span><span class="op">)</span></span>
<span>      <span class="va">string</span> <span class="op">&lt;-</span> <span class="va">vector</span><span class="op">[</span><span class="va">which</span><span class="op">]</span></span>
<span>      <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">string</span><span class="op">)</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span><span class="kw">next</span><span class="op">}</span></span>
<span>      <span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">j</span>,<span class="va">k</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="va">string</span>,split<span class="op">=</span><span class="st">";;"</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># extract binary outcome</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">project</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co"># CONTINUE HERE!!!</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">i</span><span class="op">==</span><span class="st">"ERP113396"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">y</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">`clinical history`</span>,FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span>EXPR<span class="op">=</span><span class="va">x</span>,<span class="st">"responder"</span><span class="op">=</span><span class="fl">1</span>,<span class="st">"non-responder"</span><span class="op">=</span><span class="fl">0</span>,<span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"invalid"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">i</span><span class="op">==</span><span class="st">"ERP114636"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">y</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">`clinical information`</span>,FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span>EXPR<span class="op">=</span><span class="va">x</span>,<span class="st">"response to vedolizumab therapy"</span><span class="op">=</span><span class="fl">1</span><span class="op">-</span><span class="fl">1</span>,<span class="st">"no response to vedolizumab therapy"</span><span class="op">=</span><span class="fl">0</span><span class="op">+</span><span class="fl">1</span>,<span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"invalid"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/warning.html" class="external-link">warning</a></span><span class="op">(</span><span class="st">"Inverting response and non-response!"</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">i</span><span class="op">==</span><span class="st">"SRP100787"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">y</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">condition</span>,FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span>EXPR<span class="op">=</span><span class="va">x</span>,<span class="st">"CD inactive"</span><span class="op">=</span><span class="fl">1</span>,<span class="st">"UC inactive"</span><span class="op">=</span><span class="fl">1</span>,<span class="st">"CD active"</span><span class="op">=</span><span class="fl">0</span>,<span class="st">"UC active"</span><span class="op">=</span><span class="fl">0</span>,control<span class="op">=</span><span class="cn">NA</span>,<span class="st">"NA"</span><span class="op">=</span><span class="cn">NA</span>,<span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"invalid"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">i</span><span class="op">==</span><span class="st">"SRP129004"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">y</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">`week 4 remission`</span>,FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span>EXP<span class="op">=</span><span class="va">x</span>,<span class="st">"Yes"</span><span class="op">=</span><span class="fl">1</span>,<span class="st">"No"</span><span class="op">=</span><span class="fl">0</span>,<span class="st">"NA"</span><span class="op">=</span><span class="cn">NA</span>,<span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"invalid"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="va">z</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>pucai<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">pucai</span><span class="op">)</span>,mayo<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">`total mayo score`</span><span class="op">)</span>,histology<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">`histology severity score`</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">i</span><span class="op">==</span><span class="st">"SRP063496"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">y</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">`remission at week 10`</span>,FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"Remitter"</span><span class="op">=</span><span class="fl">1</span>,<span class="st">"Non-remitter"</span><span class="op">=</span><span class="fl">0</span>,<span class="st">"N/A"</span><span class="op">=</span><span class="cn">NA</span>,<span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"invalid"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">i</span><span class="op">==</span><span class="st">"SRP169062"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">y</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">`flare event`</span>,FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span><span class="va">x</span>,<span class="st">"no flare"</span><span class="op">=</span><span class="fl">1</span>,<span class="st">"flare"</span><span class="op">=</span><span class="fl">0</span>,<span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"invalid"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">i</span><span class="op">==</span><span class="st">"SRP155483"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">y</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">`disease activity`</span>,FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span><span class="va">x</span>,<span class="st">"remission"</span><span class="op">=</span><span class="fl">1</span>,<span class="st">"Low"</span><span class="op">=</span><span class="fl">0</span>,<span class="st">"Moderate"</span><span class="op">=</span><span class="fl">0</span>,<span class="st">"High"</span><span class="op">=</span><span class="fl">0</span>,<span class="st">"--"</span><span class="op">=</span><span class="cn">NA</span>,<span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"invalid"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">z</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">`disease activity`</span>,FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span><span class="va">x</span>,<span class="st">"remission"</span><span class="op">=</span><span class="fl">0</span>,<span class="st">"Low"</span><span class="op">=</span><span class="fl">1</span>,<span class="st">"Moderate"</span><span class="op">=</span><span class="fl">2</span>,<span class="st">"High"</span><span class="op">=</span><span class="fl">3</span>,<span class="st">"--"</span><span class="op">=</span><span class="cn">NA</span>,<span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"invalid"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">i</span><span class="op">==</span><span class="st">"SRP074736"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">y</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">frame</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">`mtx response status`</span>,FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span><span class="va">x</span>,<span class="st">"responder"</span><span class="op">=</span><span class="fl">1</span>,<span class="st">"non-responder"</span><span class="op">=</span><span class="fl">0</span>,<span class="st">"control"</span><span class="op">=</span><span class="cn">NA</span>,<span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"invalid"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># overlap</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">project</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">is.na</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">y</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">is.na</span><span class="op">)</span><span class="op">!=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">{</span><span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="op">)</span><span class="op">}</span></span>
<span>  <span class="va">y</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">y</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">!</span><span class="va">is.na</span><span class="op">]</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">z</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">is.vector</a></span><span class="op">(</span><span class="va">z</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="va">z</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">z</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">!</span><span class="va">is.na</span><span class="op">]</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="va">z</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">z</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">!</span><span class="va">is.na</span>,<span class="op">]</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">x</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">!</span><span class="va">is.na</span>,<span class="op">]</span></span>
<span><span class="op">}</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">"package/R/development.R"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#- - - - - - - - - - </span></span>
<span><span class="co">#- - prepare data - -</span></span>
<span><span class="co">#- - - - - - - - - - </span></span>
<span></span>
<span><span class="co"># explore SRP048801</span></span>
<span></span>
<span><span class="va">project</span> <span class="op">&lt;-</span> <span class="st">"ERP104864"</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="va">project</span><span class="op">==</span><span class="st">"SRP155483"</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">X</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">$</span><span class="va">SRP155483</span></span>
<span>  <span class="va">vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"disease activity"</span>,<span class="st">"das score"</span><span class="op">)</span></span>
<span>  <span class="va">Y</span> <span class="op">&lt;-</span> <span class="va">frame</span><span class="op">$</span><span class="va">SRP155483</span><span class="op">[</span>,<span class="va">vars</span><span class="op">]</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">Y</span><span class="op">$</span><span class="va">`disease activity`</span><span class="op">)</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">Y</span><span class="op">$</span><span class="va">`das score`</span><span class="op">[</span><span class="va">Y</span><span class="op">$</span><span class="va">`disease activity`</span><span class="op">==</span><span class="va">x</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/warning.html" class="external-link">warning</a></span><span class="op">(</span><span class="st">"DAS score defines disease activity!"</span><span class="op">)</span></span>
<span>  <span class="va">problem</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">problem</span><span class="op">$</span><span class="va">unique</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">project</span><span class="op">==</span><span class="st">"SRP129004"</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">X</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">$</span><span class="va">SRP129004</span></span>
<span>  <span class="va">vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"histology severity score"</span>,<span class="st">"total mayo score"</span><span class="op">)</span></span>
<span>  <span class="va">Y</span> <span class="op">&lt;-</span> <span class="va">frame</span><span class="op">$</span><span class="va">SRP129004</span><span class="op">[</span>,<span class="va">vars</span><span class="op">]</span></span>
<span>  <span class="va">names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">intersect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">X</span> <span class="op">&lt;-</span> <span class="va">X</span><span class="op">[</span><span class="va">names</span>,<span class="op">]</span></span>
<span>  <span class="va">Y</span> <span class="op">&lt;-</span> <span class="va">Y</span><span class="op">[</span><span class="va">names</span>,<span class="op">]</span></span>
<span>  <span class="va">cond</span> <span class="op">&lt;-</span> <span class="va">frame</span><span class="op">$</span><span class="va">SRP129004</span><span class="op">[</span><span class="va">names</span>,<span class="st">"diagnosis"</span><span class="op">]</span><span class="op">==</span><span class="st">"Ulcerative Colitis"</span></span>
<span>  <span class="va">X</span> <span class="op">&lt;-</span> <span class="va">X</span><span class="op">[</span><span class="va">cond</span>,<span class="op">]</span></span>
<span>  <span class="va">Y</span> <span class="op">&lt;-</span> <span class="va">Y</span><span class="op">[</span><span class="va">cond</span>,<span class="op">]</span></span>
<span>  <span class="va">problem</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">problem</span><span class="op">$</span><span class="va">unique</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">project</span><span class="op">==</span><span class="st">"ERP104864"</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">X</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">$</span><span class="va">ERP104864</span></span>
<span>  <span class="va">vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CCP"</span>,<span class="st">"CRP"</span>,<span class="st">"crp"</span>,<span class="st">"DAS28"</span>,<span class="st">"ESR"</span>,<span class="st">"esr"</span>,<span class="st">"HAQ"</span>,<span class="st">"VAS"</span>,<span class="st">"SWOLLEN"</span>,<span class="st">"TENDER"</span><span class="op">)</span> <span class="co"># "inflammatory score" dropped due to NA # "RF" dropped because binary</span></span>
<span>  <span class="va">Y</span> <span class="op">&lt;-</span> <span class="va">frame</span><span class="op">$</span><span class="va">ERP104864</span><span class="op">[</span>,<span class="va">vars</span><span class="op">]</span></span>
<span>  <span class="va">pathotype</span> <span class="op">&lt;-</span> <span class="va">frame</span><span class="op">$</span><span class="va">ERP104864</span><span class="op">$</span><span class="va">pathotype</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">!=</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span><span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="op">)</span><span class="op">}</span></span>
<span>  <span class="co">#Y &lt;- Y[Y$pathotype=="lymphoid",vars]</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">Y</span><span class="op">$</span><span class="va">CRP</span><span class="op">)</span><span class="op">&amp;</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">Y</span><span class="op">$</span><span class="va">crp</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Invalid."</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">Y</span><span class="op">$</span><span class="va">CRP</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">Y</span><span class="op">$</span><span class="va">CRP</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Y</span><span class="op">$</span><span class="va">crp</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">Y</span><span class="op">$</span><span class="va">CRP</span><span class="op">)</span><span class="op">]</span></span>
<span>    <span class="va">Y</span><span class="op">$</span><span class="va">crp</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">Y</span><span class="op">$</span><span class="va">ESR</span><span class="op">)</span><span class="op">&amp;</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">Y</span><span class="op">$</span><span class="va">esr</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Invalid."</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">Y</span><span class="op">$</span><span class="va">ESR</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">Y</span><span class="op">$</span><span class="va">ESR</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Y</span><span class="op">$</span><span class="va">esr</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">Y</span><span class="op">$</span><span class="va">ESR</span><span class="op">)</span><span class="op">]</span></span>
<span>    <span class="va">Y</span><span class="op">$</span><span class="va">esr</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">problem</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="co">#problem$joint &lt;- c("SWOLLEN","TENDER")</span></span>
<span>  <span class="co">#problem$proms &lt;- c("VAS","HAQ")</span></span>
<span>  <span class="co">#problem$labor &lt;- c("CRP","ESR") # CCP might be too different (check cor)</span></span>
<span>  <span class="va">problem</span><span class="op">$</span><span class="va">trial</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CRP"</span>,<span class="st">"ESR"</span>,<span class="st">"SWOLLEN"</span><span class="op">)</span></span>
<span>  <span class="co">#problem$trial &lt;- c("DAS28","SWOLLEN","TENDER")</span></span>
<span>  <span class="co">#problem$all &lt;- colnames(y)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">Y</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"numeric"</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">cond</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">Y</span>,MARGIN<span class="op">=</span><span class="fl">1</span>,FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co">#&amp; pathotype=="lymphoid" # subtypes seem to be defined based on clinical scores</span></span>
<span><span class="co">#Y &lt;- as.matrix(Y)[cond,] # temporary: binarisation</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span><span class="op">[</span><span class="va">cond</span>,<span class="op">]</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">X</span><span class="op">[</span><span class="va">cond</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co">#- - - - - - - - - - - - - </span></span>
<span><span class="co">#- - explore similarity - -</span></span>
<span><span class="co">#- - - - - - - - - - - - - </span></span>
<span></span>
<span><span class="va">cor</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">y</span>,use<span class="op">=</span><span class="st">"pairwise.complete.obs"</span>,method<span class="op">=</span><span class="st">"spearman"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">cor</span>,digits<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/image.html" class="external-link">image</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">cor</span><span class="op">)</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">cor</span><span class="op">)</span><span class="op">:</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#stats::heatmap(x=as.matrix(Y),Rowv=NA)</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">hclust</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/hclust.html" class="external-link">hclust</a></span><span class="op">(</span>d<span class="op">=</span><span class="va">d</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">hclust</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">4</span><span class="op">)</span>,mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">pvalue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">x</span>,<span class="fl">2</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.test.html" class="external-link">cor.test</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>,method<span class="op">=</span><span class="st">"spearman"</span><span class="op">)</span><span class="op">$</span><span class="va">p.value</span><span class="op">)</span></span>
<span>    <span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">pvalue</span>,main<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#--- relationship between cor coef and cor p-value ---</span></span>
<span><span class="va">coef</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">y</span><span class="op">[</span>,<span class="st">"CRP"</span><span class="op">]</span>,x<span class="op">=</span><span class="va">x</span>,method<span class="op">=</span><span class="st">"spearman"</span><span class="op">)</span></span>
<span><span class="va">pval</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">x</span>,MARGIN<span class="op">=</span><span class="fl">2</span>,FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.test.html" class="external-link">cor.test</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>,y<span class="op">=</span><span class="va">y</span><span class="op">[</span>,<span class="st">"CRP"</span><span class="op">]</span>,method<span class="op">=</span><span class="st">"spearman"</span><span class="op">)</span><span class="op">$</span><span class="va">p.value</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">coef</span>,y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sign.html" class="external-link">sign</a></span><span class="op">(</span><span class="va">coef</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">pval</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="co">#--- conclusion: equivalent ---</span></span>
<span></span>
<span><span class="co">#--- examine correlation between ridge coefficients ---</span></span>
<span><span class="va">coef</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data<span class="op">=</span><span class="cn">NA</span>,nrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,ncol<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>,dimnames<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="cn">NULL</span>,<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">object</span> <span class="op">&lt;-</span> <span class="fu">glmnet</span><span class="fu">::</span><span class="fu"><a href="https://glmnet.stanford.edu/reference/cv.glmnet.html" class="external-link">cv.glmnet</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>,y<span class="op">=</span><span class="va">y</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>,family<span class="op">=</span><span class="st">"gaussian"</span>,alpha<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="va">coef</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span>object<span class="op">=</span><span class="va">object</span>,s<span class="op">=</span><span class="st">"lambda.min"</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">coef</span>,method<span class="op">=</span><span class="st">"spearman"</span><span class="op">)</span>,digits<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#--- conclusion: some sets are strongly correlated ---</span></span>
<span></span>
<span><span class="co">#cor(rowSums(scale(Y)),Y,method="spearman")</span></span>
<span></span>
<span><span class="co">#- - - - - - - - - - - - - </span></span>
<span><span class="co">#- - cross-validation - -</span></span>
<span><span class="co">#- - - - - - - - - - - - - </span></span>
<span></span>
<span><span class="va">alpha.init</span> <span class="op">&lt;-</span> <span class="fl">0.95</span>; <span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fl">1</span>; <span class="va">type</span> <span class="op">&lt;-</span> <span class="st">"exp"</span>; <span class="va">trial</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span></span>
<span><span class="co">#alpha.init &lt;- NA; alpha &lt;- 1; type &lt;- "exp"; trial &lt;- TRUE</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">problem</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">results</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">{</span> <span class="co"># 5 repetitions of 10-fold CV</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span>    <span class="va">method</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"glm.empty"</span>,<span class="st">"glm.separate"</span>,<span class="st">"glm.mgaussian"</span>,<span class="st">"sparselink"</span>,<span class="st">"glm.spls"</span><span class="op">)</span> <span class="co">#"sparselink" "group.devel"</span></span>
<span>    <span class="va">results</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span>  <span class="fu"><a href="../reference/cv.multiple.html">cv.multiple</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">y</span><span class="op">[</span>,<span class="va">problem</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">]</span>,X<span class="op">=</span><span class="va">x</span>,family<span class="op">=</span><span class="st">"gaussian"</span>,method<span class="op">=</span><span class="va">method</span>,nfolds<span class="op">=</span><span class="fl">10</span>,alpha<span class="op">=</span><span class="va">alpha</span>,alpha.init<span class="op">=</span><span class="va">alpha.init</span>,type<span class="op">=</span><span class="va">type</span>,trial<span class="op">=</span><span class="va">trial</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">results</span>,file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">"results"</span>,<span class="st">"app_mtl_devel.RData"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">results</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">x</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">deviance</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">results</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">deviance</span><span class="op">/</span><span class="va">results</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">deviance</span><span class="op">[</span>,<span class="st">"glm.empty"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">problem</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">trial</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">deviance</span><span class="op">/</span><span class="va">results</span><span class="op">$</span><span class="va">trial</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">deviance</span><span class="op">[</span>,<span class="st">"glm.empty"</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">results</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">x</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">deviance</span>,<span class="fl">1</span>,<span class="va">rank</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">object</span> <span class="op">&lt;-</span> <span class="fu">devel</span><span class="op">(</span>y<span class="op">=</span><span class="va">y</span><span class="op">[</span>,<span class="va">problem</span><span class="op">$</span><span class="va">trial</span><span class="op">]</span>,x<span class="op">=</span><span class="va">x</span>,family<span class="op">=</span><span class="st">"gaussian"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">problem</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">dev</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">deviance</span></span>
<span>    <span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">dev</span><span class="op">/</span><span class="va">dev</span><span class="op">[</span>,<span class="st">"glm.separate"</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">cm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">cm</span>,<span class="va">temp</span><span class="op">)</span></span>
<span>    <span class="co">#cat(cm,"\n")</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">cm</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># separate, mgaussian, sparselink and devel have similar performance (i.e., MTL has no benefit with any of these three approaches), examine whether other approaches are better</span></span>
<span></span>
<span><span class="co"># examine whether group lasso for TL/MTL performs better</span></span>
<span></span>
<span><span class="co"># Consider using different candidate values, e.g., 0.01,0.5,1,1.5,2,10 also for sparselink. Removing 0 might be a good choice. (If 0 is not included, however, initial ridge regression might be better.)</span></span>
<span></span>
<span><span class="co">#- - - - - - - - - - - -</span></span>
<span><span class="co">#- - learning curve - -</span></span>
<span><span class="co">#- - - - - - - - - - - -</span></span>
<span></span>
<span><span class="va">size</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="fl">50</span>,to<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,by<span class="op">=</span><span class="fl">25</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">iter</span> <span class="op">&lt;-</span> <span class="fl">10</span> <span class="co"># increase to 10</span></span>
<span><span class="va">size</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="co"># suppress learning curve</span></span>
<span></span>
<span><span class="va">metric</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">setting</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>problem<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">problem</span><span class="op">)</span>,size<span class="op">=</span><span class="va">size</span>,iter<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">iter</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">setting</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span>progress<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fl">100</span><span class="op">*</span><span class="va">i</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">setting</span><span class="op">)</span>,<span class="st">"%"</span><span class="op">)</span>,<span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="va">cond</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">FALSE</span>,<span class="cn">TRUE</span><span class="op">)</span>,times<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">-</span><span class="va">setting</span><span class="op">$</span><span class="va">size</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,<span class="va">setting</span><span class="op">$</span><span class="va">size</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">vars</span> <span class="op">&lt;-</span> <span class="va">problem</span><span class="op">[[</span><span class="va">setting</span><span class="op">$</span><span class="va">problem</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">metric</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">joinet</span><span class="fu">:::</span><span class="fu">cv.joinet</span><span class="op">(</span>Y<span class="op">=</span><span class="va">y</span><span class="op">[</span><span class="va">cond</span>,<span class="va">vars</span><span class="op">]</span>,X<span class="op">=</span><span class="va">x</span><span class="op">[</span><span class="va">cond</span>,<span class="op">]</span>,family<span class="op">=</span><span class="st">"gaussian"</span>,compare<span class="op">=</span><span class="st">"mnorm"</span><span class="op">)</span></span>
<span>  <span class="co">#method &lt;- c("glm.empty","glm.separate","glm.mgaussian","sparselink")</span></span>
<span>  <span class="co">#metric[[i]] &lt;-  cv.multiple(y=y[cond,vars],X=x[cond,],family="gaussian",method=method,nfolds=10,alpha.init=0.95,alpha=1,type="exp",trial=FALSE)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">frac</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">metric</span>,FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">/</span><span class="va">x</span><span class="op">[</span><span class="st">"none"</span>,<span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#frac &lt;- sapply(X=metric,FUN=function(x) colMeans(x$deviance/x$deviance[,"glm.empty"]))</span></span>
<span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">problem</span><span class="op">)</span><span class="op">)</span>,mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">2</span>,<span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">problem</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/frame.html" class="external-link">plot.new</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.window.html" class="external-link">plot.window</a></span><span class="op">(</span>xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">size</span><span class="op">)</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">frac</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/box.html" class="external-link">box</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span>main<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">problem</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span>side<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span>side<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="fl">1</span>,col<span class="op">=</span><span class="st">"grey"</span>,lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="va">cond</span> <span class="op">&lt;-</span> <span class="va">setting</span><span class="op">$</span><span class="va">problem</span><span class="op">==</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">problem</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>base<span class="op">=</span><span class="st">"red"</span>,mnorm<span class="op">=</span><span class="st">"orange"</span>,meta<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></span>
<span>  <span class="co">#col &lt;- c(glm.separate="red",sparselink="blue")</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">col</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">val</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">frac</span><span class="op">[</span><span class="va">j</span>,<span class="va">cond</span><span class="op">]</span>,INDEX<span class="op">=</span><span class="va">setting</span><span class="op">$</span><span class="va">size</span><span class="op">[</span><span class="va">cond</span><span class="op">]</span>,FUN<span class="op">=</span><span class="va">mean</span><span class="op">)</span></span>
<span>    <span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">setting</span><span class="op">$</span><span class="va">size</span><span class="op">[</span><span class="va">cond</span><span class="op">]</span>,y<span class="op">=</span><span class="va">frac</span><span class="op">[</span><span class="va">j</span>,<span class="va">cond</span><span class="op">]</span>,col<span class="op">=</span><span class="va">col</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">size</span>,y<span class="op">=</span><span class="va">val</span>,col<span class="op">=</span><span class="va">col</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>,type<span class="op">=</span><span class="st">"o"</span>,pch<span class="op">=</span><span class="fl">16</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#  JOINET is better than standard lasso when n&gt;=100, performance is similar to spls and better than glmnet-mgaussian </span></span>
<span></span>
<span><span class="co">#--- --- --- --- --- ---</span></span>
<span><span class="co"># binarisation ---</span></span>
<span><span class="co">#--- --- --- --- --- ---</span></span>
<span></span>
<span></span>
<span><span class="va">yy</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span>,<span class="st">"CCP"</span><span class="op">]</span><span class="op">&gt;</span><span class="fl">20</span>,<span class="va">y</span><span class="op">[</span>,<span class="st">"CRP"</span><span class="op">]</span><span class="op">&gt;</span><span class="fl">10</span>,<span class="va">y</span><span class="op">[</span>,<span class="st">"DAS28"</span><span class="op">]</span><span class="op">&gt;</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">metric</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">metric</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">joinet</span><span class="fu">:::</span><span class="fu">cv.joinet</span><span class="op">(</span>Y<span class="op">=</span><span class="va">yy</span>,X<span class="op">=</span><span class="va">x</span>,family<span class="op">=</span><span class="st">"binomial"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#rowMeans(sapply(metric,function(x) rowMeans(x)))</span></span>
<span></span>
<span><span class="co">#--- --- --- --- --- --- ---</span></span>
<span><span class="co">#--- explore other datasets ---</span></span>
<span><span class="co">#--- --- --- --- --- --- ---</span></span>
<span></span>
<span><span class="co">#projects &lt;- recount3::available_projects(organism="human")</span></span>
<span><span class="co">#recount3::read_metadata()</span></span>
<span></span>
<span></span>
<span><span class="co">#data &lt;- xlsx::read.xlsx(paste0(path,"/results/PPMI_Curated_Data_Cut_Public_20250321.xlsx"),sheetIndex=1)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">path</span>,<span class="st">"/results/PPMI_Curated_Data_Cut_Public_20250321.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># baseline data (predictors)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="va">data</span><span class="op">$</span><span class="va">COHORT</span><span class="op">==</span><span class="fl">1</span> <span class="op">&amp;</span> <span class="va">data</span><span class="op">$</span><span class="va">EVENT_ID</span><span class="op">==</span><span class="st">"BL"</span>,<span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">$</span><span class="va">PATNO</span></span>
<span><span class="va">prop.miss</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span>,<span class="va">prop.miss</span><span class="op">&lt;=</span><span class="fl">0.5</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">class</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"numeric"</span>,<span class="st">"integer"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">==</span><span class="st">"age"</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">missRanger</span><span class="fu">::</span><span class="fu">missRanger</span><span class="op">(</span>data<span class="op">=</span><span class="va">x</span>,pmm.k<span class="op">=</span><span class="fl">3</span>,num.trees<span class="op">=</span><span class="fl">100</span>,verbose<span class="op">=</span><span class="fl">0</span>,seed<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># follow-up data (outcomes)</span></span>
<span><span class="va">visit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"V04"</span>,<span class="st">"V06"</span>,<span class="st">"V08"</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="va">data</span><span class="op">$</span><span class="va">COHORT</span><span class="op">==</span><span class="fl">1</span> <span class="op">&amp;</span> <span class="va">data</span><span class="op">$</span><span class="va">EVENT_ID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">visit</span>,<span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">==</span><span class="st">"updrs_totscore"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"updrs"</span></span>
<span><span class="va">vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"moca"</span>,<span class="st">"quip"</span>,<span class="st">"updrs"</span>,<span class="st">"gds"</span>,<span class="st">"scopa"</span>,<span class="st">"ess"</span>,<span class="st">"bjlot"</span>,<span class="st">"rem"</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">y</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"EVENT_ID"</span>,<span class="st">"PATNO"</span>,<span class="va">vars</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/reshape.html" class="external-link">reshape</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">y</span>,idvar<span class="op">=</span><span class="st">"PATNO"</span>,timevar<span class="op">=</span><span class="st">"EVENT_ID"</span>,direction<span class="op">=</span><span class="st">"wide"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">y</span><span class="op">$</span><span class="va">PATNO</span>; <span class="va">y</span><span class="op">$</span><span class="va">PATNO</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span></span>
<span><span class="co"># overlap</span></span>
<span><span class="va">names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">intersect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="va">names</span>,<span class="op">]</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">y</span><span class="op">[</span><span class="va">names</span>,<span class="op">]</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="co">#y &lt;- scale(y)</span></span>
<span></span>
<span><span class="va">metric</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">vars</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">vars</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,<span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">vars</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,<span class="st">"."</span>,<span class="va">visit</span><span class="op">)</span></span>
<span>  <span class="va">cond</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span>,<span class="va">cols</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">==</span><span class="fl">0</span> <span class="co"># temporary</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">cond</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">250</span><span class="op">)</span><span class="op">{</span><span class="va">cond</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">cond</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">250</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span><span class="op">}</span> <span class="co"># temporary</span></span>
<span>  <span class="va">metric</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">joinet</span><span class="fu">:::</span><span class="fu">cv.joinet</span><span class="op">(</span>Y<span class="op">=</span><span class="va">y</span><span class="op">[</span><span class="va">cond</span>,<span class="va">cols</span><span class="op">]</span>,X<span class="op">=</span><span class="va">x</span><span class="op">[</span><span class="va">cond</span>,<span class="op">]</span>,family<span class="op">=</span><span class="st">"gaussian"</span>,compare<span class="op">=</span><span class="st">"mnorm"</span><span class="op">)</span></span>
<span>  <span class="co">#method &lt;- c("glm.empty","glm.separate","glm.mgaussian","sparselink","devel") # ,"sparselink")</span></span>
<span>  <span class="co">#metric[[i]] &lt;- cv.multiple(y=y[cond,cols],X=x[cond,],family="gaussian",method=method,nfolds=10,alpha.init=0.95,alpha=1,type="exp",trial=FALSE)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#rowMeans(sapply(metric,function(x) colMeans(t(x)/x["none",])))</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">metric</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">deviance</span><span class="op">/</span><span class="va">x</span><span class="op">$</span><span class="va">deviance</span><span class="op">[</span>,<span class="st">"glm.empty"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>This chunk saves the session information for generating figures and
tables.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Armin Rauschenberger.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
